<!DOCTYPE html>

<html lang="zh">

<head>
    
    <title>Archive：2021 - Memory</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" type="image/x-icon" />
    <meta property="og:type" content="website">
<meta property="og:title" content="Memory">
<meta property="og:url" content="https://shadowbynl.github.io/archives/2021/index.html">
<meta property="og:site_name" content="Memory">
<meta property="og:locale">
<meta property="article:author" content="nlby">
<meta name="twitter:card" content="summary">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1633359246550">
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1633359246550">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="nlby" class="mdui-btn mdui-btn-icon"><img src="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" alt="nlby"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="nlby">
            <img src="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" alt="nlby" alt="nlby">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>23</div>
        <div><span>Tags</span>1</div>
        <div><span>Categories</span>5</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="Search" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/?_wv=1027&k=5CfKHun" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/33077945" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/shadowbynl/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/java/">java</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/大四/">大四</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/环境/">环境</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/算法/">算法</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/规划/">规划</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/javase/" style="font-size: 10px;">javase</a>
    </div>
    
  </div>

    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">23</span></li></ul>
    </div>
  </div>



    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 nlby
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><embed src="https://jxiaoc.github.io/animeMusic/demo.html" width="100%"/>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <section class="nexmoe-posts">
    
    <div class="nexmoe-post">
        <a href="/2021/10/04/tool-00/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="工具之一：一个爬虫小demo" class="lazyload">
                    <h1>工具之一：一个爬虫小demo</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年10月04日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.1k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 5 分钟</a>
        </div>

        <article>
            
                <blockquote>
<p>2021.10.04 恰逢绿群换届，加入绿群半年多了，深感绿群给我认识上的帮助还是不小的，为表纪念，编程实现一下把两个绿群当前的群成员信息（为了以后还能留在里面，得每天早上打卡了，）</p>
</blockquote>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/10/01/jaspider/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="jaspider" class="lazyload">
                    <h1>jaspider</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年10月01日</a>
            <a><i class="nexmoefont icon-areachart"></i>32 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <p>爬虫：采集–处理–存储<br>用途：实现搜索引擎 获取更多的数据源 进行搜索引擎优化</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/28/202109summary/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="2021年9月保研结束后总结" class="lazyload">
                    <h1>2021年9月保研结束后总结</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月28日</a>
            <a><i class="nexmoefont icon-areachart"></i>311 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <span id="more"></span>
<p>不多说了，勉强上个学，夏令营后两个月基本没有做保研相关的准备，拿到现在的结果也算是将就吧，之后的路就全看自己把握了。充足的写代码时间，自学时间，和短期的与长期的找工作的目标，将是我未来三年内的主题。<br>未来的半年内，实习，毕设，写代码，学英语，深化对计算机知识的理解，尝试一些事，为研究生打工做准备，锻炼身体。。所有一切需要足够的自律和坚定的信念。这是一个新的起点，与我竞争的不单单是同校同专业的同学，更是全国千千万万学历或高或低经验或多或少的相关从业者。在这行立足，并做久，需要我持续慎重思考并践行。<br>总会有遗憾，但要努力让自己以后不要做会让未来后悔的事。现在我的路已经很明确了。</p>
<h3><span id="目标">目标</span></h3><h4><span id="108-前">10.8 前</span></h4><p>1 步入正轨 按920的安排进行<br>2 做简历，准备投递（目标，了解）<br>3 了解之后研究生的规划安排/情况（小概率考虑其他导师）</p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/22/env-npm/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="npm相关环境" class="lazyload">
                    <h1>npm相关环境</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月22日</a>
            <a><i class="nexmoefont icon-areachart"></i>22 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <span id="more"></span>
<p>npm查看全局安装过的包<br>npm list -g –depth 0<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhou-135/articles/11816745.html">https://www.cnblogs.com/zhou-135/articles/11816745.html</a></p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/21/pro-00/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="nk社区" class="lazyload">
                    <h1>nk社区</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月21日</a>
            <a><i class="nexmoefont icon-areachart"></i>12.7k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 66 分钟</a>
        </div>

        <article>
            
                <span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#nk社区">nk社区</a><ul>
<li><a href="#1-首页">1 首页</a></li>
<li><a href="#2-登录模块">2 登录模块</a></li>
<li><a href="#3-核心功能">3 核心功能</a></li>
<li><a href="#四-redis缓存">四 Redis缓存</a></li>
</ul>
</li>
<li><a href="#nk社区编写">nk社区（编写）</a><ul>
<li><a href="#0-框架与环境">0 框架与环境</a></li>
<li><a href="#0-1-框架">0-1 框架</a></li>
<li><a href="#0-2-数据库">0-2 数据库</a></li>
<li><a href="#1-基本环境">1 基本环境</a></li>
<li><a href="#2-登录模块-1">2 登录模块</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h2><span id="nk社区">nk社区</span></h2><h3><span id="1-首页">1 首页</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">用户实体</span><br><span class="line">帖子实体</span><br><span class="line"></span><br><span class="line">帖子mapper</span><br><span class="line">1 （分页）查询帖子（用户id）</span><br><span class="line">2 查询帖子数量</span><br><span class="line"></span><br><span class="line">关于帖子关联的用户名的问题，采用得到帖子后，再查询的方式，不在mapper中统一关联查询，因此需要提供查询用户（id)的方法</span><br><span class="line"></span><br><span class="line">静态资源 static</span><br><span class="line">模板文件 templates</span><br><span class="line"></span><br><span class="line">HomeController</span><br><span class="line">返回帖子-用户的键值列表</span><br><span class="line">首页渲染 帖子列表</span><br><span class="line"></span><br><span class="line">分页功能</span><br><span class="line">分页实体 方法 使用page实体 处理逻辑</span><br><span class="line"></span><br><span class="line">首页 分页实现</span><br><span class="line"></span><br><span class="line">项目调试技巧</span><br><span class="line">f8 7 9 </span><br><span class="line"></span><br><span class="line">日志</span><br><span class="line">默认logback</span><br><span class="line">logback-spring.xml</span><br></pre></td></tr></table></figure>

<h3><span id="2-登录模块">2 登录模块</span></h3><h4><span id="2-1-发送邮件">2-1 发送邮件</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">• 邮箱设置</span><br><span class="line">- 启用客户端SMTP服务</span><br><span class="line">• Spring Email</span><br><span class="line">- 导入 jar 包</span><br><span class="line">- 邮箱参数配置</span><br><span class="line">- 使用 JavaMailSender 发送邮件</span><br><span class="line">• 模板引擎</span><br><span class="line">- 使用 Thymeleaf 发送 HTML 邮件</span><br></pre></td></tr></table></figure>
<h4><span id="2-2-开发注册功能">2-2 开发注册功能</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">• 访问注册页面</span><br><span class="line">- 点击顶部区域内的链接，打开注册页面。</span><br><span class="line">• 提交注册数据</span><br><span class="line">- 通过表单提交数据。</span><br><span class="line">- 服务端验证账号是否已存在、邮箱是否已注册。</span><br><span class="line">- 服务端发送激活邮件。</span><br><span class="line">• 激活注册账号</span><br><span class="line">- 点击邮件中的链接，访问服务端的激活服务</span><br></pre></td></tr></table></figure>
<p>拆解为三次请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">首页跳转至注册页 首部的复用</span><br><span class="line">两个工具类 生成uuid md加盐加密</span><br><span class="line">注册业务 判空 验证账号 验证邮箱 注册用户 激活邮件</span><br><span class="line">注册controller 成功后到执行成功页</span><br><span class="line">注册页面 注册失败后跳回还需要留存信息th:value</span><br><span class="line">激活注册账号（邮箱链接）三种结果--常量类 激活业务</span><br><span class="line">激活controller 登录模板</span><br></pre></td></tr></table></figure>
<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 首页跳转至注册页 首部的复用</span></span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/register&quot;)</span><br><span class="line">public String getRegisterPage() &#123;</span><br><span class="line"><span class="code">    return &quot;/site/register&quot;;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">th:fragment=&quot;header&quot;</span><br><span class="line">th:href=&quot;@&#123;/index&#125;&quot;</span><br><span class="line">th:replace=&quot;index::header&quot;</span><br><span class="line"></span><br><span class="line"><span class="section"># 两个工具类 生成uuid md加盐加密</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span><br><span class="line"><span class="code">	&lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span></span><br><span class="line"><span class="code">	&lt;version&gt;3.9&lt;/version&gt;</span></span><br><span class="line"><span class="code">&lt;/dependency&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">// 生成随机字符串</span><br><span class="line">public static String generateUUID() &#123;</span><br><span class="line"><span class="code">    return UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;);</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code">// MD5加密</span></span><br><span class="line"><span class="code">// hello -&gt; abc123def456</span></span><br><span class="line"><span class="code">// hello + 3e4a8 -&gt; abc123def456abc</span></span><br><span class="line"><span class="code">public static String md5(String key) &#123;</span></span><br><span class="line"><span class="code">    if (StringUtils.isBlank(key)) &#123;</span></span><br><span class="line"><span class="code">        return null;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    return DigestUtils.md5DigestAsHex(key.getBytes());</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 注册业务 判空 验证账号 验证邮箱 注册用户 激活邮件</span></span><br><span class="line">@Service</span><br><span class="line">public class UserService implements CommunityConstant &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private UserMapper userMapper;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private MailClient mailClient;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private TemplateEngine templateEngine;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Value(&quot;$&#123;community.path.domain&#125;&quot;)</span></span><br><span class="line"><span class="code">    private String domain;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Value(&quot;$&#123;server.servlet.context-path&#125;&quot;)</span></span><br><span class="line"><span class="code">    private String contextPath;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    public User findUserById(int id) &#123;</span></span><br><span class="line"><span class="code">        return userMapper.selectById(id);</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    public Map&lt;String, Object&gt; register(User user) &#123;</span></span><br><span class="line"><span class="code">        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 空值处理</span></span><br><span class="line"><span class="code">        if (user == null) &#123;</span></span><br><span class="line"><span class="code">            throw new IllegalArgumentException(&quot;参数不能为空!&quot;);</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        if (StringUtils.isBlank(user.getUsername())) &#123;</span></span><br><span class="line"><span class="code">            map.put(&quot;usernameMsg&quot;, &quot;账号不能为空!&quot;);</span></span><br><span class="line"><span class="code">            return map;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        if (StringUtils.isBlank(user.getPassword())) &#123;</span></span><br><span class="line"><span class="code">            map.put(&quot;passwordMsg&quot;, &quot;密码不能为空!&quot;);</span></span><br><span class="line"><span class="code">            return map;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        if (StringUtils.isBlank(user.getEmail())) &#123;</span></span><br><span class="line"><span class="code">            map.put(&quot;emailMsg&quot;, &quot;邮箱不能为空!&quot;);</span></span><br><span class="line"><span class="code">            return map;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 验证账号</span></span><br><span class="line"><span class="code">        User u = userMapper.selectByName(user.getUsername());</span></span><br><span class="line"><span class="code">        if (u != null) &#123;</span></span><br><span class="line"><span class="code">            map.put(&quot;usernameMsg&quot;, &quot;该账号已存在!&quot;);</span></span><br><span class="line"><span class="code">            return map;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 验证邮箱</span></span><br><span class="line"><span class="code">        u = userMapper.selectByEmail(user.getEmail());</span></span><br><span class="line"><span class="code">        if (u != null) &#123;</span></span><br><span class="line"><span class="code">            map.put(&quot;emailMsg&quot;, &quot;该邮箱已被注册!&quot;);</span></span><br><span class="line"><span class="code">            return map;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 注册用户</span></span><br><span class="line"><span class="code">        user.setSalt(CommunityUtil.generateUUID().substring(0, 5));</span></span><br><span class="line"><span class="code">        user.setPassword(CommunityUtil.md5(user.getPassword() + user.getSalt()));</span></span><br><span class="line"><span class="code">        user.setType(0);</span></span><br><span class="line"><span class="code">        user.setStatus(0);</span></span><br><span class="line"><span class="code">        user.setActivationCode(CommunityUtil.generateUUID());</span></span><br><span class="line"><span class="code">        user.setHeaderUrl(String.format(&quot;http://images.nowcoder.com/head/%dt.png&quot;, new Random().nextInt(1000)));</span></span><br><span class="line"><span class="code">        user.setCreateTime(new Date());</span></span><br><span class="line"><span class="code">        userMapper.insertUser(user);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 激活邮件</span></span><br><span class="line"><span class="code">        Context context = new Context();</span></span><br><span class="line"><span class="code">        context.setVariable(&quot;email&quot;, user.getEmail());</span></span><br><span class="line"><span class="code">        // http://localhost:8080/community/activation/101/code</span></span><br><span class="line"><span class="code">        String url = domain + contextPath + &quot;/activation/&quot; + user.getId() + &quot;/&quot; + user.getActivationCode();</span></span><br><span class="line"><span class="code">        context.setVariable(&quot;url&quot;, url);</span></span><br><span class="line"><span class="code">        String content = templateEngine.process(&quot;/mail/activation&quot;, context);</span></span><br><span class="line"><span class="code">        mailClient.sendMail(user.getEmail(), &quot;激活账号&quot;, content);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        return map;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    public int activation(int userId, String code) &#123;</span></span><br><span class="line"><span class="code">        User user = userMapper.selectById(userId);</span></span><br><span class="line"><span class="code">        if (user.getStatus() == 1) &#123;</span></span><br><span class="line"><span class="code">            return ACTIVATION_REPEAT;</span></span><br><span class="line"><span class="code">        &#125; else if (user.getActivationCode().equals(code)) &#123;</span></span><br><span class="line"><span class="code">            userMapper.updateStatus(userId, 1);</span></span><br><span class="line"><span class="code">            return ACTIVATION_SUCCESS;</span></span><br><span class="line"><span class="code">        &#125; else &#123;</span></span><br><span class="line"><span class="code">            return ACTIVATION_FAILURE;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section"># 注册controller 成功后到执行成功页</span></span><br><span class="line">@Controller</span><br><span class="line">public class LoginController implements CommunityConstant &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private UserService userService;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/register&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">    public String getRegisterPage() &#123;</span></span><br><span class="line"><span class="code">        return &quot;/site/register&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/login&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">    public String getLoginPage() &#123;</span></span><br><span class="line"><span class="code">        return &quot;/site/login&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/register&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="code">    public String register(Model model, User user) &#123;</span></span><br><span class="line"><span class="code">        Map&lt;String, Object&gt; map = userService.register(user);</span></span><br><span class="line"><span class="code">        if (map == null || map.isEmpty()) &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;msg&quot;, &quot;注册成功,我们已经向您的邮箱发送了一封激活邮件,请尽快激活!&quot;);</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;target&quot;, &quot;/index&quot;);</span></span><br><span class="line"><span class="code">            return &quot;/site/operate-result&quot;;</span></span><br><span class="line"><span class="code">        &#125; else &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;usernameMsg&quot;, map.get(&quot;usernameMsg&quot;));</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;passwordMsg&quot;, map.get(&quot;passwordMsg&quot;));</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;emailMsg&quot;, map.get(&quot;emailMsg&quot;));</span></span><br><span class="line"><span class="code">            return &quot;/site/register&quot;;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    // http://localhost:8080/community/activation/101/code</span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/activation/&#123;userId&#125;/&#123;code&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">    public String activation(Model model, @PathVariable(&quot;userId&quot;) int userId, @PathVariable(&quot;code&quot;) String code) &#123;</span></span><br><span class="line"><span class="code">        int result = userService.activation(userId, code);</span></span><br><span class="line"><span class="code">        if (result == ACTIVATION_SUCCESS) &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;msg&quot;, &quot;激活成功,您的账号已经可以正常使用了!&quot;);</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;target&quot;, &quot;/login&quot;);</span></span><br><span class="line"><span class="code">        &#125; else if (result == ACTIVATION_REPEAT) &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;msg&quot;, &quot;无效操作,该账号已经激活过了!&quot;);</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;target&quot;, &quot;/index&quot;);</span></span><br><span class="line"><span class="code">        &#125; else &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;msg&quot;, &quot;激活失败,您提供的激活码不正确!&quot;);</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;target&quot;, &quot;/index&quot;);</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        return &quot;/site/operate-result&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section"># 注册页面 注册失败后跳回还需要留存信息th:value</span></span><br><span class="line">&lt;!-- 内容 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;div class=&quot;container pl-5 pr-5 pt-3 pb-3 mt-3 mb-3&quot;&gt;</span></span><br><span class="line"><span class="code">		&lt;h3 class=&quot;text-center text-info border-bottom pb-3&quot;&gt;注&amp;nbsp;&amp;nbsp;册&lt;/h3&gt;</span></span><br><span class="line"><span class="code">		&lt;form class=&quot;mt-5&quot; method=&quot;post&quot; th:action=&quot;@&#123;/register&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;username&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;账号:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;text&quot;</span></span><br><span class="line"><span class="code">						   th:class=&quot;|form-control $&#123;usernameMsg!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span><br><span class="line"><span class="code">						   th:value=&quot;$&#123;user!=null?user.username:&#x27;&#x27;&#125;&quot;</span></span><br><span class="line"><span class="code">						   id=&quot;username&quot; name=&quot;username&quot; placeholder=&quot;请输入您的账号!&quot; required&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot; th:text=&quot;$&#123;usernameMsg&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">						该账号已存在!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;password&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;密码:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;password&quot;</span></span><br><span class="line"><span class="code">						   th:class=&quot;|form-control $&#123;passwordMsg!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span><br><span class="line"><span class="code">						   th:value=&quot;$&#123;user!=null?user.password:&#x27;&#x27;&#125;&quot;</span></span><br><span class="line"><span class="code">						   id=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;请输入您的密码!&quot; required&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot; th:text=&quot;$&#123;passwordMsg&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">						密码长度不能小于8位!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;							</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;confirm-password&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;确认密码:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;password&quot; class=&quot;form-control&quot;</span></span><br><span class="line"><span class="code">						   th:value=&quot;$&#123;user!=null?user.password:&#x27;&#x27;&#125;&quot;</span></span><br><span class="line"><span class="code">						   id=&quot;confirm-password&quot; placeholder=&quot;请再次输入密码!&quot; required&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot;&gt;</span></span><br><span class="line"><span class="code">						两次输入的密码不一致!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;email&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;邮箱:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;email&quot;</span></span><br><span class="line"><span class="code">						   th:class=&quot;|form-control $&#123;emailMsg!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span><br><span class="line"><span class="code">						   th:value=&quot;$&#123;user!=null?user.email:&#x27;&#x27;&#125;&quot;</span></span><br><span class="line"><span class="code">						   id=&quot;email&quot; name=&quot;email&quot; placeholder=&quot;请输入您的邮箱!&quot; required&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot; th:text=&quot;$&#123;emailMsg&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">						该邮箱已注册!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-2&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10 text-center&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;button type=&quot;submit&quot; class=&quot;btn btn-info text-white form-control&quot;&gt;立即注册&lt;/button&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">		&lt;/form&gt;				</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">&lt;/div&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 激活注册账号（邮箱链接）三种结果--常量类 激活业务</span></span><br><span class="line">public interface CommunityConstant &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    /**</span></span><br><span class="line"><span class="code">     * 激活成功</span></span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    int ACTIVATION_SUCCESS = 0;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    /**</span></span><br><span class="line"><span class="code">     * 重复激活</span></span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    int ACTIVATION_REPEAT = 1;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    /**</span></span><br><span class="line"><span class="code">     * 激活失败</span></span><br><span class="line"><span class="code">     */</span></span><br><span class="line"><span class="code">    int ACTIVATION_FAILURE = 2;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section"># 激活controller 登录模板</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="code">    &lt;link rel=&quot;icon&quot; href=&quot;https://static.nowcoder.com/images/logo_87_87.png&quot;/&gt;</span></span><br><span class="line"><span class="code">    &lt;title&gt;牛客网-激活账号&lt;/title&gt;</span></span><br><span class="line"><span class="code">&lt;/head&gt;</span></span><br><span class="line"><span class="code">&lt;body&gt;</span></span><br><span class="line"><span class="code">	&lt;div&gt;</span></span><br><span class="line"><span class="code">		&lt;p&gt;</span></span><br><span class="line"><span class="code">			&lt;b th:text=&quot;$&#123;email&#125;&quot;&gt;xxx@xxx.com&lt;/b&gt;, 您好!</span></span><br><span class="line"><span class="code">		&lt;/p&gt;</span></span><br><span class="line"><span class="code">		&lt;p&gt;</span></span><br><span class="line"><span class="code">			您正在注册牛客网, 这是一封激活邮件, 请点击 </span></span><br><span class="line"><span class="code">			&lt;a th:href=&quot;$&#123;url&#125;&quot;&gt;此链接&lt;/a&gt;,</span></span><br><span class="line"><span class="code">			激活您的牛客账号!</span></span><br><span class="line"><span class="code">		&lt;/p&gt;</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">&lt;/body&gt;</span></span><br><span class="line"><span class="code">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<h4><span id="2-3-会话管理">2-3 会话管理</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">• HTTP的基本性质</span><br><span class="line">- HTTP是简单的</span><br><span class="line">- HTTP是可扩展的</span><br><span class="line">- HTTP是无状态的，有会话的</span><br><span class="line">• Cookie</span><br><span class="line">- 是服务器发送到浏览器，并保存在浏览器端的一小块数据。</span><br><span class="line">- 浏览器下次访问该服务器时，会自动携带块该数据，将其发送给服务器。</span><br><span class="line">• Session</span><br><span class="line">- 是JavaEE的标准，用于在服务端记录客户端信息。</span><br><span class="line">- 数据存放在服务端更加安全，但是也会增加服务端的内存压力。</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie测试</span><br><span class="line">session测试 多服务器情况 粘性session 同步session session服务器 会话数据存储 数据库（非关系）</span><br></pre></td></tr></table></figure>

<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// cookie示例</span><br><span class="line">@RequestMapping(path = &quot;/cookie/set&quot;, method = RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String setCookie(HttpServletResponse response) &#123;</span><br><span class="line"><span class="code">    // 创建cookie</span></span><br><span class="line"><span class="code">    Cookie cookie = new Cookie(&quot;code&quot;, CommunityUtil.generateUUID());</span></span><br><span class="line"><span class="code">    // 设置cookie生效的范围</span></span><br><span class="line"><span class="code">    cookie.setPath(&quot;/community/alpha&quot;);</span></span><br><span class="line"><span class="code">    // 设置cookie的生存时间</span></span><br><span class="line"><span class="code">    cookie.setMaxAge(60 * 10);</span></span><br><span class="line"><span class="code">    // 发送cookie</span></span><br><span class="line"><span class="code">    response.addCookie(cookie);</span></span><br><span class="line"><span class="code">    return &quot;set cookie&quot;;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code">@RequestMapping(path = &quot;/cookie/get&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">@ResponseBody</span></span><br><span class="line"><span class="code">public String getCookie(@CookieValue(&quot;code&quot;) String code) &#123;</span></span><br><span class="line"><span class="code">    System.out.println(code);</span></span><br><span class="line"><span class="code">    return &quot;get cookie&quot;;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code">// session示例</span></span><br><span class="line"><span class="code">@RequestMapping(path = &quot;/session/set&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">@ResponseBody</span></span><br><span class="line"><span class="code">public String setSession(HttpSession session) &#123;</span></span><br><span class="line"><span class="code">    session.setAttribute(&quot;id&quot;, 1);</span></span><br><span class="line"><span class="code">    session.setAttribute(&quot;name&quot;, &quot;Test&quot;);</span></span><br><span class="line"><span class="code">    return &quot;set session&quot;;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code">@RequestMapping(path = &quot;/session/get&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">@ResponseBody</span></span><br><span class="line"><span class="code">public String getSession(HttpSession session) &#123;</span></span><br><span class="line"><span class="code">    System.out.println(session.getAttribute(&quot;id&quot;));</span></span><br><span class="line"><span class="code">    System.out.println(session.getAttribute(&quot;name&quot;));</span></span><br><span class="line"><span class="code">    return &quot;get session&quot;;</span></span><br><span class="line"><span class="code">&#125;</span></span><br></pre></td></tr></table></figure>
<h4><span id="2-4-生成验证码">2-4 生成验证码</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Kaptcha</span><br><span class="line">- 导入 jar 包</span><br><span class="line">- 编写 Kaptcha 配置类</span><br><span class="line">- 生成随机字符、生成图片</span><br></pre></td></tr></table></figure>
<p>生成验证码的配置类 controller login图片 js 统一路径 随机参数</p>
<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 导入 jar 包</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;groupId&gt;com.github.penggle&lt;/groupId&gt;</span></span><br><span class="line"><span class="code">	&lt;artifactId&gt;kaptcha&lt;/artifactId&gt;</span></span><br><span class="line"><span class="code">	&lt;version&gt;2.3.2&lt;/version&gt;</span></span><br><span class="line"><span class="code">&lt;/dependency&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 编写 Kaptcha 配置类</span></span><br><span class="line">@Configuration</span><br><span class="line">public class KaptchaConfig &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    @Bean</span></span><br><span class="line"><span class="code">    public Producer kaptchaProducer() &#123;</span></span><br><span class="line"><span class="code">        Properties properties = new Properties();</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.image.width&quot;, &quot;100&quot;);</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.image.height&quot;, &quot;40&quot;);</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.textproducer.font.size&quot;, &quot;32&quot;);</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.textproducer.font.color&quot;, &quot;0,0,0&quot;);</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.textproducer.char.string&quot;, &quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYAZ&quot;);</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.textproducer.char.length&quot;, &quot;4&quot;);</span></span><br><span class="line"><span class="code">        properties.setProperty(&quot;kaptcha.noise.impl&quot;, &quot;com.google.code.kaptcha.impl.NoNoise&quot;);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        DefaultKaptcha kaptcha = new DefaultKaptcha();</span></span><br><span class="line"><span class="code">        Config config = new Config(properties);</span></span><br><span class="line"><span class="code">        kaptcha.setConfig(config);</span></span><br><span class="line"><span class="code">        return kaptcha;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section"># 生成随机字符、生成图片</span></span><br><span class="line">@RequestMapping(path = &quot;/kaptcha&quot;, method = RequestMethod.GET)</span><br><span class="line">public void getKaptcha(HttpServletResponse response, HttpSession session) &#123;</span><br><span class="line"><span class="code">    // 生成验证码</span></span><br><span class="line"><span class="code">    String text = kaptchaProducer.createText();</span></span><br><span class="line"><span class="code">    BufferedImage image = kaptchaProducer.createImage(text);</span></span><br><span class="line"><span class="code">    // 将验证码存入session</span></span><br><span class="line"><span class="code">    session.setAttribute(&quot;kaptcha&quot;, text);</span></span><br><span class="line"><span class="code">    // 将突图片输出给浏览器</span></span><br><span class="line"><span class="code">    response.setContentType(&quot;image/png&quot;);</span></span><br><span class="line"><span class="code">    try &#123;</span></span><br><span class="line"><span class="code">        OutputStream os = response.getOutputStream();</span></span><br><span class="line"><span class="code">        ImageIO.write(image, &quot;png&quot;, os);</span></span><br><span class="line"><span class="code">    &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="code">        logger.error(&quot;响应验证码失败:&quot; + e.getMessage());</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 前端</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;div class=&quot;container pl-5 pr-5 pt-3 pb-3 mt-3 mb-3&quot;&gt;</span></span><br><span class="line"><span class="code">		&lt;h3 class=&quot;text-center text-info border-bottom pb-3&quot;&gt;登&amp;nbsp;&amp;nbsp;录&lt;/h3&gt;</span></span><br><span class="line"><span class="code">		&lt;form class=&quot;mt-5&quot;&gt;				</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;username&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;账号:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;text&quot; class=&quot;form-control is-invalid&quot; id=&quot;username&quot; placeholder=&quot;请输入您的账号!&quot; required&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot;&gt;</span></span><br><span class="line"><span class="code">						该账号不存在!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;password&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;密码:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;password&quot; class=&quot;form-control is-invalid&quot; id=&quot;password&quot; placeholder=&quot;请输入您的密码!&quot; required&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot;&gt;</span></span><br><span class="line"><span class="code">						密码长度不能小于8位!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;							</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label for=&quot;verifycode&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;验证码:&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-6&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;text&quot; class=&quot;form-control is-invalid&quot; id=&quot;verifycode&quot; placeholder=&quot;请输入验证码!&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;div class=&quot;invalid-feedback&quot;&gt;</span></span><br><span class="line"><span class="code">						验证码不正确!</span></span><br><span class="line"><span class="code">					&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-4&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;img th:src=&quot;@&#123;/kaptcha&#125;&quot; id=&quot;kaptcha&quot; style=&quot;width:100px;height:40px;&quot; class=&quot;mr-2&quot;/&gt;</span></span><br><span class="line"><span class="code">					&lt;a href=&quot;javascript:refresh_kaptcha();&quot; class=&quot;font-size-12 align-bottom&quot;&gt;刷新验证码&lt;/a&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;				</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-2&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;input type=&quot;checkbox&quot; id=&quot;remember-me&quot; checked=&quot;checked&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;label class=&quot;form-check-label&quot; for=&quot;remember-me&quot;&gt;记住我&lt;/label&gt;</span></span><br><span class="line"><span class="code">					&lt;a href=&quot;forget.html&quot; class=&quot;text-danger float-right&quot;&gt;忘记密码?&lt;/a&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;				</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-2&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;col-sm-10 text-center&quot;&gt;</span></span><br><span class="line"><span class="code">					&lt;button type=&quot;submit&quot; class=&quot;btn btn-info text-white form-control&quot;&gt;立即登录&lt;/button&gt;</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">		&lt;/form&gt;				</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">&lt;/div&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">var CONTEXT<span class="emphasis">_PATH = &quot;/community&quot;;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/global.js&#125;&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">	function refresh_</span>kaptcha() &#123;</span><br><span class="line"><span class="code">		var path = CONTEXT_PATH + &quot;/kaptcha?p=&quot; + Math.random();</span></span><br><span class="line"><span class="code">		$(&quot;#kaptcha&quot;).attr(&quot;src&quot;, path);</span></span><br><span class="line"><span class="code">	&#125;</span></span><br><span class="line"><span class="code">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<h4><span id="2-5-开发登录-退出功能">2-5 开发登录、退出功能</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">• 访问登录页面</span><br><span class="line">- 点击顶部区域内的链接，打开登录页面。</span><br><span class="line">• 登录</span><br><span class="line">- 验证账号、密码、验证码。</span><br><span class="line">- 成功时，生成登录凭证，发放给客户端。</span><br><span class="line">- 失败时，跳转回登录页。</span><br><span class="line">• 退出</span><br><span class="line">- 将登录凭证修改为失效状态。</span><br><span class="line">- 跳转至网站首页。</span><br></pre></td></tr></table></figure>
<p>登录凭证<br>实体<br>登录业务（空值处理 验证账号|是否存在/是否激活 验证密码 生成登录凭证）<br>controller（检查验证码 登录凭证超时时间设置 检查账号密码<br>登录页 表单 请求参数（输入回显 提示文本）<br>退出功能（凭证失效 重定向到登录页 退出链接）</p>
<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 登录凭证</span></span><br><span class="line">public class LoginTicket &#123;</span><br><span class="line"><span class="code">    private int id;</span></span><br><span class="line"><span class="code">    private int userId;</span></span><br><span class="line"><span class="code">    private String ticket;</span></span><br><span class="line"><span class="code">    private int status;</span></span><br><span class="line"><span class="code">    private Date expired;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="section"># 实体</span></span><br><span class="line"><span class="section"># 登录业务（空值处理 验证账号|是否存在/是否激活 验证密码 生成登录凭证）</span></span><br><span class="line">public Map<span class="xml">&lt;String, Object&gt;</span> login(String username, String password, int expiredSeconds) &#123;</span><br><span class="line"><span class="code">    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line"><span class="code">    // 空值处理</span></span><br><span class="line"><span class="code">    if (StringUtils.isBlank(username)) &#123;</span></span><br><span class="line"><span class="code">        map.put(&quot;usernameMsg&quot;, &quot;账号不能为空!&quot;);</span></span><br><span class="line"><span class="code">        return map;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    if (StringUtils.isBlank(password)) &#123;</span></span><br><span class="line"><span class="code">        map.put(&quot;passwordMsg&quot;, &quot;密码不能为空!&quot;);</span></span><br><span class="line"><span class="code">        return map;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    // 验证账号</span></span><br><span class="line"><span class="code">    User user = userMapper.selectByName(username);</span></span><br><span class="line"><span class="code">    if (user == null) &#123;</span></span><br><span class="line"><span class="code">        map.put(&quot;usernameMsg&quot;, &quot;该账号不存在!&quot;);</span></span><br><span class="line"><span class="code">        return map;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    // 验证状态</span></span><br><span class="line"><span class="code">    if (user.getStatus() == 0) &#123;</span></span><br><span class="line"><span class="code">        map.put(&quot;usernameMsg&quot;, &quot;该账号未激活!&quot;);</span></span><br><span class="line"><span class="code">        return map;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    // 验证密码</span></span><br><span class="line"><span class="code">    password = CommunityUtil.md5(password + user.getSalt());</span></span><br><span class="line"><span class="code">    if (!user.getPassword().equals(password)) &#123;</span></span><br><span class="line"><span class="code">        map.put(&quot;passwordMsg&quot;, &quot;密码不正确!&quot;);</span></span><br><span class="line"><span class="code">        return map;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    // 生成登录凭证</span></span><br><span class="line"><span class="code">    LoginTicket loginTicket = new LoginTicket();</span></span><br><span class="line"><span class="code">    loginTicket.setUserId(user.getId());</span></span><br><span class="line"><span class="code">    loginTicket.setTicket(CommunityUtil.generateUUID());</span></span><br><span class="line"><span class="code">    loginTicket.setStatus(0);</span></span><br><span class="line"><span class="code">    loginTicket.setExpired(new Date(System.currentTimeMillis() + expiredSeconds * 1000));</span></span><br><span class="line"><span class="code">    loginTicketMapper.insertLoginTicket(loginTicket);</span></span><br><span class="line"><span class="code">    map.put(&quot;ticket&quot;, loginTicket.getTicket());</span></span><br><span class="line"><span class="code">    return map;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"># controller（检查验证码 登录凭证超时时间设置 检查账号密码</span></span><br><span class="line"><span class="code">@RequestMapping(path = &quot;/login&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="code">public String login(String username, String password, String code, boolean rememberme,</span></span><br><span class="line"><span class="code">                    Model model, HttpSession session, HttpServletResponse response) &#123;</span></span><br><span class="line"><span class="code">    // 检查验证码</span></span><br><span class="line"><span class="code">    String kaptcha = (String) session.getAttribute(&quot;kaptcha&quot;);</span></span><br><span class="line"><span class="code">    if (StringUtils.isBlank(kaptcha) || StringUtils.isBlank(code) || !kaptcha.equalsIgnoreCase(code)) &#123;</span></span><br><span class="line"><span class="code">        model.addAttribute(&quot;codeMsg&quot;, &quot;验证码不正确!&quot;);</span></span><br><span class="line"><span class="code">        return &quot;/site/login&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">    // 检查账号,密码</span></span><br><span class="line"><span class="code">    int expiredSeconds = rememberme ? REMEMBER_EXPIRED_SECONDS : DEFAULT_EXPIRED_SECONDS;</span></span><br><span class="line"><span class="code">    Map&lt;String, Object&gt; map = userService.login(username, password, expiredSeconds);</span></span><br><span class="line"><span class="code">    if (map.containsKey(&quot;ticket&quot;)) &#123;</span></span><br><span class="line"><span class="code">        Cookie cookie = new Cookie(&quot;ticket&quot;, map.get(&quot;ticket&quot;).toString());</span></span><br><span class="line"><span class="code">        cookie.setPath(contextPath);</span></span><br><span class="line"><span class="code">        cookie.setMaxAge(expiredSeconds);</span></span><br><span class="line"><span class="code">        response.addCookie(cookie);</span></span><br><span class="line"><span class="code">        return &quot;redirect:/index&quot;;</span></span><br><span class="line"><span class="code">    &#125; else &#123;</span></span><br><span class="line"><span class="code">        model.addAttribute(&quot;usernameMsg&quot;, map.get(&quot;usernameMsg&quot;));</span></span><br><span class="line"><span class="code">        model.addAttribute(&quot;passwordMsg&quot;, map.get(&quot;passwordMsg&quot;));</span></span><br><span class="line"><span class="code">        return &quot;/site/login&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">/<span class="strong">**</span></span><br><span class="line"><span class="strong"> <span class="emphasis">* 默认状态的登录凭证的超时时间</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"> *</span>/</span></span><br><span class="line"><span class="strong">int DEFAULT<span class="emphasis">_EXPIRED_</span>SECONDS = 3600 <span class="emphasis">* 12;</span></span></span><br><span class="line"><span class="emphasis"><span class="strong">/<span class="strong">**</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"> <span class="emphasis">* 记住状态的登录凭证超时时间</span></span></span></span></span><br><span class="line"><span class="emphasis"><span class="strong"><span class="emphasis"><span class="strong"> *</span>/</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">int REMEMBER<span class="emphasis">_EXPIRED_</span>SECONDS = 3600 <span class="emphasis">* 24 *</span> 100;</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"># 登录页 表单 请求参数（输入回显 提示文本）</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">&lt;!-- 内容 --&gt;</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">	<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container pl-5 pr-5 pt-3 pb-3 mt-3 mb-3&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">		<span class="xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;text-center text-info border-bottom pb-3&quot;</span>&gt;</span></span>登&amp;nbsp;&amp;nbsp;录<span class="xml"><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">		<span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;mt-5&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2 col-form-label text-right&quot;</span>&gt;</span></span>账号:<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;|form-control $&#123;usernameMsg!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span></span></span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="strong"><span class="emphasis"><span class="strong">						   <span class="attr">th:value</span>=<span class="string">&quot;$&#123;param.username&#125;&quot;</span></span></span></span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="strong"><span class="emphasis"><span class="strong">						   <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您的账号!&quot;</span> <span class="attr">required</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;invalid-feedback&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;usernameMsg&#125;&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">						该账号不存在!</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row mt-4&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2 col-form-label text-right&quot;</span>&gt;</span></span>密码:<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;|form-control $&#123;passwordMsg!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span></span></span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="strong"><span class="emphasis"><span class="strong">						   <span class="attr">th:value</span>=<span class="string">&quot;$&#123;param.password&#125;&quot;</span></span></span></span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="strong"><span class="emphasis"><span class="strong">						   <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您的密码!&quot;</span> <span class="attr">required</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;invalid-feedback&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;passwordMsg&#125;&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">						密码长度不能小于8位!</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>							</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row mt-4&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;verifycode&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2 col-form-label text-right&quot;</span>&gt;</span></span>验证码:<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-6&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:class</span>=<span class="string">&quot;|form-control $&#123;codeMsg!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span></span></span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="strong"><span class="emphasis"><span class="strong">						   <span class="attr">id</span>=<span class="string">&quot;verifycode&quot;</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码!&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;invalid-feedback&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;codeMsg&#125;&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">						验证码不正确!</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-4&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/kaptcha&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;kaptcha&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100px;height:40px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mr-2&quot;</span>/&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:refresh_kaptcha();&quot;</span> <span class="attr">class</span>=<span class="string">&quot;font-size-12 align-bottom&quot;</span>&gt;</span></span>刷新验证码<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>				</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row mt-4&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;remember-me&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rememberme&quot;</span></span></span></span></span></span></span><br><span class="line"><span class="tag"><span class="xml"><span class="strong"><span class="emphasis"><span class="strong">						   <span class="attr">th:checked</span>=<span class="string">&quot;$&#123;param.rememberme&#125;&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;remember-me&quot;</span>&gt;</span></span>记住我<span class="xml"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;forget.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-danger float-right&quot;</span>&gt;</span></span>忘记密码?<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>				</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row mt-4&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-2&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10 text-center&quot;</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-info text-white form-control&quot;</span>&gt;</span></span>立即登录<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">		<span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span>				</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">	<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"># 退出功能（凭证失效 重定向到登录页 退出链接）</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">public void logout(String ticket) &#123;</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">    loginTicketMapper.updateStatus(ticket, 1);</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">&#125;</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong"></span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">@RequestMapping(path = &quot;/logout&quot;, method = RequestMethod.GET)</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">public String logout(@CookieValue(&quot;ticket&quot;) String ticket) &#123;</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">    userService.logout(ticket);</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">    return &quot;redirect:/login&quot;;</span></span></span></span><br><span class="line"><span class="strong"><span class="emphasis"><span class="strong">&#125;</span></span></span></span><br></pre></td></tr></table></figure>
<h4><span id="2-6-显示登录信息">2-6 显示登录信息</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">• 拦截器示例</span><br><span class="line">- 定义拦截器，实现HandlerInterceptor</span><br><span class="line">- 配置拦截器，为它指定拦截、排除的路径</span><br><span class="line">• 拦截器应用</span><br><span class="line">- 在请求开始时查询登录用户</span><br><span class="line">- 在本次请求中持有用户数据</span><br><span class="line">- 在模板视图上显示用户数据</span><br><span class="line">- 在请求结束时清理用户数据</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">拦截器测试 interceptor mvc配置</span><br><span class="line">利用cookie获取凭证-用户实体</span><br><span class="line">获取cookie的工具类</span><br><span class="line">LoginTicketInterceptor（获取凭证 获取用户--持有用户信息的工具类 ThreadLocal）</span><br><span class="line">页面th:if</span><br></pre></td></tr></table></figure>
<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 拦截器测试 interceptor mvc配置</span></span><br><span class="line">@Component</span><br><span class="line">public class AlphaInterceptor implements HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    private static final Logger logger = LoggerFactory.getLogger(AlphaInterceptor.class);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    // 在Controller之前执行</span></span><br><span class="line"><span class="code">    @Override</span></span><br><span class="line"><span class="code">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span></span><br><span class="line"><span class="code">        logger.debug(&quot;preHandle: &quot; + handler.toString());</span></span><br><span class="line"><span class="code">        return true;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    // 在Controller之后执行</span></span><br><span class="line"><span class="code">    @Override</span></span><br><span class="line"><span class="code">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span></span><br><span class="line"><span class="code">        logger.debug(&quot;postHandle: &quot; + handler.toString());</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    // 在TemplateEngine之后执行</span></span><br><span class="line"><span class="code">    @Override</span></span><br><span class="line"><span class="code">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span></span><br><span class="line"><span class="code">        logger.debug(&quot;afterCompletion: &quot; + handler.toString());</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private AlphaInterceptor alphaInterceptor;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private LoginTicketInterceptor loginTicketInterceptor;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Override</span></span><br><span class="line"><span class="code">    public void addInterceptors(InterceptorRegistry registry) &#123;</span></span><br><span class="line"><span class="code">        registry.addInterceptor(alphaInterceptor)</span></span><br><span class="line"><span class="code">                .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;)</span></span><br><span class="line"><span class="code">                .addPathPatterns(&quot;/register&quot;, &quot;/login&quot;);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        registry.addInterceptor(loginTicketInterceptor)</span></span><br><span class="line"><span class="code">                .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;);</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section"># 利用cookie获取凭证-用户实体</span></span><br><span class="line"><span class="section"># 获取cookie的工具类</span></span><br><span class="line">public class CookieUtil &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    public static String getValue(HttpServletRequest request, String name) &#123;</span></span><br><span class="line"><span class="code">        if (request == null || name == null) &#123;</span></span><br><span class="line"><span class="code">            throw new IllegalArgumentException(&quot;参数为空!&quot;);</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        Cookie[] cookies = request.getCookies();</span></span><br><span class="line"><span class="code">        if (cookies != null) &#123;</span></span><br><span class="line"><span class="code">            for (Cookie cookie : cookies) &#123;</span></span><br><span class="line"><span class="code">                if (cookie.getName().equals(name)) &#123;</span></span><br><span class="line"><span class="code">                    return cookie.getValue();</span></span><br><span class="line"><span class="code">                &#125;</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        return null;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section"># LoginTicketInterceptor（获取凭证 获取用户--持有用户信息的工具类 ThreadLocal）</span></span><br><span class="line">/<span class="strong">**</span></span><br><span class="line"><span class="strong"> <span class="emphasis">* 持有用户信息,用于代替session对象.</span></span></span><br><span class="line"><span class="emphasis"><span class="strong"> *</span>/</span></span><br><span class="line"><span class="strong">@Component</span></span><br><span class="line"><span class="strong">public class HostHolder &#123;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    private ThreadLocal<span class="xml"><span class="tag">&lt;<span class="name">User</span>&gt;</span></span> users = new ThreadLocal&lt;&gt;();</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    public void setUser(User user) &#123;</span></span><br><span class="line"><span class="strong">        users.set(user);</span></span><br><span class="line"><span class="strong">    &#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    public User getUser() &#123;</span></span><br><span class="line"><span class="strong">        return users.get();</span></span><br><span class="line"><span class="strong">    &#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    public void clear() &#123;</span></span><br><span class="line"><span class="strong">        users.remove();</span></span><br><span class="line"><span class="strong">    &#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">&#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">@Component</span></span><br><span class="line"><span class="strong">public class LoginTicketInterceptor implements HandlerInterceptor &#123;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    @Autowired</span></span><br><span class="line"><span class="strong">    private UserService userService;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    @Autowired</span></span><br><span class="line"><span class="strong">    private HostHolder hostHolder;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    @Override</span></span><br><span class="line"><span class="strong">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span></span><br><span class="line"><span class="strong">        // 从cookie中获取凭证</span></span><br><span class="line"><span class="strong">        String ticket = CookieUtil.getValue(request, &quot;ticket&quot;);</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">        if (ticket != null) &#123;</span></span><br><span class="line"><span class="strong">            // 查询凭证</span></span><br><span class="line"><span class="strong">            LoginTicket loginTicket = userService.findLoginTicket(ticket);</span></span><br><span class="line"><span class="strong">            // 检查凭证是否有效</span></span><br><span class="line"><span class="strong">            if (loginTicket != null &amp;&amp; loginTicket.getStatus() == 0 &amp;&amp; loginTicket.getExpired().after(new Date())) &#123;</span></span><br><span class="line"><span class="strong">                // 根据凭证查询用户</span></span><br><span class="line"><span class="strong">                User user = userService.findUserById(loginTicket.getUserId());</span></span><br><span class="line"><span class="strong">                // 在本次请求中持有用户</span></span><br><span class="line"><span class="strong">                hostHolder.setUser(user);</span></span><br><span class="line"><span class="strong">            &#125;</span></span><br><span class="line"><span class="strong">        &#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">        return true;</span></span><br><span class="line"><span class="strong">    &#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    @Override</span></span><br><span class="line"><span class="strong">    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123;</span></span><br><span class="line"><span class="strong">        User user = hostHolder.getUser();</span></span><br><span class="line"><span class="strong">        if (user != null &amp;&amp; modelAndView != null) &#123;</span></span><br><span class="line"><span class="strong">            modelAndView.addObject(&quot;loginUser&quot;, user);</span></span><br><span class="line"><span class="strong">        &#125;</span></span><br><span class="line"><span class="strong">    &#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">    @Override</span></span><br><span class="line"><span class="strong">    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123;</span></span><br><span class="line"><span class="strong">        hostHolder.clear();</span></span><br><span class="line"><span class="strong">    &#125;</span></span><br><span class="line"><span class="strong">&#125;</span></span><br><span class="line"><span class="strong"># 页面th:if</span></span><br><span class="line"><span class="strong">&lt;!-- 头部 --&gt;</span></span><br><span class="line"><span class="strong"><span class="xml"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;bg-dark sticky-top&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">	<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">		&lt;!-- 导航 --&gt;</span></span><br><span class="line"><span class="strong">		<span class="xml"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-expand-lg navbar-dark&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">			&lt;!-- logo --&gt;</span></span><br><span class="line"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;navbar-toggler&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;collapse&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#navbarSupportedContent&quot;</span> <span class="attr">aria-controls</span>=<span class="string">&quot;navbarSupportedContent&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Toggle navigation&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;navbar-toggler-icon&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">			&lt;!-- 功能 --&gt;</span></span><br><span class="line"><span class="strong">			<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;collapse navbar-collapse&quot;</span> <span class="attr">id</span>=<span class="string">&quot;navbarSupportedContent&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;navbar-nav mr-auto&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item ml-3 btn-group-vertical&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/index&#125;&quot;</span>&gt;</span></span>首页<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item ml-3 btn-group-vertical&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;loginUser!=null&#125;&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link position-relative&quot;</span> <span class="attr">href</span>=<span class="string">&quot;site/letter.html&quot;</span>&gt;</span></span>消息<span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-danger&quot;</span>&gt;</span></span>12<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item ml-3 btn-group-vertical&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;loginUser==null&#125;&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/register&#125;&quot;</span>&gt;</span></span>注册<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item ml-3 btn-group-vertical&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;loginUser==null&#125;&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span></span>登录<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item ml-3 btn-group-vertical dropdown&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;loginUser!=null&#125;&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link dropdown-toggle&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;navbarDropdown&quot;</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span> <span class="attr">aria-haspopup</span>=<span class="string">&quot;true&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">							<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;loginUser.headerUrl&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:30px;&quot;</span>/&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;navbarDropdown&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">							<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item text-center&quot;</span> <span class="attr">href</span>=<span class="string">&quot;site/profile.html&quot;</span>&gt;</span></span>个人主页<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">							<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item text-center&quot;</span> <span class="attr">href</span>=<span class="string">&quot;site/setting.html&quot;</span>&gt;</span></span>账号设置<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">							<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item text-center&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span></span>退出登录<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">							<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-divider&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">							<span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item text-center text-secondary&quot;</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;loginUser.username&#125;&quot;</span>&gt;</span></span>nowcoder<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">						<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">				&lt;!-- 搜索 --&gt;</span></span><br><span class="line"><span class="strong">				<span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-inline my-2 my-lg-0&quot;</span> <span class="attr">action</span>=<span class="string">&quot;site/search.html&quot;</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-control mr-sm-2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;search&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Search&quot;</span> /&gt;</span></span></span></span><br><span class="line"><span class="strong">					<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-light my-2 my-sm-0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span>搜索<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">				<span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">			<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">		<span class="xml"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">	<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="strong"><span class="xml"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure>
<h4><span id="2-7-账号设置">2-7 账号设置</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">• 上传文件</span><br><span class="line">- 请求：必须是POST请求</span><br><span class="line">- 表单：enctype=“multipart/form-data”</span><br><span class="line">- Spring MVC：通过 MultipartFile 处理上传文件</span><br><span class="line">• 开发步骤</span><br><span class="line">- 访问账号设置页面</span><br><span class="line">- 上传头像</span><br><span class="line">- 获取头像</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">设置页</span><br><span class="line">配置上传路径</span><br><span class="line">上传controller方法（model返回提示信息）</span><br><span class="line">获取头像</span><br></pre></td></tr></table></figure>
<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 设置页</span></span><br><span class="line">&lt;!-- 上传头像 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h6</span> <span class="attr">class</span>=<span class="string">&quot;text-left text-info border-bottom pb-2&quot;</span>&gt;</span></span>上传头像<span class="xml"><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;mt-5&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/user/upload&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">	&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">		&lt;label for=&quot;head-image&quot; class=&quot;col-sm-2 col-form-label text-right&quot;&gt;选择头像:&lt;/label&gt;</span></span><br><span class="line"><span class="code">		&lt;div class=&quot;col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="code">			&lt;div class=&quot;custom-file&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;input type=&quot;file&quot; th:class=&quot;|custom-file-input $&#123;error!=null?&#x27;is-invalid&#x27;:&#x27;&#x27;&#125;|&quot;</span></span><br><span class="line"><span class="code">					   id=&quot;head-image&quot; name=&quot;headerImage&quot; lang=&quot;es&quot; required=&quot;&quot;&gt;</span></span><br><span class="line"><span class="code">				&lt;label class=&quot;custom-file-label&quot; for=&quot;head-image&quot; data-browse=&quot;文件&quot;&gt;选择一张图片&lt;/label&gt;</span></span><br><span class="line"><span class="code">				&lt;div class=&quot;invalid-feedback&quot; th:text=&quot;$&#123;error&#125;&quot;&gt;</span></span><br><span class="line"><span class="code">					该账号不存在!</span></span><br><span class="line"><span class="code">				&lt;/div&gt;</span></span><br><span class="line"><span class="code">			&lt;/div&gt;</span></span><br><span class="line"><span class="code">		&lt;/div&gt;</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">	&lt;div class=&quot;form-group row mt-4&quot;&gt;</span></span><br><span class="line"><span class="code">		&lt;div class=&quot;col-sm-2&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="code">		&lt;div class=&quot;col-sm-10 text-center&quot;&gt;</span></span><br><span class="line"><span class="code">			&lt;button type=&quot;submit&quot; class=&quot;btn btn-info text-white form-control&quot;&gt;立即上传&lt;/button&gt;</span></span><br><span class="line"><span class="code">		&lt;/div&gt;</span></span><br><span class="line"><span class="code">	&lt;/div&gt;</span></span><br><span class="line"><span class="code">&lt;/form&gt;</span></span><br><span class="line"><span class="code"># 配置上传路径</span></span><br><span class="line"><span class="code">community.path.domain=http://localhost:8080</span></span><br><span class="line"><span class="code">community.path.upload=d:/work/data/upload</span></span><br><span class="line"><span class="code"># 上传controller方法（model返回提示信息）</span></span><br><span class="line"><span class="code">@Controller</span></span><br><span class="line"><span class="code">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="code">public class UserController &#123;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    private static final Logger logger = LoggerFactory.getLogger(UserController.class);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Value(&quot;$&#123;community.path.upload&#125;&quot;)</span></span><br><span class="line"><span class="code">    private String uploadPath;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Value(&quot;$&#123;community.path.domain&#125;&quot;)</span></span><br><span class="line"><span class="code">    private String domain;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Value(&quot;$&#123;server.servlet.context-path&#125;&quot;)</span></span><br><span class="line"><span class="code">    private String contextPath;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private UserService userService;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private HostHolder hostHolder;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/setting&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">    public String getSettingPage() &#123;</span></span><br><span class="line"><span class="code">        return &quot;/site/setting&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/upload&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="code">    public String uploadHeader(MultipartFile headerImage, Model model) &#123;</span></span><br><span class="line"><span class="code">        if (headerImage == null) &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;error&quot;, &quot;您还没有选择图片!&quot;);</span></span><br><span class="line"><span class="code">            return &quot;/site/setting&quot;;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        String fileName = headerImage.getOriginalFilename();</span></span><br><span class="line"><span class="code">        String suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));</span></span><br><span class="line"><span class="code">        if (StringUtils.isBlank(suffix)) &#123;</span></span><br><span class="line"><span class="code">            model.addAttribute(&quot;error&quot;, &quot;文件的格式不正确!&quot;);</span></span><br><span class="line"><span class="code">            return &quot;/site/setting&quot;;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 生成随机文件名</span></span><br><span class="line"><span class="code">        fileName = CommunityUtil.generateUUID() + suffix;</span></span><br><span class="line"><span class="code">        // 确定文件存放的路径</span></span><br><span class="line"><span class="code">        File dest = new File(uploadPath + &quot;/&quot; + fileName);</span></span><br><span class="line"><span class="code">        try &#123;</span></span><br><span class="line"><span class="code">            // 存储文件</span></span><br><span class="line"><span class="code">            headerImage.transferTo(dest);</span></span><br><span class="line"><span class="code">        &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="code">            logger.error(&quot;上传文件失败: &quot; + e.getMessage());</span></span><br><span class="line"><span class="code">            throw new RuntimeException(&quot;上传文件失败,服务器发生异常!&quot;, e);</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // 更新当前用户的头像的路径(web访问路径)</span></span><br><span class="line"><span class="code">        // http://localhost:8080/community/user/header/xxx.png</span></span><br><span class="line"><span class="code">        User user = hostHolder.getUser();</span></span><br><span class="line"><span class="code">        String headerUrl = domain + contextPath + &quot;/user/header/&quot; + fileName;</span></span><br><span class="line"><span class="code">        userService.updateHeader(user.getId(), headerUrl);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        return &quot;redirect:/index&quot;;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @RequestMapping(path = &quot;/header/&#123;fileName&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="code">    public void getHeader(@PathVariable(&quot;fileName&quot;) String fileName, HttpServletResponse response) &#123;</span></span><br><span class="line"><span class="code">        // 服务器存放路径</span></span><br><span class="line"><span class="code">        fileName = uploadPath + &quot;/&quot; + fileName;</span></span><br><span class="line"><span class="code">        // 文件后缀</span></span><br><span class="line"><span class="code">        String suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;));</span></span><br><span class="line"><span class="code">        // 响应图片</span></span><br><span class="line"><span class="code">        response.setContentType(&quot;image/&quot; + suffix);</span></span><br><span class="line"><span class="code">        try (</span></span><br><span class="line"><span class="code">                FileInputStream fis = new FileInputStream(fileName);</span></span><br><span class="line"><span class="code">                OutputStream os = response.getOutputStream();</span></span><br><span class="line"><span class="code">        ) &#123;</span></span><br><span class="line"><span class="code">            byte[] buffer = new byte[1024];</span></span><br><span class="line"><span class="code">            int b = 0;</span></span><br><span class="line"><span class="code">            while ((b = fis.read(buffer)) != -1) &#123;</span></span><br><span class="line"><span class="code">                os.write(buffer, 0, b);</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">        &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="code">            logger.error(&quot;读取头像失败: &quot; + e.getMessage());</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section"># 获取头像</span></span><br></pre></td></tr></table></figure>
<h4><span id="2-8-检查登录状态">2-8 检查登录状态</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">• 使用拦截器</span><br><span class="line">- 在方法前标注自定义注解</span><br><span class="line">- 拦截所有请求，只处理带有该注解的方法</span><br><span class="line">• 自定义注解</span><br><span class="line">- 常用的元注解：</span><br><span class="line">@Target、@Retention、@Document、@Inherited</span><br><span class="line">- 如何读取注解：</span><br><span class="line">Method.getDeclaredAnnotations​()</span><br><span class="line">Method.getAnnotation​(Class<span class="tag">&lt;<span class="name">T</span>&gt;</span> annotationClass)</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">自定义注解</span><br><span class="line">拦截器</span><br></pre></td></tr></table></figure>
<h5><span id="代码">代码</span></h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 自定义注解</span></span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface LoginRequired &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section"># 拦截器</span></span><br><span class="line">@Component</span><br><span class="line">public class LoginRequiredInterceptor implements HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line"><span class="code">    @Autowired</span></span><br><span class="line"><span class="code">    private HostHolder hostHolder;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    @Override</span></span><br><span class="line"><span class="code">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span></span><br><span class="line"><span class="code">        if (handler instanceof HandlerMethod) &#123;</span></span><br><span class="line"><span class="code">            HandlerMethod handlerMethod = (HandlerMethod) handler;</span></span><br><span class="line"><span class="code">            Method method = handlerMethod.getMethod();</span></span><br><span class="line"><span class="code">            LoginRequired loginRequired = method.getAnnotation(LoginRequired.class);</span></span><br><span class="line"><span class="code">            if (loginRequired != null &amp;&amp; hostHolder.getUser() == null) &#123;</span></span><br><span class="line"><span class="code">                response.sendRedirect(request.getContextPath() + &quot;/login&quot;);</span></span><br><span class="line"><span class="code">                return false;</span></span><br><span class="line"><span class="code">            &#125;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">        return true;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">registry.addInterceptor(loginRequiredInterceptor)</span><br><span class="line"><span class="code">        .excludePathPatterns(&quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.png&quot;, &quot;/**/*.jpg&quot;, &quot;/**/*.jpeg&quot;);</span></span><br></pre></td></tr></table></figure>
<h3><span id="3-核心功能">3 核心功能</span></h3><h4><span id="3-1-过滤敏感词">3-1 过滤敏感词</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">• 前缀树</span><br><span class="line">- 名称：Trie、字典树、查找树</span><br><span class="line">- 特点：查找效率高，消耗内存大</span><br><span class="line">- 应用：字符串检索、词频统计、字符串排序等</span><br><span class="line">• 敏感词过滤器</span><br><span class="line">- 定义前缀树</span><br><span class="line">- 根据敏感词，初始化前缀树</span><br><span class="line">- 编写过滤敏感词的方法</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">如果使用jdk的字符串替换api 性能太差 用自己实现的前缀树进行过滤</span><br><span class="line"></span><br><span class="line"><span class="section"># 思想讲解</span></span><br><span class="line">1 定义敏感词 abc,bf,be </span><br><span class="line">2 由敏感词构造前缀树（根节点空 标记）</span><br><span class="line">3 输入字符串 三个指针（两个指针指定一个单词，一个指针扫前缀树）</span><br><span class="line">4 示例过程 20min（以字符为单位，任意语言都可以）</span><br><span class="line"></span><br><span class="line"><span class="section"># 实现</span></span><br><span class="line">1 用文本记录敏感词</span><br><span class="line">2 工具类（敏感词过滤器）</span><br><span class="line">2.1 前缀树节点类（关键词结束标识 子节点--字符到节点的map 添加子节点方法 获取子节点方法</span><br><span class="line">2.2 初始化前缀树 根节点-替换符 init（字节流--字符缓冲流 遍历每个敏感词加入到前缀树）添加方法（传入敏感词 遍历每个字符）</span><br><span class="line">2.3 过滤方法（传入文本 判空 三个指针 判断是否为普通字符 逻辑）</span><br><span class="line">3 测试</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/pro-00/20211002095626161.png" alt></p>
<h5><span id="代码">代码</span></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(SensitiveFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 替换符</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REPLACEMENT = <span class="string">&quot;***&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根节点</span></span><br><span class="line">    <span class="keyword">private</span> TrieNode rootNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                InputStream is = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;sensitive-words.txt&quot;</span>);</span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">        ) &#123;</span><br><span class="line">            String keyword;</span><br><span class="line">            <span class="keyword">while</span> ((keyword = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 添加到前缀树</span></span><br><span class="line">                <span class="keyword">this</span>.addKeyword(keyword);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;加载敏感词文件失败: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将一个敏感词添加到前缀树中</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addKeyword</span><span class="params">(String keyword)</span> </span>&#123;</span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; keyword.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = keyword.charAt(i);</span><br><span class="line">            TrieNode subNode = tempNode.getSubNode(c);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (subNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 初始化子节点</span></span><br><span class="line">                subNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line">                tempNode.addSubNode(c, subNode);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 指向子节点,进入下一轮循环</span></span><br><span class="line">            tempNode = subNode;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置结束标识</span></span><br><span class="line">            <span class="keyword">if</span> (i == keyword.length() - <span class="number">1</span>) &#123;</span><br><span class="line">                tempNode.setKeywordEnd(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 过滤敏感词</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text 待过滤的文本</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 过滤后的文本</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filter</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指针1</span></span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="comment">// 指针2</span></span><br><span class="line">        <span class="keyword">int</span> begin = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 指针3</span></span><br><span class="line">        <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 结果</span></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (position &lt; text.length()) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = text.charAt(position);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 跳过符号</span></span><br><span class="line">            <span class="keyword">if</span> (isSymbol(c)) &#123;</span><br><span class="line">                <span class="comment">// 若指针1处于根节点,将此符号计入结果,让指针2向下走一步</span></span><br><span class="line">                <span class="keyword">if</span> (tempNode == rootNode) &#123;</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                    begin++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 无论符号在开头或中间,指针3都向下走一步</span></span><br><span class="line">                position++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 检查下级节点</span></span><br><span class="line">            tempNode = tempNode.getSubNode(c);</span><br><span class="line">            <span class="keyword">if</span> (tempNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 以begin开头的字符串不是敏感词</span></span><br><span class="line">                sb.append(text.charAt(begin));</span><br><span class="line">                <span class="comment">// 进入下一个位置</span></span><br><span class="line">                position = ++begin;</span><br><span class="line">                <span class="comment">// 重新指向根节点</span></span><br><span class="line">                tempNode = rootNode;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tempNode.isKeywordEnd()) &#123;</span><br><span class="line">                <span class="comment">// 发现敏感词,将begin~position字符串替换掉</span></span><br><span class="line">                sb.append(REPLACEMENT);</span><br><span class="line">                <span class="comment">// 进入下一个位置</span></span><br><span class="line">                begin = ++position;</span><br><span class="line">                <span class="comment">// 重新指向根节点</span></span><br><span class="line">                tempNode = rootNode;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 检查下一个字符</span></span><br><span class="line">                position++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将最后一批字符计入结果</span></span><br><span class="line">        sb.append(text.substring(begin));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是否为符号</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isSymbol</span><span class="params">(Character c)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 0x2E80~0x9FFF 是东亚文字范围</span></span><br><span class="line">        <span class="keyword">return</span> !CharUtils.isAsciiAlphanumeric(c) &amp;&amp; (c &lt; <span class="number">0x2E80</span> || c &gt; <span class="number">0x9FFF</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前缀树</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关键词结束标识</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isKeywordEnd = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 子节点(key是下级字符,value是下级节点)</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;Character, TrieNode&gt; subNodes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isKeywordEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> isKeywordEnd;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKeywordEnd</span><span class="params">(<span class="keyword">boolean</span> keywordEnd)</span> </span>&#123;</span><br><span class="line">            isKeywordEnd = keywordEnd;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加子节点</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubNode</span><span class="params">(Character c, TrieNode node)</span> </span>&#123;</span><br><span class="line">            subNodes.put(c, node);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取子节点</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">getSubNode</span><span class="params">(Character c)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> subNodes.get(c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4><span id="3-2-发布帖子">3-2 发布帖子</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">• AJAX</span><br><span class="line">- Asynchronous JavaScript and XML</span><br><span class="line">- 异步的JavaScript与XML，不是一门新技术，只是一个新的术语。</span><br><span class="line">- 使用AJAX，网页能够将增量更新呈现在页面上，而不需要刷新整个页面。</span><br><span class="line">- 虽然X代表XML，但目前JSON的使用比XML更加普遍。</span><br><span class="line">- https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX</span><br><span class="line">• 示例</span><br><span class="line">- 使用jQuery发送AJAX请求。</span><br><span class="line">• 实践</span><br><span class="line">- 采用AJAX请求，实现发布帖子的功能。</span><br></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># json处理--ajax</span></span><br><span class="line">1 引入 fastjson</span><br><span class="line">2 在CommunityUtil中编写json对象转换为字符串的方法（重载）</span><br><span class="line">3 AlphaController ajax示例  static/html/ajax-demo.html</span><br><span class="line"></span><br><span class="line"><span class="section"># 实现发布帖子功能</span></span><br><span class="line">1 discusspostmapper 增加帖子方法 xml中加上一个insert语句 </span><br><span class="line">2 帖子业务中 addDiscussPost</span><br><span class="line">2.1 判空</span><br><span class="line">2.2 对标题、内容进行转义处理（处理含有Html标签的内容）</span><br><span class="line">2.3 对标题、内容进行过滤敏感词处理 </span><br><span class="line">3 帖子Controller</span><br><span class="line">问题 为什么hostHolder能取代session的作用 作为存储当前用户的对象</span><br><span class="line">3.1 检查用户</span><br><span class="line">3.2 新增帖子</span><br><span class="line">4 页面</span><br><span class="line">4.1 index 弹出框 70多行 对发布按钮进行登录用户判定</span><br><span class="line">4.2 static/js/index.js publish方法</span><br><span class="line">4.2.1 弹出框隐藏</span><br><span class="line">4.2.2 获取标题和内容</span><br><span class="line">4.2.3 发布异步请求（显示返回消息 提示 刷新页面）</span><br></pre></td></tr></table></figure>
<h4><span id="3-3-帖子详情">3-3 帖子详情</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">• DiscussPostMapper</span><br><span class="line">根据id查询的方法 mapper</span><br><span class="line">• DiscussPostService</span><br><span class="line">findxxx 根据id查询</span><br><span class="line">• DiscussPostController</span><br><span class="line">getxxx 根据id查询 id参数 model返回携带信息</span><br><span class="line">注意，一个帖子需要关联用户信息，此处如何处理？</span><br><span class="line">（1）效率更好的方法是 sql中关联查询 效率高 但可能会造成业务冗余</span><br><span class="line">（2）在controller中单独再查询 效率低 后续可用缓存优化</span><br><span class="line">根据帖子的用户id查到用户，也需返回</span><br><span class="line">此处先不处理帖子的评论回复相关</span><br><span class="line">• index.html</span><br><span class="line">- 在帖子标题上增加访问详情页面的链接</span><br><span class="line">在帖子列表的超链接上进行修改</span><br><span class="line"></span><br><span class="line">• discuss-detail.html</span><br><span class="line">- 处理静态资源的访问路径</span><br><span class="line">- 复用index.html的header区域</span><br><span class="line">- 显示标题、作者、发布时间、帖子正文等内容</span><br><span class="line"></span><br><span class="line">帖子详情</span><br></pre></td></tr></table></figure>
<h4><span id="3-4-事务管理">3-4 事务管理</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">回顾</span><br><span class="line">• 什么是事务</span><br><span class="line">- 事务是由N步数据库操作序列组成的逻辑执行单元，这系列操作要么全执行，要么全放弃执行。</span><br><span class="line">• 事务的特性（ACID）</span><br><span class="line">- 原子性（Atomicity）：事务是应用中不可再分的最小执行体。</span><br><span class="line">- 一致性（Consistency）：事务执行的结果，须使数据从一个一致性状态，变为另一个一致性状态。</span><br><span class="line">- 隔离性（Isolation）：各个事务的执行互不干扰，任何事务的内部操作对其他的事务都是隔离的。</span><br><span class="line">- 持久性（Durability）：事务一旦提交，对数据所做的任何改变都要记录到永久存储器中。</span><br><span class="line"></span><br><span class="line">事务的隔离性</span><br><span class="line">• 常见的并发异常</span><br><span class="line">- 第一类丢失更新、第二类丢失更新。</span><br><span class="line">- 脏读、不可重复读、幻读。</span><br><span class="line">• 常见的隔离级别</span><br><span class="line">- Read Uncommitted：读取未提交的数据。</span><br><span class="line">- Read Committed：读取已提交的数据。</span><br><span class="line">- Repeatable Read：可重复读。</span><br><span class="line">- Serializable：串行化。</span><br><span class="line"></span><br><span class="line">第一类丢失更新</span><br><span class="line">某一个事务的回滚，</span><br><span class="line">导致另外一个事务已更新的数据丢失了。</span><br><span class="line"></span><br><span class="line">第二类丢失更新</span><br><span class="line">某一个事务的提交，</span><br><span class="line">导致另外一个事务已更新的数据丢失了。</span><br><span class="line"></span><br><span class="line">脏读</span><br><span class="line">某一个事务，</span><br><span class="line">读取了另外一个事务未提交的数据。</span><br><span class="line"></span><br><span class="line">不可重复读</span><br><span class="line">某一个事务，</span><br><span class="line">对同一个数据前后读取的结果不一致。</span><br><span class="line"></span><br><span class="line">幻读</span><br><span class="line">某一个事务，</span><br><span class="line">对同一个表前后查询到的行数不一致。</span><br><span class="line"></span><br><span class="line">事务隔离级别</span><br><span class="line">隔离级别 第一类丢失更新 脏读 第二类丢失更新 不可重复读 幻读</span><br><span class="line">Read Uncommitted Y Y Y Y Y</span><br><span class="line">Read Committed N N Y Y Y</span><br><span class="line">Repeatable Read N N N N Y</span><br><span class="line">Serializable N N N N N</span><br><span class="line"></span><br><span class="line">实现机制</span><br><span class="line">• 悲观锁（数据库）</span><br><span class="line">- 共享锁（S锁）</span><br><span class="line">事务A对某数据加了共享锁后，其他事务只能对该数据加共享锁，但不能加排他锁。</span><br><span class="line">- 排他锁（X锁）</span><br><span class="line">事务A对某数据加了排他锁后，其他事务对该数据既不能加共享锁，也不能加排他锁。</span><br><span class="line">• 乐观锁（自定义）</span><br><span class="line">- 版本号、时间戳等</span><br><span class="line">在更新数据前，检查版本号是否发生变化。若变化则取消本次更新，否则就更新数据（版本号+1）。</span><br><span class="line"></span><br><span class="line">Spring事务管理</span><br><span class="line">• 声明式事务</span><br><span class="line">- 通过XML配置，声明某方法的事务特征。</span><br><span class="line">- 通过注解，声明某方法的事务特征。</span><br><span class="line">• 编程式事务</span><br><span class="line">- 通过 TransactionTemplate 管理事务，</span><br><span class="line">并通过它执行数据库的操作。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">多线程环境下，多个环境下同时访问同一数据</span><br><span class="line">隔离级别一般选中间两种</span><br><span class="line"></span><br><span class="line"># Spring事务测试</span><br><span class="line">Alpha业务中 save1 新增用户 新增帖子  </span><br><span class="line">注解：隔离机制 传播机制（业务方法相互调用）</span><br><span class="line">事务测试类 完整回滚</span><br><span class="line"></span><br><span class="line">编程式事务 save2</span><br></pre></td></tr></table></figure>
<h4><span id="3-5-显示评论">3-5 显示评论</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">• 数据层</span><br><span class="line">- 根据实体查询一页评论数据。</span><br><span class="line">- 根据实体查询评论的数量。</span><br><span class="line">• 业务层</span><br><span class="line">- 处理查询评论的业务。</span><br><span class="line">处理查询评论数量的业务。</span><br><span class="line">• 表现层</span><br><span class="line">- 显示帖子详情数据时，</span><br><span class="line">同时显示该帖子所有的评论数据。</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">18</span><br><span class="line"><span class="section"># 评论表</span></span><br><span class="line">可以对帖子评论 可以对评论评论</span><br><span class="line">1 设计一个entity<span class="emphasis">_type 对应评论的对象 entity_</span>id target<span class="emphasis">_id是在回复某个回复时要指明针对的对象</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 实体类 Mapper</span></span><br><span class="line"><span class="emphasis">1 实体类</span></span><br><span class="line"><span class="emphasis">2 方法：根据评论的对象查询评论、数量（分页辅助） </span></span><br><span class="line"><span class="emphasis">3 xml </span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 业务 控制器</span></span><br><span class="line"><span class="emphasis">1 业务 两个方法</span></span><br><span class="line"><span class="emphasis">2 控制器 getDiscussPost 获取评论分页信息</span></span><br><span class="line"><span class="emphasis">+ 每个帖子有一个字段评论数量 实体类型 </span></span><br><span class="line"><span class="emphasis">+ 对每个评论，需要和用户关联 再逐一查询 和index帖子列表类似</span></span><br><span class="line"><span class="emphasis">+ 评论的评论（回复）查所有 回复列表 对其也要设置一个Vo列表 比较特殊的是有一个指向性，回复的目标，普通的回复即回复评论target_</span>id=0，特殊的是回复回复的回复，那么需要一个目标用户，vo里还需加一个键值对</span><br><span class="line"><span class="bullet">+</span> 帖子有评论数量字段 但评论的回复数量就需要单独查了</span><br><span class="line"></span><br><span class="line"><span class="section"># 页面</span></span><br><span class="line">1 index.html 帖子列表 回帖数</span><br><span class="line">2 帖子详情页 内容--回帖部分 回帖数量-回帖列表 基本--回复列表 特殊处理目标用户--回复回复的回复的情况 id</span><br><span class="line">3 复用分页</span><br></pre></td></tr></table></figure>
<h4><span id="3-6-添加评论">3-6 添加评论</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">• 数据层</span><br><span class="line">- 增加评论数据。</span><br><span class="line">- 修改帖子的评论数量。</span><br><span class="line">• 业务层</span><br><span class="line">- 处理添加评论的业务：</span><br><span class="line">先增加评论、再更新帖子的评论数量。</span><br><span class="line">• 表现层</span><br><span class="line">- 处理添加评论数据的请求。</span><br><span class="line">- 设置添加评论的表单</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">19</span><br><span class="line">1 comment mapper xml  insert方法</span><br><span class="line">2 帖子 mapper xml 更新评论数量方法</span><br><span class="line">  帖子 service 更新评论数量方法</span><br><span class="line">3 评论 业务 增加评论方法（包含事务管理）</span><br><span class="line">3.1 参数判空</span><br><span class="line">3.2 评论 转义 敏感词过滤</span><br><span class="line">3.3 存入数据库</span><br><span class="line">3.4 更新评论数量（需要判断是帖子的评论，即需要判断entity<span class="emphasis">_type，然后查到对应的帖子实体，调用帖子的更新评论数量业务方法进行更新）</span></span><br><span class="line"><span class="emphasis">4 评论 controller 新增方法</span></span><br><span class="line"><span class="emphasis">5 页面</span></span><br><span class="line"><span class="emphasis">评论详情页</span></span><br><span class="line"><span class="emphasis">5.1 回帖输入部分（表单 method action 文本域 隐藏域/两个entity_</span>xxx）</span><br><span class="line">5.2 回复输入框（和5.1同 区别是针对的对象是评论/回复 还需要携带targetId 提示回复给xxx）</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h4><span id="3-7-私信列表">3-7 私信列表</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">• 私信列表</span><br><span class="line">- 查询当前用户的会话列表，</span><br><span class="line">每个会话只显示一条最新的私信。</span><br><span class="line">- 支持分页显示。</span><br><span class="line">• 私信详情</span><br><span class="line">- 查询某个会话所包含的私信。</span><br><span class="line">- 支持分页显示。</span><br></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">20</span><br><span class="line"><span class="section"># 表 message</span></span><br><span class="line">from<span class="emphasis">_id to_</span>id 会话id（规则，小id<span class="emphasis">_大id）</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 实现</span></span><br><span class="line"><span class="emphasis">1 Message实体</span></span><br><span class="line"><span class="emphasis">2 MessageMapper（5个方法）xml</span></span><br><span class="line"><span class="emphasis">（1）查询用户会话列表（分页）</span></span><br><span class="line"><span class="emphasis">（2）会话数量</span></span><br><span class="line"><span class="emphasis">（3）查询某个会话包含的私信列表</span></span><br><span class="line"><span class="emphasis">（4）查询某个会话包含的私信数量</span></span><br><span class="line"><span class="emphasis">（5）查询未读的私信的数量</span></span><br><span class="line"><span class="emphasis">xml</span></span><br><span class="line"><span class="emphasis">1/查询时status=2表删除 from_</span>id=1表系统通知</span><br><span class="line">3 Mapper测试</span><br><span class="line">4 业务message 5</span><br><span class="line">5 controller 私信列表 私信详情 注意逻辑</span><br><span class="line">6 页面</span><br><span class="line">6.1 index.html 消息链接</span><br><span class="line">6.2 letter.html</span><br><span class="line">引入css js 首部</span><br><span class="line">选项卡部分（链接 未读消息）</span><br><span class="line"><span class="section">私信列表</span></span><br><span class="line"><span class="section">-------------</span></span><br><span class="line">letter.html 详情链接</span><br><span class="line">6.3 私信详情页面</span><br><span class="line">目标用户</span><br><span class="line">私信列表</span><br><span class="line">返回和js方法</span><br></pre></td></tr></table></figure>
<p><img src="/pro-00/20211002090128565.png" alt></p>
<h4><span id="3-8-发送私信">3-8 发送私信</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">• 发送私信</span><br><span class="line">- 采用异步的方式发送私信。</span><br><span class="line">- 发送成功后刷新私信列表。</span><br><span class="line">• 设置已读</span><br><span class="line">- 访问私信详情时，</span><br><span class="line">将显示的私信设置为已读状态。</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">21</span><br><span class="line"># 两个地方可以发起私信</span><br><span class="line"># 进入私信详情，修改私信状态</span><br><span class="line"></span><br><span class="line"># 实现</span><br><span class="line">1 mapper 新增消息 修改消息状态</span><br><span class="line">2 业务 需要过滤 add read</span><br><span class="line">3 controller 异步send 用户业务补充一个根据用户名查询用户的方法 修改状态</span><br><span class="line">3.1 根据用户名查到发送的用户对象</span><br><span class="line">3.2 构造私信对象 from to 会话</span><br><span class="line">4 页面</span><br><span class="line">4.1 letter.js里send_letter方法</span><br><span class="line">4.2 私信详情页处理</span><br></pre></td></tr></table></figure>
<h4><span id="3-9-统一处理异常">3-9 统一处理异常</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">• @ControllerAdvice</span><br><span class="line">- 用于修饰类，表示该类是Controller的全局配置类。</span><br><span class="line">- 在此类中，可以对Controller进行如下三种全局配置：</span><br><span class="line">异常处理方案、绑定数据方案、绑定参数方案。</span><br><span class="line">• @ExceptionHandler</span><br><span class="line">- 用于修饰方法，该方法会在Controller出现异常后被调用，用于处理捕获到的异常。</span><br><span class="line">• @ModelAttribute</span><br><span class="line">- 用于修饰方法，该方法会在Controller方法执行前被调用，用于为Model对象绑定参数。</span><br><span class="line">• @DataBinder</span><br><span class="line">- 用于修饰方法，该方法会在Controller方法执行前被调用，用于绑定参数的转换器。</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 错误页面模板 templates/error 自动跳转</span><br><span class="line">2 HomeController/getErrorPage</span><br><span class="line">3 异常处理类 区分处理异步请求和普通请求</span><br></pre></td></tr></table></figure>

<h4><span id="3-10-统一处理日志针对业务组件">3-10 统一处理日志（针对业务组件）</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">AOP的概念</span><br><span class="line">• Aspect Oriented Programing，</span><br><span class="line">即面向方面（切面）编程。</span><br><span class="line">• AOP是一种编程思想，是对OOP的补充，</span><br><span class="line">可以进一步提高编程的效率。</span><br><span class="line"></span><br><span class="line">AOP的实现</span><br><span class="line">• AspectJ</span><br><span class="line">- AspectJ是语言级的实现，它扩展了Java语言，定义了AOP语法。</span><br><span class="line">- AspectJ在编译期织入代码，它有一个专门的编译器，用来生成遵守Java字节码规范的class文件。</span><br><span class="line">• Spring AOP</span><br><span class="line">- Spring AOP使用纯Java实现，它不需要专门的编译过程，也不需要特殊的类装载器。</span><br><span class="line">- Spring AOP在运行时通过代理的方式织入代码，只支持方法类型的连接点。</span><br><span class="line">- Spring支持对AspectJ的集成。</span><br><span class="line"></span><br><span class="line">Spring AOP</span><br><span class="line">• JDK动态代理</span><br><span class="line">- Java提供的动态代理技术，可以在运行时创建接口的代理实例。</span><br><span class="line">- Spring AOP默认采用此种方式，在接口的代理实例中织入代码。</span><br><span class="line">• CGLib动态代理</span><br><span class="line">- 采用底层的字节码技术，在运行时创建子类代理实例。</span><br><span class="line">- 当目标对象不存在接口时，Spring AOP会采用此种方式，在子类实例中织入代码。</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">拦截器等和上述方法是针对controller的</span><br><span class="line">对于业务组件来说，不应该把记录日志的代码在每个地方都明写出来（硬编码）</span><br><span class="line"></span><br><span class="line">目标对象 joinpoint 切面组件</span><br><span class="line"></span><br><span class="line">两个类</span><br></pre></td></tr></table></figure>

<h3><span id="四-redis缓存">四 Redis缓存</span></h3><h4><span id="41-redis入门">4.1 Redis入门</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">• Redis是一款基于键值对的NoSQL数据库，它的值支持多种数据结构：</span><br><span class="line">字符串(strings)、哈希(hashes)、列表(lists)、集合(sets)、有序集合(sorted sets)等。</span><br><span class="line">• Redis将所有的数据都存放在内存中，所以它的读写性能十分惊人。</span><br><span class="line">同时，Redis还可以将内存中的数据以快照或日志的形式保存到硬盘上，以保证数据的安全性。</span><br><span class="line">• Redis典型的应用场景包括：缓存、排行榜、计数器、社交网络、消息队列等。</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">1 快照存储 完全存储 不能实时</span><br><span class="line">2 日志存储AOF 实时命令 追加</span><br><span class="line">3 主要是 数据结构--对应命令</span><br><span class="line"></span><br><span class="line">--------</span><br><span class="line">常用命令</span><br><span class="line">select n</span><br><span class="line">flushdb</span><br><span class="line"><span class="quote">&gt; string</span></span><br><span class="line"></span><br><span class="line">set test:count 1</span><br><span class="line">get test:count</span><br><span class="line">incr test:count</span><br><span class="line">decr test:count</span><br><span class="line">hset test:user id 1</span><br><span class="line">hset test:user username zs</span><br><span class="line">hget test:user id</span><br><span class="line">lpush test:ids 101 102 103  列表左进右出 索引左到右递增</span><br><span class="line">llen test:ids</span><br><span class="line">lindex test:ids 0</span><br><span class="line">lindex test:ids 2</span><br><span class="line">lrange test:ids 0 2</span><br><span class="line">rpop test:ids</span><br><span class="line">sadd test:teachers aaa bbb cc dd eee</span><br><span class="line">scard test:teachers</span><br><span class="line">spop test:teachers</span><br><span class="line">smembers test:teachers</span><br><span class="line">zadd test:students 10 aaa 20 bbb 30 ccc 40 ddd</span><br><span class="line">zcard test:students</span><br><span class="line">zscore test:students ccc</span><br><span class="line">zrank test:students</span><br><span class="line">zrange test:students 0 2</span><br><span class="line">keys <span class="emphasis">*</span></span><br><span class="line"><span class="emphasis">keys test*</span></span><br><span class="line">type test:user</span><br><span class="line">exists key</span><br><span class="line">del key</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4><span id="42-spring整合redis">4.2 spring整合redis</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">• 引入依赖</span><br><span class="line">- spring-boot-starter-data-redis</span><br><span class="line">• 配置Redis</span><br><span class="line">- 配置数据库参数</span><br><span class="line">- 编写配置类，构造RedisTemplate</span><br><span class="line">• 访问Redis</span><br><span class="line">- redisTemplate.opsForValue()</span><br><span class="line">- redisTemplate.opsForHash()</span><br><span class="line">- redisTemplate.opsForList()</span><br><span class="line">- redisTemplate.opsForSet()</span><br><span class="line">- redisTemplate.opsForZSet()</span><br></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 依赖</span><br></pre></td></tr></table></figure>
<h2><span id="nk社区编写">nk社区（编写）</span></h2><blockquote>
<p>2021.9.22开始做这个社区项目，后面几天就以此为主要任务，做完为止。一个典型的crud的单体应用。</p>
</blockquote>
<h3><span id="0-框架与环境">0 框架与环境</span></h3><h3><span id="0-1-框架">0-1 框架</span></h3><p>装载bean<br>springmvc注解</p>
<h3><span id="0-2-数据库">0-2 数据库</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `salt` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0-普通用户; 1-超级管理员; 2-版主;&#x27;</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0-未激活; 1-已激活;&#x27;</span>,</span><br><span class="line">  `activation_code` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `header_url` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_username` (`username`(<span class="number">20</span>)),</span><br><span class="line">  KEY `index_email` (`email`(<span class="number">20</span>))</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">101</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `discuss_post` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` text,</span><br><span class="line">  `type` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0-普通; 1-置顶;&#x27;</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0-正常; 1-精华; 2-拉黑;&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `comment_count` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `score` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_user_id` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `message` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `from_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `to_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `conversation_id` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` text,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;0-未读;1-已读;2-删除;&#x27;</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_from_id` (`from_id`),</span><br><span class="line">  KEY `index_to_id` (`to_id`),</span><br><span class="line">  KEY `index_conversation_id` (`conversation_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `comment` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `entity_type` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `entity_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `target_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` text,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `create_time` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_user_id` (`user_id`) <span class="comment">/*!80000 INVISIBLE */</span>,</span><br><span class="line">  KEY `index_entity_id` (`entity_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `login_ticket` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ticket` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;0-有效; 1-无效;&#x27;</span>,</span><br><span class="line">  `expired` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_ticket` (`ticket`(<span class="number">20</span>))</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UserMapper</span><br><span class="line">    selectById</span><br><span class="line">    selectByName</span><br><span class="line">    selectByEmail</span><br><span class="line">    insertUser</span><br><span class="line">    updateStatus</span><br><span class="line">    updateHeader</span><br><span class="line">    updatePassword</span><br></pre></td></tr></table></figure>
<h3><span id="1-基本环境">1 基本环境</span></h3><h4><span id="1-1-用户实体相关">1-1 用户实体相关</span></h4><p>先看着敲一遍，然后自己写一遍，再对照，在此前先熟悉下数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `<span class="keyword">user</span>` (</span><br><span class="line">	`id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">	`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`password` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`salt` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`email` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`type` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`status` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`activation_code` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`header_url` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	`create_time` <span class="type">timestamp</span> <span class="keyword">null</span> <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">	<span class="keyword">primary</span> key(`id`),</span><br><span class="line">	key `index_username`(`username`(<span class="number">20</span>)),</span><br><span class="line">	key `index_email`(`email`(<span class="number">20</span>))</span><br><span class="line">) engine <span class="operator">=</span> innodb auto_increment<span class="operator">=</span><span class="number">101</span> <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编写测试完用户实体的总结</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">流程</span><br><span class="line">依赖：数据库驱动+mybatis</span><br><span class="line">配置：数据源 连接池配置</span><br><span class="line">实体</span><br><span class="line">mapper </span><br><span class="line">测试crud</span><br><span class="line"></span><br><span class="line">注意测试，用到容器中的bean 须用@SpringBootTest </span><br></pre></td></tr></table></figure>
<h4><span id="1-2-基本环境配置">1-2 基本环境配置</span></h4><ul>
<li>原始网页素材已经没有了，初始是配置好分页相关的</li>
<li>thymeleaf语法 <a target="_blank" rel="noopener" href="https://fanlychie.github.io/post/thymeleaf.html">https://fanlychie.github.io/post/thymeleaf.html</a></li>
<li>日志默认 logback-spring.xml</li>
</ul>
<h4><span id="1-3-帖子实体与分页实现">1-3 帖子实体与分页实现</span></h4><p>帖子实体 mapper<br>分页实体</p>
<blockquote>
<p>thymeleaf</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 帖子列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-unstyled&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;media pb-3 pt-3 mb-3 border-bottom&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;map:$&#123;discussPosts&#125;&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;site/profile.html&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;map.user.headerUrl&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mr-4 rounded-circle&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;用户头像&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:50px;height:50px;&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;media-body&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h6</span> <span class="attr">class</span>=<span class="string">&quot;mt-0 mb-3&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;map.post.title&#125;&quot;</span>&gt;</span>备战春招，面试刷题跟他复习，一个月全搞定！<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary bg-primary&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;map.post.type==1&#125;&quot;</span>&gt;</span>置顶<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary bg-danger&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;map.post.status==1&#125;&quot;</span>&gt;</span>精华<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font-size-12&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">u</span> <span class="attr">class</span>=<span class="string">&quot;mr-3&quot;</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;map.user.username&#125;&quot;</span>&gt;</span>寒江雪<span class="tag">&lt;/<span class="name">u</span>&gt;</span> 发布于 <span class="tag">&lt;<span class="name">b</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(map.post.createTime,&#x27;yyyy-MM-dd HH:mm:ss&#x27;)&#125;&quot;</span>&gt;</span>2019-04-15 15:32:18<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;d-inline float-right&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;d-inline ml-2&quot;</span>&gt;</span>赞 11<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;d-inline ml-2&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;d-inline ml-2&quot;</span>&gt;</span>回帖 7<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span>						</span><br><span class="line">	<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 分页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;mt-5&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;page.rows&gt;0&#125;&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination justify-content-center&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;$&#123;page.path&#125;(current=1)&#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">th:class</span>=<span class="string">&quot;|page-item $&#123;page.current==1?&#x27;disabled&#x27;:&#x27;&#x27;&#125;|&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;$&#123;page.path&#125;(current=$&#123;page.current-1&#125;)&#125;&quot;</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">th:class</span>=<span class="string">&quot;|page-item $&#123;i==page.current?&#x27;active&#x27;:&#x27;&#x27;&#125;|&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;i:$&#123;#numbers.sequence(page.from,page.to)&#125;&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;$&#123;page.path&#125;(current=$&#123;i&#125;)&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;i&#125;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">th:class</span>=<span class="string">&quot;|page-item $&#123;page.current==page.total?&#x27;disabled&#x27;:&#x27;&#x27;&#125;|&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;$&#123;page.path&#125;(current=$&#123;page.current+1&#125;)&#125;&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;page-item&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;page-link&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;$&#123;page.path&#125;(current=$&#123;page.total&#125;)&#125;&quot;</span>&gt;</span>末页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">涉及到对象及运算的都用$&#123;&#125;</span><br><span class="line">th:href=@&#123;$&#123;&#125;()&#125;</span><br><span class="line">th:class=&quot;||&quot;</span><br><span class="line">th:each=&quot;map:$&#123;&#125;&quot;</span><br><span class="line">th:text=&quot;&quot;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分页测试<br>报错 There is no getter for property named ‘userId’ in ‘class java.lang.Integer’<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_30604989/article/details/81297400">https://blog.csdn.net/qq_30604989/article/details/81297400</a></p>
</blockquote>
<h3><span id="2-登录模块">2 登录模块</span></h3><h4><span id="2-1-邮件功能">2-1 邮件功能</span></h4><p>注意测试时有延迟，可能需要几分钟才能发送成功<br>参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/breakaway_01/article/details/111474564">https://blog.csdn.net/breakaway_01/article/details/111474564</a></p>
<h4><span id="2-2-注册">2-2 注册</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">th:fragment=&quot;header&quot;</span><br><span class="line">th:href=&quot;@&#123;/index&#125;&quot;</span><br><span class="line">th:replace=&quot;index::header&quot;</span><br></pre></td></tr></table></figure>
<h4><span id="2-3-问题">2-3 问题</span></h4><p>thymeleaf找不到页面的问题<br>注意@Controller配置<br>@Slf4j<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6e137ee836a1">https://www.jianshu.com/p/6e137ee836a1</a></p>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/21/ls-tree/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="ls树相关" class="lazyload">
                    <h1>ls树相关</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月21日</a>
            <a><i class="nexmoefont icon-areachart"></i>0 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/20/sql-00/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="SQL相关" class="lazyload">
                    <h1>SQL相关</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月20日</a>
            <a><i class="nexmoefont icon-areachart"></i>36 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <p>sql相关的问题与练习</p>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/20/ry-00/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="儒猿面试之一" class="lazyload">
                    <h1>儒猿面试之一</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月20日</a>
            <a><i class="nexmoefont icon-areachart"></i>24 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <blockquote>
<p>中华石杉面试专题 高频考题篇</p>
</blockquote>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/15/test-qa/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="test-qa" class="lazyload">
                    <h1>test-qa</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月15日</a>
            <a><i class="nexmoefont icon-areachart"></i>153 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <h2><span id="mysql">mysql</span></h2><p>Navicat运行SQL文件出错<br><a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/525156367906044565.html">https://zhidao.baidu.com/question/525156367906044565.html</a></p>
<h2><span id="计算机网络">计算机网络</span></h2><p>TCP中的seq 什么意思<br><a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/346839619.html">https://zhidao.baidu.com/question/346839619.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/vvull/p/10597881.html">https://www.cnblogs.com/vvull/p/10597881.html</a></p>
<h2><span id="项目">项目</span></h2><p>创建springboot项目不成功的问题（网络连接）</p>
<ul>
<li>网络换成热点（不一定）</li>
<li>创建不成功 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_26071319/article/details/106209405">https://blog.csdn.net/qq_26071319/article/details/106209405</a><br><a target="_blank" rel="noopener" href="http://start.aliyun.com">http://start.aliyun.com</a> 代理</li>
<li>pom报红<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/feifeiwuxian/article/details/109334101">https://blog.csdn.net/feifeiwuxian/article/details/109334101</a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>阿里云公共仓库<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41205651/article/details/114854831">https://blog.csdn.net/qq_41205651/article/details/114854831</a><br><code>File -&gt; Invalidate Caches / Restart... -&gt; Invalidate and Restart</code></li>
</ul>

            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2021/09/13/jf/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="jf" class="lazyload">
                    <h1>jf</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2021年09月13日</a>
            <a><i class="nexmoefont icon-areachart"></i>72 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <blockquote>
<p>java框架的基本概念与使用相关 ssm springboot等</p>
</blockquote>
<h2><span id="mybatis">mybatis</span></h2><p>配置解析<br>映射文件和注解<br>动态sql<br>复杂实体关系<br>缓存</p>
<h2><span id="spring">spring</span></h2><p>控制反转 依赖注入<br>代理模式 AOP<br>整合<br>声明式事务</p>
<h2><span id="springmvc">springmvc</span></h2><p>dispatcherServlet原理<br> restful<br> 请求参数<br> 返回<br> 乱码<br> json</p>

            
        </article>
    </div>
    
</section>

    <nav class="nexmoe-page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/archives/2021/page/2/">2</a><a class="page-number" href="/archives/2021/page/3/">3</a><a class="extend next" rel="next" href="/archives/2021/page/2/"><i class="nexmoefont icon-right"></i></a>
    </nav>
  
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1633359246553"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/violet.model.json"},"display":{"position":"left","width":180,"height":360},"mobile":{"show":true},"log":false});</script></body>

</html>
