<!DOCTYPE html>

<html lang="zh">

<head>
    
    <title>java-spider-1 - Memory</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" type="image/x-icon" />
    <meta name="description" content="本文总结刚学习的两种java实现爬虫的方式：HttpClient获取网页内容 + Jsoup&#x2F;Xpath&#x2F;正则解析和使用WebMagic框架实现解析。需要注意的是，无论哪种实现方式，除了单独写爬虫外，都可以直接嵌入web框架中，嵌入SpringBoot框架可以直接启动运行，也可以嵌入ssm写的web项目中。">
<meta property="og:type" content="article">
<meta property="og:title" content="java-spider-1">
<meta property="og:url" content="https://shadowbynl.github.io/2020/06/16/java-spider-1/index.html">
<meta property="og:site_name" content="Memory">
<meta property="og:description" content="本文总结刚学习的两种java实现爬虫的方式：HttpClient获取网页内容 + Jsoup&#x2F;Xpath&#x2F;正则解析和使用WebMagic框架实现解析。需要注意的是，无论哪种实现方式，除了单独写爬虫外，都可以直接嵌入web框架中，嵌入SpringBoot框架可以直接启动运行，也可以嵌入ssm写的web项目中。">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2020/06/16/GjHWOl6heTFb71c.png">
<meta property="og:image" content="https://i.loli.net/2020/06/16/PAmyDrgULG82Sit.png">
<meta property="og:image" content="https://i.loli.net/2020/06/16/liSsE5NBVFzqPAK.png">
<meta property="og:image" content="https://i.loli.net/2020/06/16/gVsD8ub4IFpUnE7.png">
<meta property="og:image" content="https://i.loli.net/2020/06/16/DLm415PZqCgTBMF.png">
<meta property="og:image" content="https://i.loli.net/2020/06/16/yQZHNRvdnm5spbr.png">
<meta property="og:image" content="https://i.loli.net/2020/06/16/i2KO6QUGLSjXcTd.png">
<meta property="article:published_time" content="2020-06-16T12:52:02.000Z">
<meta property="article:modified_time" content="2020-06-16T14:58:20.571Z">
<meta property="article:author" content="nlby">
<meta property="article:tag" content="JavaWeb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/06/16/GjHWOl6heTFb71c.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1633604899808">
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1633604899808">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="nlby" class="mdui-btn mdui-btn-icon"><img src="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" alt="nlby"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="nlby">
            <img src="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" alt="nlby" alt="nlby">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>74</div>
        <div><span>Tags</span>13</div>
        <div><span>Categories</span>29</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="Search" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/?_wv=1027&k=5CfKHun" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/33077945" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/shadowbynl/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Flask/">Flask</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ORM/">ORM</a>
          <span class="category-list-count">7</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Web框架/">Web框架</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/css/">css</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/java/">java</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/写法/">写法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/功能点学习/">功能点学习</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/基础/">基础</a>
          <span class="category-list-count">20</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/大四/">大四</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/安全/">安全</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/容器/">容器</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/工具/">工具</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/工具使用/">工具使用</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/数据/">数据</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/数据可视化/">数据可视化</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/测试/">测试</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/爬虫/">爬虫</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/环境/">环境</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/知识点总结/">知识点总结</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/移动布局/">移动布局</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/算法/">算法</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/规划/">规划</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/记录/">记录</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/语法/">语法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随机/">随机</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随笔/">随笔</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随记/">随记</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/面试/">面试</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/项目/">项目</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Go/" style="font-size: 16.67px;">Go</a> <a href="/tags/JavaWeb/" style="font-size: 20px;">JavaWeb</a> <a href="/tags/PythonWeb/" style="font-size: 15px;">PythonWeb</a> <a href="/tags/android/" style="font-size: 18.33px;">android</a> <a href="/tags/javase/" style="font-size: 10px;">javase</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/%E4%B8%93%E4%B8%9A%E8%AF%BE/" style="font-size: 11.67px;">专业课</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 13.33px;">前端</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 11.67px;">区块链</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 10px;">总结</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正则表达式</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">版本控制</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
    
  </div>

    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">51</span></li></ul>
    </div>
  </div>



    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 nlby
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><embed src="https://jxiaoc.github.io/animeMusic/demo.html" width="100%"/>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 66.66666666666666%;"> 
              <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="java-spider-1" class="lazyload">
              <h1>java-spider-1</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年06月16日</a>
    <a><i class="nexmoefont icon-areachart"></i>8.4k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 40 分钟</a>
</div>

      

      <p>本文总结刚学习的两种java实现爬虫的方式：HttpClient获取网页内容 + Jsoup/Xpath/正则解析和使用WebMagic框架实现解析。需要注意的是，无论哪种实现方式，除了单独写爬虫外，都可以直接嵌入web框架中，嵌入SpringBoot框架可以直接启动运行，也可以嵌入ssm写的web项目中。</p>
<span id="more"></span>
<h4><span id="一不使用框架的以httpclient为基础的实现方式">（一）不使用框架的以HttpClient为基础的实现方式</span></h4><p>相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- HttpClient --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 日志 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--&lt;scope&gt;test&lt;/scope&gt;--&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- jsoup解析 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.jsoup/jsoup --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 文件处理相关 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-io/commons-io --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- 字符串处理相关 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.dom4j/dom4j --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- xpath解析 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>一、HttpClient</strong><br>HttpClient是Java爬虫实现的底层基础，拥有按照需要设置请求方式、参数、信息、配置的功能，获取响应内容，供其他类进行解析。</p>
<ol>
<li>get请求<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpGetTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line">        <span class="comment">//创建HttpClient对象</span></span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class="line">        <span class="comment">//创建HttpGet对象，设置url访问地址</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line">        <span class="comment">//设置User-Agent</span></span><br><span class="line">        httpGet.setHeader(<span class="string">&quot;user-agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.87 Safari/537.36&quot;</span>);</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//使用HttpClient发起请求，获取response</span></span><br><span class="line">             response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="comment">//解析响应</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                String content = EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭response</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>带参数的get请求<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置请求地址是：http://yun.itheima.com/search?keys=Java</span></span><br><span class="line"><span class="comment">//创建URIBuilder</span></span><br><span class="line">URIBuilder uriBuilder = <span class="keyword">new</span> URIBuilder(<span class="string">&quot;http://yun.itheima.com/search&quot;</span>);</span><br><span class="line"><span class="comment">//设置参数</span></span><br><span class="line">uriBuilder.setParameter(<span class="string">&quot;keys&quot;</span>,<span class="string">&quot;Java&quot;</span>);</span><br><span class="line"><span class="comment">//创建HttpGet对象，设置url访问地址</span></span><br><span class="line">HttpGet httpGet = <span class="keyword">new</span> HttpGet(uriBuilder.build());</span><br><span class="line">System.out.println(<span class="string">&quot;发起请求的信息：&quot;</span>+httpGet);</span><br></pre></td></tr></table></figure></li>
<li>post请求<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建HttpPost对象，设置url访问地址</span></span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>带参数的post请求<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建HttpPost对象，设置url访问地址</span></span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(<span class="string">&quot;http://yun.itheima.com/search&quot;</span>);</span><br><span class="line"><span class="comment">//声明List集合，封装表单中的参数</span></span><br><span class="line">List&lt;NameValuePair&gt; params = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line"><span class="comment">//设置请求地址是：http://yun.itheima.com/search?keys=Java</span></span><br><span class="line">params.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">&quot;keys&quot;</span>,<span class="string">&quot;Java&quot;</span>));</span><br><span class="line"><span class="comment">//创建表单的Entity对象,第一个参数就是封装好的表单数据，第二个参数就是编码</span></span><br><span class="line">UrlEncodedFormEntity formEntity = <span class="keyword">new</span> UrlEncodedFormEntity(params,<span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"><span class="comment">//设置表单的Entity对象到Post请求中</span></span><br><span class="line">httpPost.setEntity(formEntity);</span><br></pre></td></tr></table></figure></li>
<li>请求配置<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建HttpGet对象，设置url访问地址</span></span><br><span class="line">HttpGet httpGet = <span class="keyword">new</span> HttpGet(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line"><span class="comment">//配置请求信息</span></span><br><span class="line">RequestConfig config = RequestConfig.custom().setConnectTimeout(<span class="number">1000</span>)   <span class="comment">//创建连接的最长时间，单位是毫秒</span></span><br><span class="line">        .setConnectionRequestTimeout(<span class="number">500</span>)   <span class="comment">//设置获取连接的最长时间，单位是毫秒</span></span><br><span class="line">        .setSocketTimeout(<span class="number">10</span>*<span class="number">1000</span>)      <span class="comment">//设置数据传输的最长时间，单位是毫秒</span></span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">//给请求设置请求信息</span></span><br></pre></td></tr></table></figure></li>
<li>连接池<br>将HttpClient交给连接池管理，注意和多线程区分。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientPoolTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建连接池管理器</span></span><br><span class="line">        PoolingHttpClientConnectionManager cm = <span class="keyword">new</span> PoolingHttpClientConnectionManager();</span><br><span class="line">        <span class="comment">//设置最大连接数</span></span><br><span class="line">        cm.setMaxTotal(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//设置每个主机的最大连接数</span></span><br><span class="line">        cm.setDefaultMaxPerRoute(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//使用连接池管理器发起请求</span></span><br><span class="line">        doGet(cm);</span><br><span class="line">        doGet(cm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(PoolingHttpClientConnectionManager cm)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//不是每次创建新的HttpClient，而是从连接池中获取HttpClient对象</span></span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.custom().setConnectionManager(cm).build();</span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(<span class="string">&quot;http://www.itcast.cn&quot;</span>);</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                String content = EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">                System.out.println(content.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    response.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//不能关闭HttpClient，由连接池管理HttpClient</span></span><br><span class="line">                <span class="comment">//httpClient.close();</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>二、Jsoup</strong><br>参考： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/24b2cfc415ad">https://www.jianshu.com/p/24b2cfc415ad</a><br>jsoup首先是可以由url、字符串或文件解析获取dom对象，然后使用两类方法获取元素，其一是类似于js的document对象的一些方法，其二是类似于jquery的select相关的方法。<br>1.介绍</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jsoup 是一款Java 的HTML解析器，可直接解析某个URL地址、HTML文本内容。它提供了一套非常省力的API，可通过DOM，CSS以及类似于jQuery的操作方法来取出和操作数据。</span><br><span class="line"></span><br><span class="line">jsoup的主要功能如下：</span><br><span class="line">从一个URL，文件或字符串中解析HTML；</span><br><span class="line">使用DOM或CSS选择器来查找、取出数据；</span><br><span class="line">可操作HTML元素、属性、文本；</span><br></pre></td></tr></table></figure>
<p>2.api<br>（1）解析url、字符串、文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">解析url</span><br><span class="line">Jsoup可以直接输入url，它会发起请求并获取数据，封装为Document对象</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJsoupUrl</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//    解析url地址</span></span><br><span class="line">    Document document = Jsoup.parse(<span class="keyword">new</span> URL(<span class="string">&quot;http://www.itcast.cn/&quot;</span>), <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取title的内容</span></span><br><span class="line">    Element title = document.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line">    System.out.println(title.text());</span><br><span class="line">&#125;</span><br><span class="line">PS：虽然使用Jsoup可以替代HttpClient直接发起请求解析数据，但是往往不会这样用，因为实际的开发过程中，需要使用到多线程，连接池，代理等等方式，而jsoup对这些的支持并不是很好，所以我们一般把jsoup仅仅作为Html解析工具使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解析字符串</span><br><span class="line">Jsoup可以直接输入字符串，并封装为Document对象</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJsoupString</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//读取文件获取</span></span><br><span class="line">    String html = FileUtils.readFileToString(<span class="keyword">new</span> File(<span class="string">&quot;D:\\jsoup.html&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    解析字符串</span></span><br><span class="line">    Document document = Jsoup.parse(html);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取title的内容</span></span><br><span class="line">    Element title = document.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line">    System.out.println(title.text());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">解析文件</span><br><span class="line">Jsoup可以直接解析文件，并封装为Document对象</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJsoupHtml</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//    解析文件</span></span><br><span class="line">    Document document = Jsoup.parse(<span class="keyword">new</span> File(<span class="string">&quot;D:\\jsoup.html&quot;</span>),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取title的内容</span></span><br><span class="line">    Element title = document.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line">    System.out.println(title.text());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>（2）dom</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">元素获取</span><br><span class="line"><span class="number">1.</span>	根据id查询元素getElementById</span><br><span class="line"><span class="number">2.</span>	根据标签获取元素getElementsByTag</span><br><span class="line"><span class="number">3.</span>	根据<span class="class"><span class="keyword">class</span>获取元素<span class="title">getElementsByClass</span></span></span><br><span class="line"><span class="class">4.	根据属性获取元素<span class="title">getElementsByAttribute</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">//1.    根据<span class="title">id</span>查询元素<span class="title">getElementById</span></span></span><br><span class="line"><span class="class"><span class="title">Element</span> <span class="title">element</span> </span>= document.getElementById(<span class="string">&quot;city_bj&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.   根据标签获取元素getElementsByTag</span></span><br><span class="line">element = document.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.   根据class获取元素getElementsByClass</span></span><br><span class="line">element = document.getElementsByClass(<span class="string">&quot;s_name&quot;</span>).last();</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.   根据属性获取元素getElementsByAttribute</span></span><br><span class="line">element = document.getElementsByAttribute(<span class="string">&quot;abc&quot;</span>).first();</span><br><span class="line">element = document.getElementsByAttributeValue(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;city_con&quot;</span>).first();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	元素中获取数据</span><br><span class="line"><span class="number">1.</span>	从元素中获取id</span><br><span class="line"><span class="number">2.</span>	从元素中获取className</span><br><span class="line"><span class="number">3.</span>	从元素中获取属性的值attr</span><br><span class="line"><span class="number">4.</span>	从元素中获取所有属性attributes</span><br><span class="line"><span class="number">5.</span>	从元素中获取文本内容text</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取元素</span></span><br><span class="line">Element element = document.getElementById(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.   从元素中获取id</span></span><br><span class="line">String str = element.id();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.   从元素中获取className</span></span><br><span class="line">str = element.className();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.   从元素中获取属性的值attr</span></span><br><span class="line">str = element.attr(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.   从元素中获取所有属性attributes</span></span><br><span class="line">str = element.attributes().toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.   从元素中获取文本内容text</span></span><br><span class="line">str = element.text();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>（3）使用选择器语法查找元素<br>jsoup elements对象支持类似于CSS (或jquery)的选择器语法，来实现非常强大和灵活的查找功能。这个select 方法在Document, Element,或Elements对象中都可以使用。且是上下文相关的，因此可实现指定元素的过滤，或者链式选择访问。Select方法将返回一个Elements集合，并提供一组方法来抽取和处理结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">Selector选择器概述</span><br><span class="line">tagname: 通过标签查找元素，比如：span</span><br><span class="line">#id: 通过ID查找元素，比如：# city_bj</span><br><span class="line">.class: 通过<span class="class"><span class="keyword">class</span>名称查找元素，比如：.<span class="title">class_a</span></span></span><br><span class="line"><span class="class">[<span class="title">attribute</span>]: 利用属性查找元素，比如：[<span class="title">abc</span>]</span></span><br><span class="line"><span class="class">[<span class="title">attr</span></span>=value]: 利用属性值来查找元素，比如：[<span class="class"><span class="keyword">class</span></span>=s_name]</span><br><span class="line"></span><br><span class="line"><span class="comment">//tagname: 通过标签查找元素，比如：span</span></span><br><span class="line">Elements span = document.select(<span class="string">&quot;span&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (Element element : span) &#123;</span><br><span class="line">    System.out.println(element.text());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//#id: 通过ID查找元素，比如：#city_bjj</span></span><br><span class="line">String str = document.select(<span class="string">&quot;#city_bj&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//.class: 通过class名称查找元素，比如：.class_a</span></span><br><span class="line">str = document.select(<span class="string">&quot;.class_a&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//[attribute]: 利用属性查找元素，比如：[abc]</span></span><br><span class="line">str = document.select(<span class="string">&quot;[abc]&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//[attr=value]: 利用属性值来查找元素，比如：[class=s_name]</span></span><br><span class="line">str = document.select(<span class="string">&quot;[class=s_name]&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Selector选择器组合使用</span><br><span class="line">el#id: 元素+ID，比如： h3#city_bj</span><br><span class="line">el.class: 元素+<span class="class"><span class="keyword">class</span>，比如： <span class="title">li</span>.<span class="title">class_a</span></span></span><br><span class="line"><span class="class"><span class="title">el</span>[<span class="title">attr</span>]: 元素+属性名，比如： <span class="title">span</span>[<span class="title">abc</span>]</span></span><br><span class="line"><span class="class">任意组合: 比如：<span class="title">span</span>[<span class="title">abc</span>].<span class="title">s_name</span></span></span><br><span class="line"><span class="class"><span class="title">ancestor</span> <span class="title">child</span>: 查找某个元素下子元素，比如：.<span class="title">city_con</span> <span class="title">li</span> 查找&quot;<span class="title">city_con</span>&quot;下的所有<span class="title">li</span></span></span><br><span class="line"><span class="class"><span class="title">parent</span> &gt; <span class="title">child</span>: 查找某个父元素下的直接子元素，比如：</span></span><br><span class="line"><span class="class">.<span class="title">city_con</span> &gt; <span class="title">ul</span> &gt; <span class="title">li</span> 查找<span class="title">city_con</span>第一级（直接子元素）的<span class="title">ul</span>，再找所有<span class="title">ul</span>下的第一级<span class="title">li</span></span></span><br><span class="line"><span class="class"><span class="title">parent</span> &gt; *: 查找某个父元素下所有直接子元素</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">//<span class="title">el</span>#<span class="title">id</span>: 元素+<span class="title">ID</span>，比如： <span class="title">h3</span>#<span class="title">city_bj</span></span></span><br><span class="line"><span class="class"><span class="title">String</span> <span class="title">str</span> </span>= document.select(<span class="string">&quot;h3#city_bj&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//el.class: 元素+class，比如： li.class_a</span></span><br><span class="line">str = document.select(<span class="string">&quot;li.class_a&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//el[attr]: 元素+属性名，比如： span[abc]</span></span><br><span class="line">str = document.select(<span class="string">&quot;span[abc]&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//任意组合，比如：span[abc].s_name</span></span><br><span class="line">str = document.select(<span class="string">&quot;span[abc].s_name&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//ancestor child: 查找某个元素下子元素，比如：.city_con li 查找&quot;city_con&quot;下的所有li</span></span><br><span class="line">str = document.select(<span class="string">&quot;.city_con li&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//parent &gt; child: 查找某个父元素下的直接子元素，</span></span><br><span class="line"><span class="comment">//比如：.city_con &gt; ul &gt; li 查找city_con第一级（直接子元素）的ul，再找所有ul下的第一级li</span></span><br><span class="line">str = document.select(<span class="string">&quot;.city_con &gt; ul &gt; li&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//parent &gt; * 查找某个父元素下所有直接子元素.city_con &gt; *</span></span><br><span class="line">str = document.select(<span class="string">&quot;.city_con &gt; *&quot;</span>).text();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3.注意</p>
<ul>
<li>jsoup还可与htmlcleaner使用xpath解析<br>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/baidu_36336788/article/details/89875926">https://blog.csdn.net/baidu_36336788/article/details/89875926</a></li>
<li>jsoup解析推荐的做法是，jsoup parse获得dom对象后，使用select，具体内容通过在网页选择元素–检查–右键–copy selector获取</li>
</ul>
<p><strong>三、HttpClient + Jsoup 案例</strong><br>案例由SpringBoot + SpringData JPA + HttpClient + Jsoup写成，将爬虫嵌入了应用中，实现了爬取结果保存在数据库中。<br>1.核心代码<br>HttpClient封装类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.jd.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PoolingHttpClientConnectionManager cm;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HttpUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cm = <span class="keyword">new</span> PoolingHttpClientConnectionManager();</span><br><span class="line">        <span class="comment">//设置最大连接数</span></span><br><span class="line">        <span class="keyword">this</span>.cm.setMaxTotal(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//设置每个主机的最大连接数</span></span><br><span class="line">        <span class="keyword">this</span>.cm.setDefaultMaxPerRoute(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据请求地址下载页面数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 页面数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doGetHtml</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取HttpClient对象</span></span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.custom().setConnectionManager(<span class="keyword">this</span>.cm).build();</span><br><span class="line">        <span class="comment">//创建httpGet请求对象，设置url地址</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">        <span class="comment">//设置请求信息</span></span><br><span class="line">        httpGet.setConfig(<span class="keyword">this</span>.getConfig());</span><br><span class="line">        httpGet.setHeader(<span class="string">&quot;user-agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.87 Safari/537.36&quot;</span>);</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//使用HttpClient发起请求，获取响应</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="comment">//解析响应，返回结果</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="comment">//判断响应体Entity是否不为空，如果不为空就可以使用EntityUtils</span></span><br><span class="line">                <span class="keyword">if</span> (response.getEntity() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    String content = EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> content;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭response</span></span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    response.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回空串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 图片名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doGetImage</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取HttpClient对象</span></span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.custom().setConnectionManager(<span class="keyword">this</span>.cm).build();</span><br><span class="line">        <span class="comment">//创建httpGet请求对象，设置url地址</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">        <span class="comment">//设置请求信息</span></span><br><span class="line">        httpGet.setConfig(<span class="keyword">this</span>.getConfig());</span><br><span class="line">        <span class="comment">//设置User-Agent</span></span><br><span class="line">        httpGet.setHeader(<span class="string">&quot;user-agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.87 Safari/537.36&quot;</span>);</span><br><span class="line">        CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//使用HttpClient发起请求，获取响应</span></span><br><span class="line">            response = httpClient.execute(httpGet);</span><br><span class="line">            <span class="comment">//解析响应，返回结果</span></span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="comment">//判断响应体Entity是否不为空</span></span><br><span class="line">                <span class="keyword">if</span> (response.getEntity() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//下载图片</span></span><br><span class="line">                    <span class="comment">//获取图片的后缀</span></span><br><span class="line">                    String extName = url.substring(url.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">                    <span class="comment">//创建图片名，重命名图片</span></span><br><span class="line">                    String picName = UUID.randomUUID().toString() + extName;</span><br><span class="line">                    <span class="comment">//下载图片</span></span><br><span class="line">                    <span class="comment">//声明OutPutStream</span></span><br><span class="line">                    OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">&quot;C:\\images\\&quot;</span> + picName));</span><br><span class="line">                    response.getEntity().writeTo(outputStream);</span><br><span class="line">                    <span class="comment">//返回图片名称</span></span><br><span class="line">                    <span class="keyword">return</span> picName;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭response</span></span><br><span class="line">            <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    response.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果下载失败，返回空串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置请求信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RequestConfig <span class="title">getConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestConfig config = RequestConfig.custom()</span><br><span class="line">                .setConnectTimeout(<span class="number">1000</span>)    <span class="comment">//创建连接的最长时间</span></span><br><span class="line">                .setConnectionRequestTimeout(<span class="number">500</span>)  <span class="comment">// 获取连接的最长时间</span></span><br><span class="line">                .setSocketTimeout(<span class="number">10000</span>)    <span class="comment">//数据传输的最长时间</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解析代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.jd.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.jd.pojo.Item;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.jd.service.ItemService;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.jd.util.HttpUtils;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Element;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpUtils httpUtils;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ItemService itemService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper MAPPER =  <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当下载任务完成后，间隔多长时间进行下一次的任务。</span></span><br><span class="line">    <span class="meta">@Scheduled(fixedDelay = 100 * 1000)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">itemTask</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//声明需要解析的初始地址</span></span><br><span class="line">        String url = <span class="string">&quot;https://search.jd.com/Search?keyword=手机&amp;wq=手机&amp;page=&quot;</span>;</span><br><span class="line">        <span class="comment">//按照页面对手机的搜索结果进行遍历解析</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">10</span>; i = i + <span class="number">2</span>) &#123;</span><br><span class="line">            String html = httpUtils.doGetHtml(url + i);</span><br><span class="line">            System.out.println(html);</span><br><span class="line">            <span class="comment">//解析页面，获取商品数据并存储</span></span><br><span class="line">            <span class="keyword">this</span>.parse(html);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;手机数据抓取完成！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析页面，获取商品数据并存储</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(String html)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//解析html获取Document</span></span><br><span class="line">        Document doc = Jsoup.parse(html);</span><br><span class="line">        <span class="comment">//获取spu信息</span></span><br><span class="line">        Elements spuEles = doc.select(<span class="string">&quot;div#J_goodsList &gt; ul &gt; li&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Element spuEle : spuEles) &#123;</span><br><span class="line">            <span class="keyword">if</span> (spuEle.attr(<span class="string">&quot;data-spu&quot;</span>) == <span class="keyword">null</span> || spuEle.attr(<span class="string">&quot;data-spu&quot;</span>).length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取spu</span></span><br><span class="line">            <span class="keyword">long</span> spu = Long.parseLong(spuEle.attr(<span class="string">&quot;data-spu&quot;</span>));</span><br><span class="line">            <span class="comment">//获取sku信息</span></span><br><span class="line">            Elements skuEles = spuEle.select(<span class="string">&quot;li.ps-item&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Element skuEle : skuEles) &#123;</span><br><span class="line">                <span class="comment">//获取sku</span></span><br><span class="line">                <span class="keyword">long</span> sku = Long.parseLong(skuEle.select(<span class="string">&quot;[data-sku]&quot;</span>).attr(<span class="string">&quot;data-sku&quot;</span>));</span><br><span class="line">                <span class="comment">//根据sku查询商品数据</span></span><br><span class="line">                Item item = <span class="keyword">new</span> Item();</span><br><span class="line">                item.setSku(sku);</span><br><span class="line">                List&lt;Item&gt; list = <span class="keyword">this</span>.itemService.findAll(item);</span><br><span class="line">                <span class="keyword">if</span>(list.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//如果商品存在，就进行下一个循环，该商品不保存，因为已存在</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//设置商品的spu</span></span><br><span class="line">                item.setSpu(spu);</span><br><span class="line">                <span class="comment">//获取商品的详情的url</span></span><br><span class="line">                String itemUrl = <span class="string">&quot;https://item.jd.com/&quot;</span> + sku + <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">                item.setUrl(itemUrl);</span><br><span class="line">                <span class="comment">//获取商品的图片</span></span><br><span class="line">                String picUrl =<span class="string">&quot;https:&quot;</span>+ skuEle.select(<span class="string">&quot;img[data-sku]&quot;</span>).first().attr(<span class="string">&quot;data-lazy-img&quot;</span>);</span><br><span class="line">                picUrl = picUrl.replace(<span class="string">&quot;/n9/&quot;</span>,<span class="string">&quot;/n1/&quot;</span>);</span><br><span class="line">                String picName = <span class="keyword">this</span>.httpUtils.doGetImage(picUrl);</span><br><span class="line">                item.setPic(picName);</span><br><span class="line">                <span class="comment">//获取商品的价格</span></span><br><span class="line">                String priceJson = <span class="keyword">this</span>.httpUtils.doGetHtml(<span class="string">&quot;https://p.3.cn/prices/mgets?skuIds=J_&quot;</span> + sku);</span><br><span class="line">                <span class="keyword">double</span> price = MAPPER.readTree(priceJson).get(<span class="number">0</span>).get(<span class="string">&quot;p&quot;</span>).asDouble();</span><br><span class="line">                item.setPrice(price);</span><br><span class="line">                <span class="comment">//获取商品的标题</span></span><br><span class="line">                String itemInfo = <span class="keyword">this</span>.httpUtils.doGetHtml(item.getUrl());</span><br><span class="line">                String title = Jsoup.parse(itemInfo).select(<span class="string">&quot;div.sku-name&quot;</span>).text();</span><br><span class="line">                item.setTitle(title);</span><br><span class="line">                item.setCreated(<span class="keyword">new</span> Date());</span><br><span class="line">                item.setUpdated(item.getCreated());</span><br><span class="line">                <span class="comment">//保存商品数据到数据库中</span></span><br><span class="line">                <span class="keyword">this</span>.itemService.save(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.细节</p>
<ul>
<li>springboot中定时任务的设置</li>
<li>使用了json相关的解析方法</li>
</ul>
<p><strong>四、其他解析方法</strong><br>针对不同页面数据，可以考虑其他的解析方式。<br>1.xpath 使用dom4j<br>参考 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/806bb1bdc06f">https://www.jianshu.com/p/806bb1bdc06f</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xf_zhen/article/details/90440330">https://blog.csdn.net/xf_zhen/article/details/90440330</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ifme/p/12402570.html">https://www.cnblogs.com/ifme/p/12402570.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/zz13995900221/article/details/79826173">https://blog.csdn.net/zz13995900221/article/details/79826173</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40374604/article/details/84327419">https://blog.csdn.net/qq_40374604/article/details/84327419</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33371372/article/details/82318540?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-10.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-10.nonecase">https://blog.csdn.net/qq_33371372/article/details/82318540?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-10.nonecase&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-10.nonecase</a></p>
<p>2.正则<br>参考 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/jingmoxukong/p/6026474.html">https://www.cnblogs.com/jingmoxukong/p/6026474.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jingmoxukong/p/6030197.html">https://www.cnblogs.com/jingmoxukong/p/6030197.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jingmoxukong/p/6040572.html">https://www.cnblogs.com/jingmoxukong/p/6040572.html</a></p>
<h4><span id="二webmagic">（二）WebMagic</span></h4><p>相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/us.codecraft/webmagic-core --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- https://mvnrepository.com/artifact/us.codecraft/webmagic-extension --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.codecraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webmagic-extension<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--WebMagic对布隆过滤器的支持--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>一、介绍</strong><br><strong>1.概述</strong><br>WebMagic项目代码分为核心和扩展两部分。核心部分(webmagic-core)是一个精简的、模块化的爬虫实现，而扩展部分则包括一些便利的、实用性的功能。<br>WebMagic的设计目标是尽量的模块化，并体现爬虫的功能特点。这部分提供非常简单、灵活的API，在基本不改变开发模式的情况下，编写一个爬虫。<br>扩展部分(webmagic-extension)提供一些便捷的功能，例如注解模式编写爬虫等。同时内置了一些常用的组件，便于爬虫开发。<br><strong>2.架构</strong><br>  WebMagic的结构分为Downloader、PageProcessor、Scheduler、Pipeline四大组件，并由Spider将它们彼此组织起来。这四大组件对应爬虫生命周期中的下载、处理、管理和持久化等功能。WebMagic的设计参考了Scapy，但是实现方式更Java化一些。而Spider则将这几个组件组织起来，让它们可以互相交互，流程化的执行，可以认为Spider是一个大的容器，它也是WebMagic逻辑的核心。<br><strong>3.四大组件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.Downloader</span><br><span class="line">Downloader负责从互联网上下载页面，以便后续处理。WebMagic默认使用了Apache HttpClient作为下载工具。</span><br><span class="line"></span><br><span class="line">2.PageProcessor</span><br><span class="line">PageProcessor负责解析页面，抽取有用信息，以及发现新的链接。WebMagic使用Jsoup作为HTML解析工具，并基于其开发了解析XPath的工具Xsoup。</span><br><span class="line"></span><br><span class="line">在这四个组件中，PageProcessor对于每个站点每个页面都不一样，是需要使用者定制的部分。</span><br><span class="line"></span><br><span class="line">3.Scheduler</span><br><span class="line">Scheduler负责管理待抓取的URL，以及一些去重的工作。WebMagic默认提供了JDK的内存队列来管理URL，并用集合来进行去重。也支持使用Redis进行分布式管理。</span><br><span class="line"></span><br><span class="line">4.Pipeline</span><br><span class="line">Pipeline负责抽取结果的处理，包括计算、持久化到文件、数据库等。WebMagic默认提供了“输出到控制台”和“保存到文件”两种结果处理方案。</span><br><span class="line"></span><br><span class="line">Pipeline定义了结果保存的方式，如果你要保存到指定数据库，则需要编写对应的Pipeline。对于一类需求一般只需编写一个Pipeline。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>4.三个数据流转对象</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. Request</span><br><span class="line">Request是对URL地址的一层封装，一个Request对应一个URL地址。</span><br><span class="line"></span><br><span class="line">它是PageProcessor与Downloader交互的载体，也是PageProcessor控制Downloader唯一方式。</span><br><span class="line"></span><br><span class="line">除了URL本身外，它还包含一个Key-Value结构的字段extra。你可以在extra中保存一些特殊的属性，然后在其他地方读取，以完成不同的功能。例如附加上一个页面的一些信息等。</span><br><span class="line"></span><br><span class="line">2. Page</span><br><span class="line">Page代表了从Downloader下载到的一个页面——可能是HTML，也可能是JSON或者其他文本格式的内容。</span><br><span class="line"></span><br><span class="line">Page是WebMagic抽取过程的核心对象，它提供一些方法可供抽取、结果保存等。</span><br><span class="line"></span><br><span class="line">3. ResultItems</span><br><span class="line">ResultItems相当于一个Map，它保存PageProcessor处理的结果，供Pipeline使用。它的API与Map很类似，值得注意的是它有一个字段skip，若设置为true，则不应被Pipeline处理。</span><br></pre></td></tr></table></figure>

<p><strong>二、功能</strong><br><strong>1.实现PageProcessor</strong><br><strong>抽取元素Selectable</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WebMagic里主要使用了三种抽取技术：XPath、正则表达式和CSS选择器。另外，对于JSON格式的内容，可使用JsonPath进行解析。</span><br><span class="line"></span><br><span class="line">1.	XPath</span><br><span class="line">以上是获取属性class=mt的div标签，里面的h1标签的内容</span><br><span class="line">page.getHtml().xpath(&quot;//div[@class=mt]/h1/text()&quot;)</span><br><span class="line">也可以参考课堂资料的W3School离线手册(2017.03.11版).chm</span><br><span class="line"></span><br><span class="line">2.	CSS选择器</span><br><span class="line">CSS选择器是与XPath类似的语言。它比XPath写起来要简单一些，但是如果写复杂一点的抽取规则，就相对要麻烦一点。</span><br><span class="line">div.mt&gt;h1表示class为mt的div标签下的直接子元素h1标签</span><br><span class="line">page.getHtml().css(&quot;div.mt&gt;h1&quot;).toString()</span><br><span class="line"></span><br><span class="line">可使用:nth-child(n)选择第几个元素，如下选择第一个元素</span><br><span class="line">page.getHtml().css(&quot;div#news_div &gt; ul &gt; li:nth-child(1) a&quot;).toString()</span><br><span class="line">注意：需要使用&gt;，就是直接子元素才可以选择第几个元素</span><br><span class="line"></span><br><span class="line">3.	正则表达式</span><br><span class="line">正则表达式则是一种通用的文本抽取语言。在这里一般用于获取url地址。</span><br></pre></td></tr></table></figure>
<p><strong>抽取元素API</strong><br>Selectable相关的抽取元素链式API是WebMagic的一个核心功能。使用Selectable接口，可以直接完成页面元素的链式抽取，也无需去关心抽取的细节。page.getHtml()返回的是一个Html对象，它实现了Selectable接口。这个接口包含的方法分为两类：抽取部分和获取结果部分。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/GjHWOl6heTFb71c.png" alt="20200616102805543.png" class="lazyload"><br><strong>获取结果API</strong><br>当链式调用结束时，我们一般都想要拿到一个字符串类型的结果。这时候就需要用到获取结果的API了。我们知道，一条抽取规则，无论是XPath、CSS选择器或者正则表达式，总有可能抽取到多条元素。WebMagic对这些进行了统一，可以通过不同的API获取到一个或者多个元素。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/PAmyDrgULG82Sit.png" alt="20200616103015926.png" class="lazyload">)这里selectable.toString()采用了toString()这个接口，是为了在输出以及和一些框架结合的时候，更加方便。因为一般情况下，我们都只需要选择一个元素！selectable.all()则会获取到所有元素。<br><strong>获取链接</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">有了处理页面的逻辑，我们的爬虫就接近完工了，但是现在还有一个问题：一个站点的页面是很多的，一开始我们不可能全部列举出来，于是如何发现后续的链接，是一个爬虫不可缺少的一部分。</span><br><span class="line"></span><br><span class="line">下面的例子就是获取https:<span class="comment">//www.jd.com/moreSubject.aspx这个页面中</span></span><br><span class="line">所有符合https:<span class="comment">//www.jd.com/news.\\w+?.*正则表达式的url地址</span></span><br><span class="line">并将这些链接加入到待抓取的队列中去。</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">    page.addTargetRequests(page.getHtml().links()</span><br><span class="line">            .regex(<span class="string">&quot;(https://www.jd.com/news.\\w+?.*)&quot;</span>).all());</span><br><span class="line">    System.out.println(page.getHtml().css(<span class="string">&quot;div.mt&gt;h1&quot;</span>).all());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Spider.create(<span class="keyword">new</span> JobProcessor())</span><br><span class="line">            .addUrl(<span class="string">&quot;https://www.jd.com/moreSubject.aspx&quot;</span>)</span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2.使用Pipeline保存结果</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WebMagic用于保存结果的组件叫做Pipeline。我们现在通过“控制台输出结果”这件事也是通过一个内置的Pipeline完成的，它叫做ConsolePipeline。</span><br><span class="line"></span><br><span class="line">那么，我现在想要把结果用保存到文件中，怎么做呢？只将Pipeline的实现换成<span class="string">&quot;FilePipeline&quot;</span>就可以了。</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Spider.create(<span class="keyword">new</span> JobProcessor())</span><br><span class="line">            <span class="comment">//初始访问url地址</span></span><br><span class="line">            .addUrl(<span class="string">&quot;https://www.jd.com/moreSubject.aspx&quot;</span>)</span><br><span class="line">            .addPipeline(<span class="keyword">new</span> FilePipeline(<span class="string">&quot;D:/webmagic/&quot;</span>))</span><br><span class="line">            .thread(<span class="number">5</span>)<span class="comment">//设置线程数</span></span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>3.爬虫的启动、配置、终止</strong><br><strong>入口Spider</strong><br>Spider是爬虫启动的入口。在启动爬虫之前，我们需要使用一个PageProcessor创建一个Spider对象，然后使用run()进行启动。同时Spider的其他组件（Downloader、Scheduler、Pipeline）都可以通过set方法来进行设置。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/liSsE5NBVFzqPAK.png" alt="20200616103445159.png" class="lazyload"><br><strong>爬虫配置Site</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Site.me()可以对爬虫进行一些配置配置，包括编码、抓取间隔、超时时间、重试次数等。在这里我们先简单设置一下：重试次数为<span class="number">3</span>次，抓取间隔为一秒。</span><br><span class="line"><span class="keyword">private</span> Site site = Site.me()</span><br><span class="line">        .setCharset(<span class="string">&quot;UTF-8&quot;</span>)<span class="comment">//编码</span></span><br><span class="line">        .setSleepTime(<span class="number">1</span>)<span class="comment">//抓取间隔时间</span></span><br><span class="line">        .setTimeOut(<span class="number">1000</span>*<span class="number">10</span>)<span class="comment">//超时时间</span></span><br><span class="line">        .setRetrySleepTime(<span class="number">3000</span>)<span class="comment">//重试时间</span></span><br><span class="line">        .setRetryTimes(<span class="number">3</span>);<span class="comment">//重试次数</span></span><br><span class="line">站点本身的一些配置信息，例如编码、HTTP头、超时时间、重试策略等、代理等，都可以通过设置Site对象来进行配置。</span><br></pre></td></tr></table></figure>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/gVsD8ub4IFpUnE7.png" alt="20200616103609855.png" class="lazyload"><br><strong>4.Scheduler组件</strong><br>在解析页面的时候，很可能会解析出相同的url地址(例如商品标题和商品图片超链接，而且url一样)，如果不进行处理，同样的url会解析处理多次，浪费资源。所以我们需要有一个url去重的功能。<br>WebMagic提供了Scheduler可以帮助我们解决以上问题。Scheduler是WebMagic中进行URL管理的组件。一般来说，Scheduler包括两个作用：对待抓取的URL队列进行管理；对已抓取的URL进行去重。<br>WebMagic内置了几个常用的Scheduler。如果你只是在本地执行规模比较小的爬虫，那么基本无需定制Scheduler，但是了解一下已经提供的几个Scheduler还是有意义的。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/DLm415PZqCgTBMF.png" alt="20200616104052458.png" class="lazyload">去重部分被单独抽象成了一个接口：DuplicateRemover，从而可以为同一个Scheduler选择不同的去重方式，以适应不同的需要，目前提供了两种去重方式。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/yQZHNRvdnm5spbr.png" alt="20200616104137137.png" class="lazyload"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">RedisScheduler是使用Redis的set进行去重，其他的Scheduler默认都使用HashSetDuplicateRemover来进行去重。</span><br><span class="line">如果要使用BloomFilter，必须要加入以下依赖：</span><br><span class="line">&lt;!--WebMagic对布隆过滤器的支持--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">16.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">修改代码，添加布隆过滤器</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Spider.create(<span class="keyword">new</span> JobProcessor())</span><br><span class="line">            <span class="comment">//初始访问url地址</span></span><br><span class="line">            .addUrl(<span class="string">&quot;https://www.jd.com/moreSubject.aspx&quot;</span>)</span><br><span class="line">            .addPipeline(<span class="keyword">new</span> FilePipeline(<span class="string">&quot;D:/webmagic/&quot;</span>))</span><br><span class="line">            .setScheduler(<span class="keyword">new</span> QueueScheduler()</span><br><span class="line">                    .setDuplicateRemover(<span class="keyword">new</span> BloomFilterDuplicateRemover(<span class="number">10000000</span>))) <span class="comment">//参数设置需要对多少条数据去重</span></span><br><span class="line">            .thread(<span class="number">1</span>)<span class="comment">//设置线程数</span></span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>三种去重方式</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HashSet</span><br><span class="line">使用java中的HashSet不能重复的特点去重。优点是容易理解。使用方便。</span><br><span class="line">缺点：占用内存大，性能较低。</span><br><span class="line"></span><br><span class="line">Redis去重</span><br><span class="line">使用Redis的set进行去重。优点是速度快（Redis本身速度就很快），而且去重不会占用爬虫服务器的资源，可以处理更大数据量的数据爬取。</span><br><span class="line">缺点：需要准备Redis服务器，增加开发和使用成本。</span><br><span class="line"></span><br><span class="line">布隆过滤器（BloomFilter）</span><br><span class="line">使用布隆过滤器也可以实现去重。优点是占用的内存要比使用HashSet要小的多，也适合大量数据的去重操作。</span><br><span class="line">缺点：有误判的可能。没有重复可能会判定重复，但是重复数据一定会判定重复。</span><br></pre></td></tr></table></figure>
<p><strong>4.使用和定制Pipeline</strong><br>在WebMagic中，Pileline是抽取结束后，进行处理的部分，它主要用于抽取结果的保存，也可以定制Pileline可以实现一些通用的功能。在这里我们会定制Pipeline实现数据导入到数据库中。<br><strong>Pipeline输出</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Pipeline的接口定义如下：</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pipeline</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ResultItems保存了抽取结果，它是一个Map结构，</span></span><br><span class="line">    <span class="comment">// 在page.putField(key,value)中保存的数据，</span></span><br><span class="line">    <span class="comment">//可以通过ResultItems.get(key)获取</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(ResultItems resultItems, Task task)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">可以看到，Pipeline其实就是将PageProcessor抽取的结果，继续进行了处理的，其实在Pipeline中完成的功能，你基本上也可以直接在PageProcessor实现，那么为什么会有Pipeline？有几个原因：</span><br><span class="line"></span><br><span class="line">* 为了模块分离</span><br><span class="line">“页面抽取”和“后处理、持久化”是爬虫的两个阶段，将其分离开来，一个是代码结构比较清晰，另一个是以后也可能将其处理过程分开，分开在独立的线程以至于不同的机器执行。</span><br><span class="line"></span><br><span class="line">* Pipeline的功能比较固定，更容易做成通用组件</span><br><span class="line">每个页面的抽取方式千变万化，但是后续处理方式则比较固定，例如保存到文件、保存到数据库这种操作，这些对所有页面都是通用的。</span><br><span class="line"></span><br><span class="line">在WebMagic里，一个Spider可以有多个Pipeline，使用Spider.addPipeline()即可增加一个Pipeline。这些Pipeline都会得到处理，例如可以使用</span><br><span class="line">spider.addPipeline(<span class="keyword">new</span> ConsolePipeline()).addPipeline(<span class="keyword">new</span> FilePipeline())</span><br><span class="line">实现输出结果到控制台，并且保存到文件的目标。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>已有的Pipeline</strong><br>WebMagic中就已经提供了控制台输出、保存到文件、保存为JSON格式的文件几种通用的Pipeline。<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://i.loli.net/2020/06/16/i2KO6QUGLSjXcTd.png" alt="20200616104736914.png" class="lazyload"></p>
<p><strong>三、爬虫分类</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">网络爬虫按照系统结构和实现技术，大致可以分为以下几种类型：通用网络爬虫、聚焦网络爬虫、增量式网络爬虫、深层网络爬虫。 实际的网络爬虫系统通常是几种爬虫技术相结合实现的</span><br><span class="line">3.1. 通用网络爬虫</span><br><span class="line">通用网络爬虫又称全网爬虫（Scalable Web Crawler），爬行对象从一些种子 URL 扩充到整个 Web，主要为门户站点搜索引擎和大型 Web 服务提供商采集数据。 </span><br><span class="line">这类网络爬虫的爬行范围和数量巨大，对于爬行速度和存储空间要求较高，对于爬行页面的顺序要求相对较低，同时由于待刷新的页面太多，通常采用并行工作方式，但需要较长时间才能刷新一次页面。 </span><br><span class="line">简单的说就是互联网上抓取所有数据。</span><br><span class="line"></span><br><span class="line">3.2. 聚焦网络爬虫</span><br><span class="line">聚焦网络爬虫（Focused Crawler），又称主题网络爬虫（Topical Crawler），是指选择性地爬行那些与预先定义好的主题相关页面的网络爬虫。</span><br><span class="line">和通用网络爬虫相比，聚焦爬虫只需要爬行与主题相关的页面，极大地节省了硬件和网络资源，保存的页面也由于数量少而更新快，还可以很好地满足一些特定人群对特定领域信息的需求 。</span><br><span class="line">简单的说就是互联网上只抓取某一种数据。</span><br><span class="line"></span><br><span class="line">3.3. 增量式网络爬虫</span><br><span class="line">增量式网络爬虫（Incremental Web Crawler）是 指 对 已 下 载 网 页 采 取 增量式更新和只爬行新产生的或者已经发生变化网页的爬虫，它能够在一定程度上保证所爬行的页面是尽可能新的页面。</span><br><span class="line">和周期性爬行和刷新页面的网络爬虫相比，增量式爬虫只会在需要的时候爬行新产生或发生更新的页面 ，并不重新下载没有发生变化的页面，可有效减少数据下载量，及时更新已爬行的网页，减小时间和空间上的耗费，但是增加了爬行算法的复杂度和实现难度。</span><br><span class="line">简单的说就是互联网上只抓取刚刚更新的数据。</span><br><span class="line"></span><br><span class="line">3.4. Deep Web 爬虫</span><br><span class="line">Web 页面按存在方式可以分为表层网页（Surface Web）和深层网页（Deep Web，也称 Invisible Web Pages 或 Hidden Web）。 </span><br><span class="line">表层网页是指传统搜索引擎可以索引的页面，以超链接可以到达的静态网页为主构成的 Web 页面。</span><br><span class="line">Deep Web 是那些大部分内容不能通过静态链接获取的、隐藏在搜索表单后的，只有用户提交一些关键词才能获得的 Web 页面。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>四、案例</strong><br><strong>1. url解析功能</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JobProcessor</span> <span class="keyword">implements</span> <span class="title">PageProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpringDataPipeline springDataPipeline;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(initialDelay = 1000, fixedDelay = 1000 * 100)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//访问入口url地址</span></span><br><span class="line">        String url = <span class="string">&quot;https://search.51job.com/list/000000,000000,0000,01%252C32,9,99,java,2,1.html?lang=c&amp;stype=&amp;postchannel=0000&amp;workyear=99&amp;cotype=99&amp;degreefrom=99&amp;jobterm=99&amp;companysize=99&amp;providesalary=99&amp;lonlat=0%2C0&amp;radius=-1&amp;ord_field=0&amp;confirmdate=9&amp;fromType=&amp;dibiaoid=0&amp;address=&amp;line=&amp;specialarea=00&amp;from=&amp;welfare=&quot;</span>;</span><br><span class="line">        Spider.create(<span class="keyword">new</span> JobProcessor())</span><br><span class="line">                .addUrl(url) </span><br><span class="line">                .setScheduler(<span class="keyword">new</span> QueueScheduler()</span><br><span class="line">                        .setDuplicateRemover(<span class="keyword">new</span> BloomFilterDuplicateRemover(<span class="number">10000000</span>)))</span><br><span class="line">                .thread(<span class="number">5</span>)</span><br><span class="line">                .run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取页面数据</span></span><br><span class="line">        List&lt;Selectable&gt; nodes = page.getHtml().$(<span class="string">&quot;div#resultList div.el&quot;</span>).nodes();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断nodes是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (nodes.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//如果为空，表示这是招聘信息详情页保存信息详情</span></span><br><span class="line">                <span class="keyword">this</span>.saveJobInfo(page);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//如果有值，表示这是招聘信息列表页</span></span><br><span class="line">            <span class="keyword">for</span> (Selectable node : nodes) &#123;</span><br><span class="line">                <span class="comment">//获取招聘信息详情页url</span></span><br><span class="line">                String jobUrl = node.links().toString();</span><br><span class="line">                <span class="comment">//添加到url任务列表中，等待下载</span></span><br><span class="line">                page.addTargetRequest(jobUrl);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//获取翻页按钮的超链接</span></span><br><span class="line">                List&lt;String&gt; listUrl = page.getHtml().$(<span class="string">&quot;div.p_in li.bk&quot;</span>).links().all();</span><br><span class="line">                <span class="comment">//添加到任务列表中</span></span><br><span class="line">                page.addTargetRequests(listUrl);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>2.页面解析功能</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析页面，获取招聘详情</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveJobInfo</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建招聘信息对象</span></span><br><span class="line">    JobInfo jobInfo = <span class="keyword">new</span> JobInfo();</span><br><span class="line">    Html html = page.getHtml();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//公司名称</span></span><br><span class="line">    jobInfo.setCompanyName(html.$(<span class="string">&quot;div.tHeader p.cname a&quot;</span>, <span class="string">&quot;text&quot;</span>).toString());</span><br><span class="line">    <span class="comment">//公司地址</span></span><br><span class="line">    jobInfo.setCompanyAddr(html.$(<span class="string">&quot;div.tBorderTop_box:nth-child(3) p.fp&quot;</span>, <span class="string">&quot;text&quot;</span>).toString());</span><br><span class="line">    <span class="comment">//公司信息</span></span><br><span class="line">    jobInfo.setCompanyInfo(html.$(<span class="string">&quot;div.tmsg&quot;</span>, <span class="string">&quot;text&quot;</span>).toString());</span><br><span class="line">    <span class="comment">//职位名称</span></span><br><span class="line">    jobInfo.setJobName(html.$(<span class="string">&quot;div.tHeader &gt; div.in &gt; div.cn &gt; h1&quot;</span>, <span class="string">&quot;text&quot;</span>).toString());</span><br><span class="line">    <span class="comment">//工作地点</span></span><br><span class="line">    jobInfo.setJobAddr(html.$(<span class="string">&quot;div.tHeader &gt; div.in &gt; div.cn &gt; span.lname&quot;</span>, <span class="string">&quot;text&quot;</span>).toString());</span><br><span class="line">    <span class="comment">//职位信息</span></span><br><span class="line">    jobInfo.setJobInfo(Jsoup.parse(html.$(<span class="string">&quot;div.tBorderTop_box:nth-child(2)&quot;</span>).toString()).text());</span><br><span class="line">    <span class="comment">//工资范围</span></span><br><span class="line">    String salaryStr = html.$(<span class="string">&quot;div.tHeader &gt; div.in &gt; div.cn &gt; strong&quot;</span>, <span class="string">&quot;text&quot;</span>).toString();</span><br><span class="line">    jobInfo.setSalaryMin(MathSalary.getSalary(salaryStr)[<span class="number">0</span>]);</span><br><span class="line">    jobInfo.setSalaryMax(MathSalary.getSalary(salaryStr)[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//职位详情url</span></span><br><span class="line">    jobInfo.setUrl(page.getUrl().toString());</span><br><span class="line">    <span class="comment">//职位发布时间</span></span><br><span class="line">    String time = html.$(<span class="string">&quot;div.jtag &gt; div.t1 &gt; span.sp4&quot;</span>, <span class="string">&quot;text&quot;</span>).regex(<span class="string">&quot;.*发布&quot;</span>).toString();</span><br><span class="line">    jobInfo.setTime(time.substring(<span class="number">0</span>, time.length() - <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存数据</span></span><br><span class="line">page.putField(<span class="string">&quot;jobInfo&quot;</span>, jobInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>3.案例自定义Pipeline导入数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义SpringDataPipeline</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDataPipeline</span> <span class="keyword">implements</span> <span class="title">Pipeline</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JobInfoService jobInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(ResultItems resultItems, Task task)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取需要保存到MySQL的数据</span></span><br><span class="line">        JobInfo jobInfo = resultItems.get(<span class="string">&quot;jobInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断获取到的数据不为空</span></span><br><span class="line">        <span class="keyword">if</span>(jobInfo!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//如果有值则进行保存</span></span><br><span class="line">            <span class="keyword">this</span>.jobInfoService.save(jobInfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在JobProcessor中修改process()启动的逻辑，添加代码</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SpringDataPipeline springDataPipeline;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Spider.create(<span class="keyword">new</span> JobProcessor())</span><br><span class="line">            .addUrl(url)</span><br><span class="line">            .addPipeline(<span class="keyword">this</span>.springDataPipeline)</span><br><span class="line">            .setScheduler(<span class="keyword">new</span> QueueScheduler()</span><br><span class="line">                    .setDuplicateRemover(<span class="keyword">new</span> BloomFilterDuplicateRemover(<span class="number">10000000</span>)))</span><br><span class="line">            .thread(<span class="number">5</span>)</span><br><span class="line">            .run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>Author：</strong>nlby<br>
        <strong>Link：</strong><a href="https://shadowbynl.github.io/2020/06/16/java-spider-1/" title="https:&#x2F;&#x2F;shadowbynl.github.io&#x2F;2020&#x2F;06&#x2F;16&#x2F;java-spider-1&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;shadowbynl.github.io&#x2F;2020&#x2F;06&#x2F;16&#x2F;java-spider-1&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: 'f8845ecb71eab90181fe',
        clientSecret: '6852a4d3526507b2d6b2d34ad72dc98438196ae8',
        id: window.location.pathname,
        repo: 'lts-blog-comments',
        owner: 'shadowbynl',
        admin: 'shadowbynl'
    })
    gitalk.render('gitalk')
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1633604899812"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/violet.model.json"},"display":{"position":"left","width":180,"height":360},"mobile":{"show":true},"log":false});</script></body>

</html>
