<!DOCTYPE html>

<html lang="zh">

<head>
    
    <title>flask-study-4 - Memory</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" type="image/x-icon" />
    <meta name="description" content="黑马ihome项目 其三">
<meta property="og:type" content="article">
<meta property="og:title" content="flask-study-4">
<meta property="og:url" content="https://shadowbynl.github.io/2020/06/14/flask-study-4/index.html">
<meta property="og:site_name" content="Memory">
<meta property="og:description" content="黑马ihome项目 其三">
<meta property="og:locale">
<meta property="article:published_time" content="2020-06-14T14:44:42.000Z">
<meta property="article:modified_time" content="2020-06-14T15:42:28.497Z">
<meta property="article:author" content="nlby">
<meta property="article:tag" content="PythonWeb">
<meta name="twitter:card" content="summary">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1633604899812">
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1633604899812">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="nlby" class="mdui-btn mdui-btn-icon"><img src="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" alt="nlby"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="nlby">
            <img src="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" alt="nlby" alt="nlby">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>74</div>
        <div><span>Tags</span>13</div>
        <div><span>Categories</span>29</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="Search" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/?_wv=1027&k=5CfKHun" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/33077945" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/shadowbynl/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Flask/">Flask</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ORM/">ORM</a>
          <span class="category-list-count">7</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Web框架/">Web框架</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/css/">css</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/java/">java</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/写法/">写法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/功能点学习/">功能点学习</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/基础/">基础</a>
          <span class="category-list-count">20</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/大四/">大四</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/安全/">安全</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/容器/">容器</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/工具/">工具</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/工具使用/">工具使用</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/数据/">数据</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/数据可视化/">数据可视化</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/测试/">测试</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/爬虫/">爬虫</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/环境/">环境</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/知识点总结/">知识点总结</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/移动布局/">移动布局</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/算法/">算法</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/规划/">规划</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/记录/">记录</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/语法/">语法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随机/">随机</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随笔/">随笔</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/随记/">随记</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/面试/">面试</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/项目/">项目</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Go/" style="font-size: 16.67px;">Go</a> <a href="/tags/JavaWeb/" style="font-size: 20px;">JavaWeb</a> <a href="/tags/PythonWeb/" style="font-size: 15px;">PythonWeb</a> <a href="/tags/android/" style="font-size: 18.33px;">android</a> <a href="/tags/javase/" style="font-size: 10px;">javase</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/%E4%B8%93%E4%B8%9A%E8%AF%BE/" style="font-size: 11.67px;">专业课</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 13.33px;">前端</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 11.67px;">区块链</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 10px;">总结</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正则表达式</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">版本控制</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
    
  </div>

    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Archive</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">51</span></li></ul>
    </div>
  </div>



    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 nlby
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><embed src="https://jxiaoc.github.io/animeMusic/demo.html" width="100%"/>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 66.66666666666666%;"> 
              <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="flask-study-4" class="lazyload">
              <h1>flask-study-4</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年06月14日</a>
    <a><i class="nexmoefont icon-areachart"></i>5.4k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 30 分钟</a>
</div>

      

      <p><strong>黑马ihome项目 其三</strong></p>
<span id="more"></span>
<p>总结一下项目中实现的功能和技术点，按视图函数模块进行划分。</p>
<h4><span id="一-api">（一） api</span></h4><p><strong>一、注册登录之一： verify_code模块</strong></p>
<ol>
<li>获取图片验证码 get_image_code</li>
<li>获取短信验证码 get_sms_code</li>
</ol>
<p><strong>二、注册登录之二： passport模块</strong></p>
<ol>
<li>注册 register</li>
<li>登录 login</li>
<li>检查登录状态 check_login</li>
<li>退出登录 logout</li>
</ol>
<p><strong>三、用户信息： profile模块</strong></p>
<ol>
<li>设置用户头像 set_user_avatar</li>
<li>修改用户名 change_user_name</li>
<li>获取用户信息 get_user_profile</li>
<li>设置实名认证信息 set_user_auth</li>
<li>获取实名认证信息 get_user_auth</li>
</ol>
<p><strong>四、房屋信息： houses模块</strong></p>
<ol>
<li>获取地区信息 get_area_info</li>
<li>保存发布房源的信息 save_house_info</li>
<li>保存发布房源的图片 save_house_image</li>
<li>获取用户拥有的房源的信息 get_user_houses</li>
<li>获取首页的房屋信息 get_house_index</li>
<li>获取房源详情 get_house_detail</li>
<li>获取经筛选后的房屋列表 get_house_list</li>
</ol>
<p><strong>五、订单支付之一： orders模块</strong></p>
<ol>
<li>保存订单 save_order</li>
<li>查询用户的订单信息 get_user_orders</li>
<li>接单拒单 accept_reject_order</li>
<li>保存订单评论信息 save_order_comment</li>
</ol>
<p><strong>六、订单支付之二： pay模块</strong></p>
<ol>
<li>发起支付宝支付 order_pay</li>
<li>保存订单支付结果 save_order_payment_result</li>
</ol>
<h4><span id="二前端请求">（二）前端请求</span></h4><p><strong>一、注册登录</strong></p>
<ol>
<li>register.js 获取图片验证码 短信验证码 发送注册请求<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// js读取cookie的方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存图片验证码编号</span></span><br><span class="line"><span class="keyword">var</span> imageCodeId = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateUUID</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">window</span>.performance &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.performance.now === <span class="string">&quot;function&quot;</span>)&#123;</span><br><span class="line">        d += performance.now(); <span class="comment">//use high-precision timer if available</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> uuid = <span class="string">&#x27;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#x27;</span>.replace(<span class="regexp">/[xy]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> r = (d + <span class="built_in">Math</span>.random()*<span class="number">16</span>)%<span class="number">16</span> | <span class="number">0</span>;</span><br><span class="line">        d = <span class="built_in">Math</span>.floor(d/<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">return</span> (c==<span class="string">&#x27;x&#x27;</span> ? r : (r&amp;<span class="number">0x3</span>|<span class="number">0x8</span>)).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> uuid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateImageCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 形成图片验证码的后端地址， 设置到页面中，让浏览请求验证码图片</span></span><br><span class="line">    <span class="comment">// 1. 生成图片验证码编号</span></span><br><span class="line">    imageCodeId = generateUUID();</span><br><span class="line">    <span class="comment">// 是指图片url</span></span><br><span class="line">    <span class="keyword">var</span> url = <span class="string">&quot;/api/v1.0/image_codes/&quot;</span> + imageCodeId;</span><br><span class="line">    $(<span class="string">&quot;.image-code img&quot;</span>).attr(<span class="string">&quot;src&quot;</span>, url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendSMSCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 点击发送短信验证码后被执行的函数</span></span><br><span class="line">    $(<span class="string">&quot;.phonecode-a&quot;</span>).removeAttr(<span class="string">&quot;onclick&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> mobile = $(<span class="string">&quot;#mobile&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (!mobile) &#123;</span><br><span class="line">        $(<span class="string">&quot;#mobile-err span&quot;</span>).html(<span class="string">&quot;请填写正确的手机号！&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#mobile-err&quot;</span>).show();</span><br><span class="line">        $(<span class="string">&quot;.phonecode-a&quot;</span>).attr(<span class="string">&quot;onclick&quot;</span>, <span class="string">&quot;sendSMSCode();&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">var</span> imageCode = $(<span class="string">&quot;#imagecode&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (!imageCode) &#123;</span><br><span class="line">        $(<span class="string">&quot;#image-code-err span&quot;</span>).html(<span class="string">&quot;请填写验证码！&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#image-code-err&quot;</span>).show();</span><br><span class="line">        $(<span class="string">&quot;.phonecode-a&quot;</span>).attr(<span class="string">&quot;onclick&quot;</span>, <span class="string">&quot;sendSMSCode();&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造向后端请求的参数</span></span><br><span class="line">    <span class="keyword">var</span> req_data = &#123;</span><br><span class="line">        <span class="attr">image_code</span>: imageCode, <span class="comment">// 图片验证码的值</span></span><br><span class="line">        <span class="attr">image_code_id</span>: imageCodeId <span class="comment">// 图片验证码的编号，（全局变量）</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向后端发送请求</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/sms_codes/&quot;</span>+ mobile, req_data, <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// resp是后端返回的响应值，因为后端返回的是json字符串，</span></span><br><span class="line">        <span class="comment">// 所以ajax帮助我们把这个json字符串转换为js对象，resp就是转换后对象</span></span><br><span class="line">        <span class="keyword">if</span> (resp.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> num = <span class="number">60</span>;</span><br><span class="line">            <span class="comment">// 表示发送成功</span></span><br><span class="line">            <span class="keyword">var</span> timer = <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (num &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="comment">// 修改倒计时文本</span></span><br><span class="line">                    $(<span class="string">&quot;.phonecode-a&quot;</span>).html(num + <span class="string">&quot;秒&quot;</span>);</span><br><span class="line">                    num -= <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $(<span class="string">&quot;.phonecode-a&quot;</span>).html(<span class="string">&quot;获取验证码&quot;</span>);</span><br><span class="line">                    $(<span class="string">&quot;.phonecode-a&quot;</span>).attr(<span class="string">&quot;onclick&quot;</span>, <span class="string">&quot;sendSMSCode();&quot;</span>);</span><br><span class="line">                    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>, <span class="number">60</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(resp.errmsg);</span><br><span class="line">            $(<span class="string">&quot;.phonecode-a&quot;</span>).attr(<span class="string">&quot;onclick&quot;</span>, <span class="string">&quot;sendSMSCode();&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    generateImageCode();</span><br><span class="line">    $(<span class="string">&quot;#mobile&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#mobile-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#imagecode&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#image-code-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#phonecode&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#phone-code-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#password&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#password-err&quot;</span>).hide();</span><br><span class="line">        $(<span class="string">&quot;#password2-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#password2&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#password2-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为表单的提交补充自定义的函数行为 （提交事件e）</span></span><br><span class="line">    $(<span class="string">&quot;.form-register&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 阻止浏览器对于表单的默认自动提交行为</span></span><br><span class="line">        e.preventDefault();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> mobile = $(<span class="string">&quot;#mobile&quot;</span>).val();</span><br><span class="line">        <span class="keyword">var</span> phoneCode = $(<span class="string">&quot;#phonecode&quot;</span>).val();</span><br><span class="line">        <span class="keyword">var</span> passwd = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">        <span class="keyword">var</span> passwd2 = $(<span class="string">&quot;#password2&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span> (!mobile) &#123;</span><br><span class="line">            $(<span class="string">&quot;#mobile-err span&quot;</span>).html(<span class="string">&quot;请填写正确的手机号！&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#mobile-err&quot;</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (!phoneCode) &#123;</span><br><span class="line">            $(<span class="string">&quot;#phone-code-err span&quot;</span>).html(<span class="string">&quot;请填写短信验证码！&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#phone-code-err&quot;</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!passwd) &#123;</span><br><span class="line">            $(<span class="string">&quot;#password-err span&quot;</span>).html(<span class="string">&quot;请填写密码!&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#password-err&quot;</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (passwd != passwd2) &#123;</span><br><span class="line">            $(<span class="string">&quot;#password2-err span&quot;</span>).html(<span class="string">&quot;两次密码不一致!&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#password2-err&quot;</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用ajax向后端发送注册请求</span></span><br><span class="line">        <span class="keyword">var</span> req_data = &#123;</span><br><span class="line">            <span class="attr">mobile</span>: mobile,</span><br><span class="line">            <span class="attr">sms_code</span>: phoneCode,</span><br><span class="line">            <span class="attr">password</span>: passwd,</span><br><span class="line">            <span class="attr">password2</span>: passwd2,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> req_json = <span class="built_in">JSON</span>.stringify(req_data);</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/api/v1.0/users&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: req_json,</span><br><span class="line">            <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFToken&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">            &#125;, <span class="comment">// 请求头，将csrf_token值放到请求中，方便后端csrf进行验证</span></span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (resp.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 注册成功，跳转到主页</span></span><br><span class="line">                    location.href = <span class="string">&quot;/index.html&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    alert(resp.errmsg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>login.js 发送登录请求<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#mobile&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#mobile-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#password&quot;</span>).focus(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;#password-err&quot;</span>).hide();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;.form-login&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        mobile = $(<span class="string">&quot;#mobile&quot;</span>).val();</span><br><span class="line">        passwd = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span> (!mobile) &#123;</span><br><span class="line">            $(<span class="string">&quot;#mobile-err span&quot;</span>).html(<span class="string">&quot;请填写正确的手机号！&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#mobile-err&quot;</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (!passwd) &#123;</span><br><span class="line">            $(<span class="string">&quot;#password-err span&quot;</span>).html(<span class="string">&quot;请填写密码!&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#password-err&quot;</span>).show();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将表单的数据存放到对象data中</span></span><br><span class="line">        <span class="keyword">var</span> data = &#123;</span><br><span class="line">            <span class="attr">mobile</span>: mobile,</span><br><span class="line">            <span class="attr">password</span>: passwd</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 将data转为json字符串</span></span><br><span class="line">        <span class="keyword">var</span> jsonData = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;/api/v1.0/sessions&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: jsonData,</span><br><span class="line">            <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>:&#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFToken&quot;</span>:getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (data.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 登录成功，跳转到主页</span></span><br><span class="line">                    location.href = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 其他错误信息，在页面中展示</span></span><br><span class="line">                    $(<span class="string">&quot;#password-err span&quot;</span>).html(data.errmsg);</span><br><span class="line">                    $(<span class="string">&quot;#password-err&quot;</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>二、用户信息</strong></p>
<ol>
<li>profile.js 设置用户头像 修改用户名<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showSuccessMsg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.popup_con&#x27;</span>).fadeIn(<span class="string">&#x27;fast&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            $(<span class="string">&#x27;.popup_con&#x27;</span>).fadeOut(<span class="string">&#x27;fast&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;); </span><br><span class="line">        &#125;,<span class="number">1000</span>) </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#form-avatar&quot;</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 阻止表单的默认行为</span></span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="comment">// 利用jquery.form.min.js提供的ajaxSubmit对表单进行异步提交</span></span><br><span class="line">        $(<span class="built_in">this</span>).ajaxSubmit(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/api/v1.0/users/avatar&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFToken&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (resp.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 上传成功</span></span><br><span class="line">                    <span class="keyword">var</span> avatarUrl = resp.data.avatar_url;</span><br><span class="line">                    $(<span class="string">&quot;#user-avatar&quot;</span>).attr(<span class="string">&quot;src&quot;</span>, avatarUrl);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resp.errno == <span class="string">&quot;4101&quot;</span>) &#123;</span><br><span class="line">                    location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    alert(resp.errmsg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在页面加载是向后端查询用户的信息</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/user&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 用户未登录</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 查询到了用户的信息</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;#user-name&quot;</span>).val(resp.data.name);</span><br><span class="line">            <span class="keyword">if</span> (resp.data.avatar) &#123;</span><br><span class="line">                $(<span class="string">&quot;#user-avatar&quot;</span>).attr(<span class="string">&quot;src&quot;</span>, resp.data.avatar);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line"></span><br><span class="line">     $(<span class="string">&quot;#form-name&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="keyword">var</span> name = $(<span class="string">&quot;#user-name&quot;</span>).val();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">            alert(<span class="string">&quot;请填写用户名！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;/api/v1.0/users/name&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="built_in">JSON</span>.stringify(&#123;<span class="attr">name</span>: name&#125;),</span><br><span class="line">            <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>:&#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFTOKEN&quot;</span>:getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == data.errno) &#123;</span><br><span class="line">                    $(<span class="string">&quot;.error-msg&quot;</span>).hide();</span><br><span class="line">                    showSuccessMsg();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;4001&quot;</span> == data.errno) &#123;</span><br><span class="line">                    $(<span class="string">&quot;.error-msg&quot;</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == data.errno) &#123;</span><br><span class="line">                    location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>my.js 退出登录 获取用户信息<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击推出按钮时执行的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/api/v1.0/session&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&quot;X-CSRFToken&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">                location.href = <span class="string">&quot;/index.html&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/user&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 用户未登录</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 查询到了用户的信息</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;#user-name&quot;</span>).html(resp.data.name);</span><br><span class="line">            $(<span class="string">&quot;#user-mobile&quot;</span>).html(resp.data.mobile);</span><br><span class="line">            <span class="keyword">if</span> (resp.data.avatar) &#123;</span><br><span class="line">                $(<span class="string">&quot;#user-avatar&quot;</span>).attr(<span class="string">&quot;src&quot;</span>, resp.data.avatar);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>auth.js 设置与获取实名认证信息<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showSuccessMsg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.popup_con&#x27;</span>).fadeIn(<span class="string">&#x27;fast&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            $(<span class="string">&#x27;.popup_con&#x27;</span>).fadeOut(<span class="string">&#x27;fast&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;); </span><br><span class="line">        &#125;,<span class="number">1000</span>) </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 查询用户的实名认证信息</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/users/auth&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 4101代表用户未登录</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            <span class="comment">// 如果返回的数据中real_name与id_card不为null，表示用户有填写实名信息</span></span><br><span class="line">            <span class="keyword">if</span> (resp.data.real_name &amp;&amp; resp.data.id_card) &#123;</span><br><span class="line">                $(<span class="string">&quot;#real-name&quot;</span>).val(resp.data.real_name);</span><br><span class="line">                $(<span class="string">&quot;#id-card&quot;</span>).val(resp.data.id_card);</span><br><span class="line">                <span class="comment">// 给input添加disabled属性，禁止用户修改</span></span><br><span class="line">                $(<span class="string">&quot;#real-name&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                $(<span class="string">&quot;#id-card&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 隐藏提交保存按钮</span></span><br><span class="line">                $(<span class="string">&quot;#form-auth&gt;input[type=submit]&quot;</span>).hide();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(resp.errmsg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 管理实名信息表单的提交行为</span></span><br><span class="line">    $(<span class="string">&quot;#form-auth&quot;</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="comment">// 如果用户没有填写完整，展示错误信息</span></span><br><span class="line">        <span class="keyword">var</span> realName = $(<span class="string">&quot;#real-name&quot;</span>).val();</span><br><span class="line">        <span class="keyword">var</span> idCard = $(<span class="string">&quot;#id-card&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span> (realName == <span class="string">&quot;&quot;</span> ||  idCard == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;.error-msg&quot;</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将表单的数据转换为json字符串</span></span><br><span class="line">        <span class="keyword">var</span> data = &#123;</span><br><span class="line">            <span class="attr">real_name</span>: realName,</span><br><span class="line">            <span class="attr">id_card</span>: idCard</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> jsonData = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 向后端发送请求</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;/api/v1.0/users/auth&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: jsonData,</span><br><span class="line">            <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFTOKEN&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> == resp.errno) &#123;</span><br><span class="line">                    $(<span class="string">&quot;.error-msg&quot;</span>).hide();</span><br><span class="line">                    <span class="comment">// 显示保存成功的提示信息</span></span><br><span class="line">                    showSuccessMsg();</span><br><span class="line">                    $(<span class="string">&quot;#real-name&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                    $(<span class="string">&quot;#id-card&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                    $(<span class="string">&quot;#form-auth&gt;input[type=submit]&quot;</span>).hide();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>三、房屋信息</strong></p>
<ol>
<li>index.js 检查用户的登录状态以控制不同显示 获取幻灯片要展示的房屋基本信息 获取城区信息<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模态框居中的控制</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">centerModals</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.modal&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;   <span class="comment">//遍历每一个模态框</span></span><br><span class="line">        <span class="keyword">var</span> $clone = $(<span class="built_in">this</span>).clone().css(<span class="string">&#x27;display&#x27;</span>, <span class="string">&#x27;block&#x27;</span>).appendTo(<span class="string">&#x27;body&#x27;</span>);    </span><br><span class="line">        <span class="keyword">var</span> top = <span class="built_in">Math</span>.round(($clone.height() - $clone.find(<span class="string">&#x27;.modal-content&#x27;</span>).height()) / <span class="number">2</span>);</span><br><span class="line">        top = top &gt; <span class="number">0</span> ? top : <span class="number">0</span>;</span><br><span class="line">        $clone.remove();</span><br><span class="line">        $(<span class="built_in">this</span>).find(<span class="string">&#x27;.modal-content&#x27;</span>).css(<span class="string">&quot;margin-top&quot;</span>, top-<span class="number">30</span>);  <span class="comment">//修正原先已经有的30个像素</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setStartDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> startDate = $(<span class="string">&quot;#start-date-input&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (startDate) &#123;</span><br><span class="line">        $(<span class="string">&quot;.search-btn&quot;</span>).attr(<span class="string">&quot;start-date&quot;</span>, startDate);</span><br><span class="line">        $(<span class="string">&quot;#start-date-btn&quot;</span>).html(startDate);</span><br><span class="line">        $(<span class="string">&quot;#end-date&quot;</span>).datepicker(<span class="string">&quot;destroy&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#end-date-btn&quot;</span>).html(<span class="string">&quot;离开日期&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#end-date-input&quot;</span>).val(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;.search-btn&quot;</span>).attr(<span class="string">&quot;end-date&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#end-date&quot;</span>).datepicker(&#123;</span><br><span class="line">            <span class="attr">language</span>: <span class="string">&quot;zh-CN&quot;</span>,</span><br><span class="line">            <span class="attr">keyboardNavigation</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">startDate</span>: startDate,</span><br><span class="line">            <span class="attr">format</span>: <span class="string">&quot;yyyy-mm-dd&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="string">&quot;#end-date&quot;</span>).on(<span class="string">&quot;changeDate&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">&quot;#end-date-input&quot;</span>).val(</span><br><span class="line">                $(<span class="built_in">this</span>).datepicker(<span class="string">&quot;getFormattedDate&quot;</span>)</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="string">&quot;.end-date&quot;</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&quot;#start-date-modal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setEndDate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> endDate = $(<span class="string">&quot;#end-date-input&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (endDate) &#123;</span><br><span class="line">        $(<span class="string">&quot;.search-btn&quot;</span>).attr(<span class="string">&quot;end-date&quot;</span>, endDate);</span><br><span class="line">        $(<span class="string">&quot;#end-date-btn&quot;</span>).html(endDate);</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&quot;#end-date-modal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">goToSearchPage</span>(<span class="params">th</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="string">&quot;/search.html?&quot;</span>;</span><br><span class="line">    url += (<span class="string">&quot;aid=&quot;</span> + $(th).attr(<span class="string">&quot;area-id&quot;</span>));</span><br><span class="line">    url += <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> areaName = $(th).attr(<span class="string">&quot;area-name&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">undefined</span> == areaName) areaName=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    url += (<span class="string">&quot;aname=&quot;</span> + areaName);</span><br><span class="line">    url += <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">    url += (<span class="string">&quot;sd=&quot;</span> + $(th).attr(<span class="string">&quot;start-date&quot;</span>));</span><br><span class="line">    url += <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">    url += (<span class="string">&quot;ed=&quot;</span> + $(th).attr(<span class="string">&quot;end-date&quot;</span>));</span><br><span class="line">    location.href = url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 检查用户的登录状态</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/session&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;.top-bar&gt;.user-info&gt;.user-name&quot;</span>).html(resp.data.name);</span><br><span class="line">            $(<span class="string">&quot;.top-bar&gt;.user-info&quot;</span>).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $(<span class="string">&quot;.top-bar&gt;.register-login&quot;</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取幻灯片要展示的房屋基本信息</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/houses/index&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;.swiper-wrapper&quot;</span>).html(template(<span class="string">&quot;swiper-houses-tmpl&quot;</span>, &#123;<span class="attr">houses</span>:resp.data&#125;));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置幻灯片对象，开启幻灯片滚动</span></span><br><span class="line">            <span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper (<span class="string">&#x27;.swiper-container&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">loop</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">autoplay</span>: <span class="number">2000</span>,</span><br><span class="line">                <span class="attr">autoplayDisableOnInteraction</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">pagination</span>: <span class="string">&#x27;.swiper-pagination&#x27;</span>,</span><br><span class="line">                <span class="attr">paginationClickable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取城区信息</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/areas&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;.area-list&quot;</span>).html(template(<span class="string">&quot;area-list-tmpl&quot;</span>, &#123;<span class="attr">areas</span>:resp.data&#125;));</span><br><span class="line"></span><br><span class="line">            $(<span class="string">&quot;.area-list a&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">                $(<span class="string">&quot;#area-btn&quot;</span>).html($(<span class="built_in">this</span>).html());</span><br><span class="line">                $(<span class="string">&quot;.search-btn&quot;</span>).attr(<span class="string">&quot;area-id&quot;</span>, $(<span class="built_in">this</span>).attr(<span class="string">&quot;area-id&quot;</span>));</span><br><span class="line">                $(<span class="string">&quot;.search-btn&quot;</span>).attr(<span class="string">&quot;area-name&quot;</span>, $(<span class="built_in">this</span>).html());</span><br><span class="line">                $(<span class="string">&quot;#area-modal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&#x27;.modal&#x27;</span>).on(<span class="string">&#x27;show.bs.modal&#x27;</span>, centerModals);      <span class="comment">//当模态框出现的时候</span></span><br><span class="line">    $(<span class="built_in">window</span>).on(<span class="string">&#x27;resize&#x27;</span>, centerModals);               <span class="comment">//当窗口大小变化的时候</span></span><br><span class="line">    $(<span class="string">&quot;#start-date&quot;</span>).datepicker(&#123;</span><br><span class="line">        <span class="attr">language</span>: <span class="string">&quot;zh-CN&quot;</span>,</span><br><span class="line">        <span class="attr">keyboardNavigation</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">startDate</span>: <span class="string">&quot;today&quot;</span>,</span><br><span class="line">        <span class="attr">format</span>: <span class="string">&quot;yyyy-mm-dd&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&quot;#start-date&quot;</span>).on(<span class="string">&quot;changeDate&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> date = $(<span class="built_in">this</span>).datepicker(<span class="string">&quot;getFormattedDate&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#start-date-input&quot;</span>).val(date);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>detail.js 获取房屋的具体信息<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hrefBack</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    history.go(-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析提取url中的查询字符串参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decodeQuery</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> search = <span class="built_in">decodeURI</span>(<span class="built_in">document</span>.location.search);</span><br><span class="line">    <span class="keyword">return</span> search.replace(<span class="regexp">/(^\?)/</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;&amp;&#x27;</span>).reduce(<span class="function"><span class="keyword">function</span>(<span class="params">result, item</span>)</span>&#123;</span><br><span class="line">        values = item.split(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        result[values[<span class="number">0</span>]] = values[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;, &#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 获取详情页面要展示的房屋编号</span></span><br><span class="line">    <span class="keyword">var</span> queryData = decodeQuery();</span><br><span class="line">    <span class="keyword">var</span> houseId = queryData[<span class="string">&quot;id&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取该房屋的详细信息</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/houses/&quot;</span> + houseId, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;.swiper-container&quot;</span>).html(template(<span class="string">&quot;house-image-tmpl&quot;</span>, &#123;<span class="attr">img_urls</span>:resp.data.house.img_urls, <span class="attr">price</span>:resp.data.house.price&#125;));</span><br><span class="line">            $(<span class="string">&quot;.detail-con&quot;</span>).html(template(<span class="string">&quot;house-detail-tmpl&quot;</span>, &#123;<span class="attr">house</span>:resp.data.house&#125;));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// resp.user_id为访问页面用户,resp.data.user_id为房东</span></span><br><span class="line">            <span class="keyword">if</span> (resp.data.user_id != resp.data.house.user_id) &#123;</span><br><span class="line">                $(<span class="string">&quot;.book-house&quot;</span>).attr(<span class="string">&quot;href&quot;</span>, <span class="string">&quot;/booking.html?hid=&quot;</span>+resp.data.house.hid);</span><br><span class="line">                $(<span class="string">&quot;.book-house&quot;</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper (<span class="string">&#x27;.swiper-container&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">loop</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">autoplay</span>: <span class="number">2000</span>,</span><br><span class="line">                <span class="attr">autoplayDisableOnInteraction</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">pagination</span>: <span class="string">&#x27;.swiper-pagination&#x27;</span>,</span><br><span class="line">                <span class="attr">paginationType</span>: <span class="string">&#x27;fraction&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>myhouse.js 获取用户拥有的房源信息<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 对于发布房源，只有认证后的用户才可以，所以先判断用户的实名认证状态</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/users/auth&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">            <span class="comment">// 用户未登录</span></span><br><span class="line">            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            <span class="comment">// 未认证的用户，在页面中展示 &quot;去认证&quot;的按钮</span></span><br><span class="line">            <span class="keyword">if</span> (!(resp.data.real_name &amp;&amp; resp.data.id_card)) &#123;</span><br><span class="line">                $(<span class="string">&quot;.auth-warn&quot;</span>).show();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 已认证的用户，请求其之前发布的房源信息</span></span><br><span class="line">            $.get(<span class="string">&quot;/api/v1.0/user/houses&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">                    $(<span class="string">&quot;#houses-list&quot;</span>).html(template(<span class="string">&quot;houses-list-tmpl&quot;</span>, &#123;<span class="attr">houses</span>:resp.data.houses&#125;));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $(<span class="string">&quot;#houses-list&quot;</span>).html(template(<span class="string">&quot;houses-list-tmpl&quot;</span>, &#123;<span class="attr">houses</span>:[]&#125;));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>newhouse.js 获取城区信息 上传房源基本信息 上传房源图片<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 向后端获取城区信息</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/areas&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (resp.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> areas = resp.data;</span><br><span class="line">            <span class="comment">// for (i=0; i&lt;areas.length; i++) &#123;</span></span><br><span class="line">            <span class="comment">//     var area = areas[i];</span></span><br><span class="line">            <span class="comment">//     $(&quot;#area-id&quot;).append(&#x27;&lt;option value=&quot;&#x27;+ area.aid +&#x27;&quot;&gt;&#x27;+ area.aname +&#x27;&lt;/option&gt;&#x27;);</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用js模板</span></span><br><span class="line">            <span class="keyword">var</span> html = template(<span class="string">&quot;areas-tmpl&quot;</span>, &#123;<span class="attr">areas</span>: areas&#125;)</span><br><span class="line">            $(<span class="string">&quot;#area-id&quot;</span>).html(html);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(resp.errmsg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;, <span class="string">&quot;json&quot;</span>);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#form-house-info&quot;</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理表单数据</span></span><br><span class="line">        <span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line">        $(<span class="string">&quot;#form-house-info&quot;</span>).serializeArray().map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; data[x.name]=x.value &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 收集设置id信息</span></span><br><span class="line">        <span class="keyword">var</span> facility = [];</span><br><span class="line">        $(<span class="string">&quot;:checked[name=facility]&quot;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">index, x</span>)</span>&#123;facility[index] = $(x).val()&#125;);</span><br><span class="line"></span><br><span class="line">        data.facility = facility;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 向后端发送请求</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/api/v1.0/houses/info&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFToken&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (resp.errno == <span class="string">&quot;4101&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 用户未登录</span></span><br><span class="line">                    location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resp.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">                    <span class="comment">// 隐藏基本信息表单</span></span><br><span class="line">                    $(<span class="string">&quot;#form-house-info&quot;</span>).hide();</span><br><span class="line">                    <span class="comment">// 显示图片表单</span></span><br><span class="line">                    $(<span class="string">&quot;#form-house-image&quot;</span>).show();</span><br><span class="line">                    <span class="comment">// 设置图片表单中的house_id</span></span><br><span class="line">                    $(<span class="string">&quot;#house-id&quot;</span>).val(resp.data.house_id);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    alert(resp.errmsg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#form-house-image&quot;</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        $(<span class="built_in">this</span>).ajaxSubmit(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;/api/v1.0/houses/image&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&quot;X-CSRFToken&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (resp.errno == <span class="string">&quot;4101&quot;</span>) &#123;</span><br><span class="line">                    location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resp.errno == <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">                    $(<span class="string">&quot;.house-image-cons&quot;</span>).append(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span> + resp.data.image_url +<span class="string">&#x27;&quot;&gt;&#x27;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    alert(resp.errmsg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>四、订单支付</strong><br>因未实现支付宝接入支付，故此处仅列查询订单的js。</p>
<ol>
<li>orders.js 获取房客订单<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模态框居中的控制</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">centerModals</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.modal&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;   <span class="comment">//遍历每一个模态框</span></span><br><span class="line">        <span class="keyword">var</span> $clone = $(<span class="built_in">this</span>).clone().css(<span class="string">&#x27;display&#x27;</span>, <span class="string">&#x27;block&#x27;</span>).appendTo(<span class="string">&#x27;body&#x27;</span>);    </span><br><span class="line">        <span class="keyword">var</span> top = <span class="built_in">Math</span>.round(($clone.height() - $clone.find(<span class="string">&#x27;.modal-content&#x27;</span>).height()) / <span class="number">2</span>);</span><br><span class="line">        top = top &gt; <span class="number">0</span> ? top : <span class="number">0</span>;</span><br><span class="line">        $clone.remove();</span><br><span class="line">        $(<span class="built_in">this</span>).find(<span class="string">&#x27;.modal-content&#x27;</span>).css(<span class="string">&quot;margin-top&quot;</span>, top-<span class="number">30</span>);  <span class="comment">//修正原先已经有的30个像素</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.modal&#x27;</span>).on(<span class="string">&#x27;show.bs.modal&#x27;</span>, centerModals);      <span class="comment">//当模态框出现的时候</span></span><br><span class="line">    $(<span class="built_in">window</span>).on(<span class="string">&#x27;resize&#x27;</span>, centerModals);</span><br><span class="line">    <span class="comment">// 查询房客订单</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/user/orders?role=custom&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;.orders-list&quot;</span>).html(template(<span class="string">&quot;orders-list-tmpl&quot;</span>, &#123;<span class="attr">orders</span>:resp.data.orders&#125;));</span><br><span class="line">            $(<span class="string">&quot;.order-pay&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).parents(<span class="string">&quot;li&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&quot;/api/v1.0/orders/&quot;</span> + orderId + <span class="string">&quot;/payment&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">                    <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;X-CSRFToken&quot;</span>: getCookie(<span class="string">&quot;csrf_token&quot;</span>),</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            <span class="comment">// 引导用户跳转到支付宝连接</span></span><br><span class="line">                            location.href = resp.data.pay_url;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            $(<span class="string">&quot;.order-comment&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).parents(<span class="string">&quot;li&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                $(<span class="string">&quot;.modal-comment&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>, orderId);</span><br><span class="line">            &#125;);</span><br><span class="line">            $(<span class="string">&quot;.modal-comment&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> comment = $(<span class="string">&quot;#comment&quot;</span>).val()</span><br><span class="line">                <span class="keyword">if</span> (!comment) <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">var</span> data = &#123;</span><br><span class="line">                    <span class="attr">order_id</span>:orderId,</span><br><span class="line">                    <span class="attr">comment</span>:comment</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="comment">// 处理评论</span></span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    <span class="attr">url</span>:<span class="string">&quot;/api/v1.0/orders/&quot;</span>+orderId+<span class="string">&quot;/comment&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>:<span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">                    <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">                    <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                    <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">                    <span class="attr">headers</span>:&#123;</span><br><span class="line">                        <span class="string">&quot;X-CSRFTOKEN&quot;</span>:getCookie(<span class="string">&quot;csrf_token&quot;</span>),</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">success</span>:<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            $(<span class="string">&quot;.orders-list&gt;li[order-id=&quot;</span>+ orderId +<span class="string">&quot;]&gt;div.order-content&gt;div.order-text&gt;ul li:eq(4)&gt;span&quot;</span>).html(<span class="string">&quot;已完成&quot;</span>);</span><br><span class="line">                            $(<span class="string">&quot;ul.orders-list&gt;li[order-id=&quot;</span>+ orderId +<span class="string">&quot;]&gt;div.order-title&gt;div.order-operate&quot;</span>).hide();</span><br><span class="line">                            $(<span class="string">&quot;#comment-modal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>lorder,js 获取房主订单<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模态框居中的控制</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">centerModals</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.modal&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;   <span class="comment">//遍历每一个模态框</span></span><br><span class="line">        <span class="keyword">var</span> $clone = $(<span class="built_in">this</span>).clone().css(<span class="string">&#x27;display&#x27;</span>, <span class="string">&#x27;block&#x27;</span>).appendTo(<span class="string">&#x27;body&#x27;</span>);    </span><br><span class="line">        <span class="keyword">var</span> top = <span class="built_in">Math</span>.round(($clone.height() - $clone.find(<span class="string">&#x27;.modal-content&#x27;</span>).height()) / <span class="number">2</span>);</span><br><span class="line">        top = top &gt; <span class="number">0</span> ? top : <span class="number">0</span>;</span><br><span class="line">        $clone.remove();</span><br><span class="line">        $(<span class="built_in">this</span>).find(<span class="string">&#x27;.modal-content&#x27;</span>).css(<span class="string">&quot;margin-top&quot;</span>, top-<span class="number">30</span>);  <span class="comment">//修正原先已经有的30个像素</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> r = <span class="built_in">document</span>.cookie.match(<span class="string">&quot;\\b&quot;</span> + name + <span class="string">&quot;=([^;]*)\\b&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> r ? r[<span class="number">1</span>] : <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $(<span class="string">&#x27;.modal&#x27;</span>).on(<span class="string">&#x27;show.bs.modal&#x27;</span>, centerModals);      <span class="comment">//当模态框出现的时候</span></span><br><span class="line">    $(<span class="built_in">window</span>).on(<span class="string">&#x27;resize&#x27;</span>, centerModals);</span><br><span class="line">    <span class="comment">// 查询房东的订单</span></span><br><span class="line">    $.get(<span class="string">&quot;/api/v1.0/user/orders?role=landlord&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">            $(<span class="string">&quot;.orders-list&quot;</span>).html(template(<span class="string">&quot;orders-list-tmpl&quot;</span>, &#123;<span class="attr">orders</span>:resp.data.orders&#125;));</span><br><span class="line">            $(<span class="string">&quot;.order-accept&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).parents(<span class="string">&quot;li&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                $(<span class="string">&quot;.modal-accept&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>, orderId);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 接单处理</span></span><br><span class="line">            $(<span class="string">&quot;.modal-accept&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    <span class="attr">url</span>:<span class="string">&quot;/api/v1.0/orders/&quot;</span>+orderId+<span class="string">&quot;/status&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>:<span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">                    <span class="attr">data</span>:<span class="string">&#x27;&#123;&quot;action&quot;:&quot;accept&quot;&#125;&#x27;</span>,</span><br><span class="line">                    <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                    <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">                    <span class="attr">headers</span>:&#123;</span><br><span class="line">                        <span class="string">&quot;X-CSRFTOKEN&quot;</span>:getCookie(<span class="string">&quot;csrf_token&quot;</span>),</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">success</span>:<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            $(<span class="string">&quot;.orders-list&gt;li[order-id=&quot;</span>+ orderId +<span class="string">&quot;]&gt;div.order-content&gt;div.order-text&gt;ul li:eq(4)&gt;span&quot;</span>).html(<span class="string">&quot;已接单&quot;</span>);</span><br><span class="line">                            $(<span class="string">&quot;ul.orders-list&gt;li[order-id=&quot;</span>+ orderId +<span class="string">&quot;]&gt;div.order-title&gt;div.order-operate&quot;</span>).hide();</span><br><span class="line">                            $(<span class="string">&quot;#accept-modal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">            $(<span class="string">&quot;.order-reject&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).parents(<span class="string">&quot;li&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                $(<span class="string">&quot;.modal-reject&quot;</span>).attr(<span class="string">&quot;order-id&quot;</span>, orderId);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 处理拒单</span></span><br><span class="line">            $(<span class="string">&quot;.modal-reject&quot;</span>).on(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> orderId = $(<span class="built_in">this</span>).attr(<span class="string">&quot;order-id&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> reject_reason = $(<span class="string">&quot;#reject-reason&quot;</span>).val();</span><br><span class="line">                <span class="keyword">if</span> (!reject_reason) <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">var</span> data = &#123;</span><br><span class="line">                    <span class="attr">action</span>: <span class="string">&quot;reject&quot;</span>,</span><br><span class="line">                    <span class="attr">reason</span>:reject_reason</span><br><span class="line">                &#125;;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    <span class="attr">url</span>:<span class="string">&quot;/api/v1.0/orders/&quot;</span>+orderId+<span class="string">&quot;/status&quot;</span>,</span><br><span class="line">                    <span class="attr">type</span>:<span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">                    <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">                    <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                    <span class="attr">headers</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;X-CSRFTOKEN&quot;</span>:getCookie(<span class="string">&quot;csrf_token&quot;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">                    <span class="attr">success</span>:<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;4101&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            location.href = <span class="string">&quot;/login.html&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span> == resp.errno) &#123;</span><br><span class="line">                            $(<span class="string">&quot;.orders-list&gt;li[order-id=&quot;</span>+ orderId +<span class="string">&quot;]&gt;div.order-content&gt;div.order-text&gt;ul li:eq(4)&gt;span&quot;</span>).html(<span class="string">&quot;已拒单&quot;</span>);</span><br><span class="line">                            $(<span class="string">&quot;ul.orders-list&gt;li[order-id=&quot;</span>+ orderId +<span class="string">&quot;]&gt;div.order-title&gt;div.order-operate&quot;</span>).hide();</span><br><span class="line">                            $(<span class="string">&quot;#reject-modal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4><span id="三技术点">（三）技术点</span></h4></li>
</ol>
<p><strong>一、第三方sdk的接入使用</strong></p>
<ol>
<li>生成图片验证码</li>
<li>发送短信  <a target="_blank" rel="noopener" href="http://www.yuntongxun.com">www.yuntongxun.com</a></li>
<li>图片存储 七牛</li>
<li>支付宝 python-alipay-sdk <a target="_blank" rel="noopener" href="https://github.com/fzlee/alipay">https://github.com/fzlee/alipay</a></li>
</ol>
<p><strong>二、前端界面显示模板/插件</strong></p>
<ol>
<li>art-template<br><a target="_blank" rel="noopener" href="https://aui.github.io/art-template/zh-cn/index.html">https://aui.github.io/art-template/zh-cn/index.html</a></li>
<li>jquery表单插件</li>
<li>swiper轮播图插件</li>
</ol>
<p><strong>三、ajax请求的构成</strong></p>
<ol>
<li>请求参数/请求体的设置</li>
<li>响应回调</li>
</ol>
<p><strong>四、redis缓存的各种设置</strong></p>
<ol>
<li>有效期逻辑</li>
<li>存储数据类型</li>
</ol>
<p><strong>五、模型类属性设置与自定义方法</strong></p>
<ol>
<li>转换为字典的方法</li>
<li>属性装饰器</li>
</ol>
<p><strong>六、返回json数据的构造</strong></p>
<ol>
<li>jsonify</li>
<li>json.dumps</li>
<li>redis存取</li>
</ol>
<p><strong>七、sqlalchemy进行数据库操作</strong></p>
<ol>
<li>复杂查询条件的设置</li>
<li>优化</li>
</ol>
<p><strong>八、视图函数获取参数、检验参数、业务逻辑处理、返回结果的整体流程与逻辑细节处理</strong></p>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>Author：</strong>nlby<br>
        <strong>Link：</strong><a href="https://shadowbynl.github.io/2020/06/14/flask-study-4/" title="https:&#x2F;&#x2F;shadowbynl.github.io&#x2F;2020&#x2F;06&#x2F;14&#x2F;flask-study-4&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;shadowbynl.github.io&#x2F;2020&#x2F;06&#x2F;14&#x2F;flask-study-4&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/Flask/">Flask</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/PythonWeb/" rel="tag">PythonWeb</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: 'f8845ecb71eab90181fe',
        clientSecret: '6852a4d3526507b2d6b2d34ad72dc98438196ae8',
        id: window.location.pathname,
        repo: 'lts-blog-comments',
        owner: 'shadowbynl',
        admin: 'shadowbynl'
    })
    gitalk.render('gitalk')
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1633604899816"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/violet.model.json"},"display":{"position":"left","width":180,"height":360},"mobile":{"show":true},"log":false});</script></body>

</html>
