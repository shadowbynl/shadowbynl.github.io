<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>mongodb | Memory</title>
  <meta name="description" content="MongoDB">
<meta property="og:type" content="article">
<meta property="og:title" content="mongodb">
<meta property="og:url" content="http://nlbyd1119.online/2020/06/23/mongodb/index.html">
<meta property="og:site_name" content="Memory">
<meta property="og:description" content="MongoDB">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2020-06-23T11:28:13.000Z">
<meta property="article:modified_time" content="2020-06-23T12:39:00.162Z">
<meta property="article:author" content="nlby">
<meta property="article:tag" content="JavaWeb">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://nlbyd1119.online/2020/06/23/mongodb/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Memory" type="application/atom+xml">
  
  
    <link rel="icon" href="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitment@0.0.3/style/default.min.css">
  
  
  
<meta name="generator" content="Hexo 4.2.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/nlby" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">nlby</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> NanJing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
      </ul>
      
	

	  <embed src="http://nlby.gitee.io/nlby.gitee.io/demo.html" width="100%"/>
	  <iframe frameborder="no" border="0" marginwidth="0"
						marginheight="0" width="100%" height=86 src="//music.163.com/outchain/player?type=0&id=4872500795&auto=0&height=66">
	  </iframe>
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>记录和总结一下学习过程及其他</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/2005/">2005</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2006/">2006</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2007/">2007</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2008/">2008</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2009/">2009</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2011/">2011</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2012/">2012</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2013/">2013</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2014/">2014</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2017/">2017</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/70/">70</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/80/">80</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flask/">Flask</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JSP/">JSP</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NoSql/">NoSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ORM/">ORM</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%A1%86%E6%9E%B6/">Web框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fabric/">fabric</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live2d/">live2d</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/numpy/">numpy</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pandas/">pandas</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/plot/">plot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%A8%E9%83%A8%E6%88%90%E4%B8%BAF/">全部成为F</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%99%E6%B3%95/">写法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%9F%E8%83%BD%E7%82%B9%E5%AD%A6%E4%B9%A0/">功能点学习</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8/">安全</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%B9%E5%99%A8/">容器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8E%A7%E5%88%B6%E5%99%A8/">控制器</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">数据可视化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/">日志</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8/">框架使用</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A6%82%E5%BF%B5/">概念</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A8%A1%E6%9D%BF/">模板</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7/">版本控制工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8C%AB%E8%85%BB/">猫腻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83/">环境</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/">知识点总结</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A1%AC%E4%BB%B6/">硬件</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%BB%E5%8A%A8%E5%B8%83%E5%B1%80/">移动布局</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%B0%E5%BD%95/">记录</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BA%E6%96%87/">论文</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a><span class="tag-list-count">40</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python-Science/" rel="tag">Python Science</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PythonWeb/" rel="tag">PythonWeb</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%93%E4%B8%9A%E8%AF%BE/" rel="tag">专业课</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6/" rel="tag">博客框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A3%B0%E4%BC%98%E8%AE%B0%E5%BD%95/" rel="tag">声优记录</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E8%AF%B4%E6%95%B4%E7%90%86/" rel="tag">小说整理</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%88%E6%9E%9C/" rel="tag">效果</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" rel="tag">版本控制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%95%AA%E5%89%A7%E8%AE%B0%E5%BD%95/" rel="tag">番剧记录</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%9A%E7%94%A8/" rel="tag">通用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a><span class="tag-list-count">10</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Go/" style="font-size: 13.55px;">Go</a> <a href="/tags/JavaWeb/" style="font-size: 14px;">JavaWeb</a> <a href="/tags/Python-Science/" style="font-size: 13.64px;">Python Science</a> <a href="/tags/PythonWeb/" style="font-size: 13.27px;">PythonWeb</a> <a href="/tags/android/" style="font-size: 13.82px;">android</a> <a href="/tags/sql/" style="font-size: 13px;">sql</a> <a href="/tags/%E4%B8%93%E4%B8%9A%E8%AF%BE/" style="font-size: 13.18px;">专业课</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 13.18px;">前端</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 13.45px;">区块链</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6/" style="font-size: 13px;">博客框架</a> <a href="/tags/%E5%A3%B0%E4%BC%98%E8%AE%B0%E5%BD%95/" style="font-size: 13.09px;">声优记录</a> <a href="/tags/%E5%B0%8F%E8%AF%B4%E6%95%B4%E7%90%86/" style="font-size: 13.09px;">小说整理</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.36px;">总结</a> <a href="/tags/%E6%95%88%E6%9E%9C/" style="font-size: 13px;">效果</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 13px;">机器学习</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 13px;">正则表达式</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 13px;">版本控制</a> <a href="/tags/%E7%95%AA%E5%89%A7%E8%AE%B0%E5%BD%95/" style="font-size: 13.91px;">番剧记录</a> <a href="/tags/%E9%80%9A%E7%94%A8/" style="font-size: 13px;">通用</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 13.73px;">随笔</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">51</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/30/%E5%8D%81%E4%B8%80%E6%9C%88%E6%9C%AB%E6%80%BB%E7%BB%93/" class="title">十一月末总结</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-30T14:54:03.000Z" itemprop="datePublished">2020-11-30</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/">知识点总结</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/01/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E9%80%89%E4%BF%AE%EF%BC%88%E4%BC%AA%EF%BC%89/" class="title">人工智能选修（伪）</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-01T06:26:38.000Z" itemprop="datePublished">2020-11-01</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/">知识点总结</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/31/%E6%B1%87%E7%BC%96%E7%A8%8B%E5%BA%8F%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E8%AF%B4%E6%98%8E/" class="title">汇编程序功能实现说明</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-31T15:58:55.000Z" itemprop="datePublished">2020-10-31</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2020/10/23/app%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96%E7%AD%96%E7%95%A5/" class="title">app数据抓取策略</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-23T11:32:25.000Z" itemprop="datePublished">2020-10-23</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/18/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%92%8Csolidity%E5%A4%8D%E4%B9%A0%E5%85%B6%E4%BA%8C/" class="title">以太坊和solidity复习其二</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-18T06:18:39.000Z" itemprop="datePublished">2020-10-18</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
	<!------ 位置可自定义 ------>
<div class="Canvas" style="position: fixed; right: 0px; bottom: 0px;z-index: 99999999" id="L2dCanvas"></div>

<!------ 依赖 JS | Dependent JS ------>
<!---- 可选 | Optional ---->
<!-- 兼容低版本浏览器 | Compatible with low-level browsers -->
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"> </script>
<!-- 音频播放兼容 | Audio playback compatible -->
<script src="https://cdn.jsdelivr.net/npm/howler@2.1.3/dist/howler.min.js"></script>
<!---- 必需 | Required ---->
<script src="https://cdn.jsdelivr.net/gh/nlby/live2dCDN@1.0.2/static/live2dcubismcore.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pixi.js@4.6.1/dist/pixi.min.js"></script>
<!-- live2dv3.js -->
<script src="https://cdn.jsdelivr.net/gh/nlby/live2dCDN@1.0.2/static/live2dv3.js"></script>

<!------ 加载Live2d模型 | Load Live2d model ------>	
<script>
    window.onload = () => {
        new l2dViewer({
             el: document.getElementById('L2dCanvas'),
                basePath: 'https://cdn.jsdelivr.net/gh/nlby/live2dCDN@1.1.1/assets/', // 模型根目录
                modelName: 'xuefeng_3', // 模型目录
                sizeLimit: false,
                mobileLimit: false
            
            
        })
    }
</script>
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-mongodb" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      mongodb
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2020/06/23/mongodb/" class="article-date">
	  <time datetime="2020-06-23T11:28:13.000Z" itemprop="datePublished">2020-06-23</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/NoSql/">NoSql</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/06/23/mongodb/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h3 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h3><a id="more"></a>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">理解MongoDB的业务场景、熟悉MongoDB的简介、特点和体系结构、数据类型等。</span><br><span class="line">能够在Windows和Linux下安装和启动MongoDB、图形化管理界面Compass的安装使用</span><br><span class="line">掌握MongoDB基本常用命令实现数据的CRUD</span><br><span class="line">掌握MongoDB的索引类型、索引管理、执行计划。</span><br><span class="line">使用Spring Data MongoDB完成文章评论业务的开发</span><br></pre></td></tr></table></figure>
<h1 id="1-MongoDB相关概念"><a href="#1-MongoDB相关概念" class="headerlink" title="1 MongoDB相关概念"></a>1 MongoDB相关概念</h1><h2 id="1-1-业务应用场景"><a href="#1-1-业务应用场景" class="headerlink" title="1.1 业务应用场景"></a>1.1 业务应用场景</h2><p>传统的关系型数据库（如MySQL），在数据操作的“三高”需求以及应对Web2.0的网站需求面前，显得力不从心。<br>解释：“三高”需求：</p>
<ul>
<li>High performance - 对数据库高并发读写的需求。</li>
<li>Huge Storage - 对海量数据的高效率存储和访问的需求。</li>
<li>High Scalability &amp;&amp; High Availability- 对数据库的高可扩展性和高可用性的需求。<br>而MongoDB可应对“三高”需求。</li>
</ul>
<p>具体的应用场景如：<br>1 ）社交场景，使用 MongoDB 存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。<br>2 ）游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、高效率存储和访问。<br>3 ）物流场景，使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数组的形式来存储，一次查询就能将<br>订单所有的变更读取出来。<br>4 ）物联网场景，使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。<br>5 ）视频直播，使用 MongoDB 存储用户信息、点赞互动信息等。</p>
<h4 id="这些应用场景中，数据操作方面的共同特点是："><a href="#这些应用场景中，数据操作方面的共同特点是：" class="headerlink" title="这些应用场景中，数据操作方面的共同特点是："></a>这些应用场景中，数据操作方面的共同特点是：</h4><h4 id="（-1-）数据量大"><a href="#（-1-）数据量大" class="headerlink" title="（ 1 ）数据量大"></a>（ 1 ）数据量大</h4><h4 id="（-2-）写入操作频繁（读写都很频繁）"><a href="#（-2-）写入操作频繁（读写都很频繁）" class="headerlink" title="（ 2 ）写入操作频繁（读写都很频繁）"></a>（ 2 ）写入操作频繁（读写都很频繁）</h4><h4 id="（-3-）价值较低的数据，对事务性要求不高"><a href="#（-3-）价值较低的数据，对事务性要求不高" class="headerlink" title="（ 3 ）价值较低的数据，对事务性要求不高"></a>（ 3 ）价值较低的数据，对事务性要求不高</h4><p>对于这样的数据，我们更适合使用MongoDB来实现数据的存储。<br>什么时候选择MongoDB<br>在架构选型上，除了上述的三个特点外，如果你还犹豫是否要选择它？可以考虑以下的一些问题：<br>应用不需要事务及复杂 join 支持<br>新应用，需求会变，数据模型无法确定，想快速迭代开发<br>应用需要2000-3000以上的读写QPS（更高也可以）<br>应用需要TB甚至 PB 级别数据存储<br>应用发展迅速，需要能快速水平扩展<br>应用要求存储的数据不丢失<br>应用需要99.999%高可用<br>应用需要大量的地理位置查询、文本查询<br>如果上述有 1 个符合，可以考虑 MongoDB， 2 个及以上的符合，选择 MongoDB 绝不会后悔。</p>
<p>思考：如果用MySQL呢？<br>答：相对MySQL，可以以更低的成本解决问题（包括学习、开发、运维等成本）</p>
<h2 id="1-2-MongoDB简介"><a href="#1-2-MongoDB简介" class="headerlink" title="1.2 MongoDB简介"></a>1.2 MongoDB简介</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SQL术语&#x2F;概念 MongoDB术语&#x2F;概念 解释&#x2F;说明</span><br><span class="line">database database 数据库</span><br><span class="line">table collection 数据库表&#x2F;集合</span><br><span class="line">row document 数据记录行&#x2F;文档</span><br><span class="line">column field 数据字段&#x2F;域</span><br><span class="line">index index 索引</span><br><span class="line">table joins 表连接,MongoDB不支持</span><br><span class="line">嵌入文档 MongoDB通过嵌入式文档来替代多表连接</span><br><span class="line">primary key primary key 主键,MongoDB自动将_id字段设置为主键</span><br></pre></td></tr></table></figure>
<p>MongoDB是一个开源、高性能、无模式的文档型数据库，当初的设计就是用于简化开发和方便扩展，是NoSQL数据库产品中的一种。是最<br>像关系型数据库（MySQL）的非关系型数据库。<br>它支持的数据结构非常松散，是一种类似于 JSON 的 格式叫BSON，所以它既可以存储比较复杂的数据类型，又相当的灵活。<br>MongoDB中的记录是一个文档，它是一个由字段和值对（field:value）组成的数据结构。MongoDB文档类似于JSON对象，即一个文档认<br>为就是一个对象。字段的数据类型是字符型，它的值除了使用基本的一些类型外，还可以包括其他文档、普通数组和文档数组。</p>
<h2 id="1-3-体系结构"><a href="#1-3-体系结构" class="headerlink" title="1.3 体系结构"></a>1.3 体系结构</h2><p>MySQL和MongoDB对比</p>
<h2 id="1-4-数据模型"><a href="#1-4-数据模型" class="headerlink" title="1.4 数据模型"></a>1.4 数据模型</h2><p>MongoDB的最小存储单位就是文档(document)对象。文档(document)对象对应于关系型数据库的行。数据在MongoDB中以<br>BSON（Binary-JSON）文档的格式存储在磁盘上。<br>BSON（Binary Serialized Document Format）是一种类json的一种二进制形式的存储格式，简称Binary JSON。BSON和JSON一样，支持<br>内嵌的文档对象和数组对象，但是BSON有JSON没有的一些数据类型，如Date和BinData类型。<br>BSON采用了类似于 C 语言结构体的名称、对表示方法，支持内嵌的文档对象和数组对象，具有轻量性、可遍历性、高效性的三个特点，可<br>以有效描述非结构化数据和结构化数据。这种格式的优点是灵活性高，但它的缺点是空间利用率不是很理想。<br>Bson中，除了基本的JSON类型：string,integer,boolean,double,null,array和object，mongo还使用了特殊的数据类型。这些类型包括<br>date,object id,binary data,regular expression 和code。每一个驱动都以特定语言的方式实现了这些类型，查看你的驱动的文档来获取详<br>细信息。<br>BSON数据类型参考列表：</p>
<h4 id="数据类型-描述-举例"><a href="#数据类型-描述-举例" class="headerlink" title="数据类型 描述 举例"></a>数据类型 描述 举例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">字符串 UTF-8字符串都可表示为字符串类型的数据 &#123;&quot;x&quot; : &quot;foobar&quot;&#125;</span><br><span class="line">对象id 对象id是文档的 12 字节的唯一 ID &#123;&quot;X&quot; :ObjectId() &#125;</span><br><span class="line">布尔值 真或者假：true或者false &#123;&quot;x&quot;:true&#125;+</span><br><span class="line">数组 值的集合或者列表可以表示成数组 &#123;&quot;x&quot; ： [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]&#125;</span><br><span class="line">32 位整数 类型不可用。自动转换。 JavaScript仅支持^64 位浮点数，所以^32 位整数会被 shell位浮点数是不支持该类型的，shell中默认会转换成^64</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">64 位整数 不支持这个类型。整数 shell会使用一个特殊的内嵌文档来显示^64 位 shell位浮点数是不支持该类型的，shell中默认会转换成^64</span><br><span class="line">64 位浮点数 shell中的数字就是这一种类型 &#123;&quot;x&quot;：3.14159，&quot;y&quot;：3&#125;</span><br><span class="line">null 表示空值或者未定义的对象 &#123;&quot;x&quot;:null&#125;</span><br><span class="line">undefined 文档中也可以使用未定义类型 &#123;&quot;x&quot;:undefined&#125;</span><br><span class="line">符号 shell字符串不支持，shell会将数据库中的符号类型的数据自动转换成</span><br><span class="line">正则表达式 文档中可以包含正则表达式，采用JavaScript的正则表达式语法 &#123;&quot;x&quot; ： &#x2F;foobar&#x2F;i&#125;</span><br><span class="line">代码 文档中还可以包含JavaScript代码 &#123;&quot;x&quot; ： function() &#123; &#x2F;* ...... *&#x2F; &#125;&#125;</span><br><span class="line">二进制数据 二进制数据可以由任意字节的串组成，不过shell中无法使用</span><br><span class="line">最大值&#x2F;最</span><br><span class="line">小值</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BSON包括一个特殊类型，表示可能的最大值。shell中没有这个</span><br><span class="line">类型。^</span><br></pre></td></tr></table></figure>
<p>提示：<br>shell默认使用 64 位浮点型数值。{“x”：3.14}或{“x”：3}。对于整型值，可以使用NumberInt（ 4 字节符号整数）或NumberLong（ 8 字节符<br>号整数），{“x”:NumberInt(“3”)}{“x”:NumberLong(“3”)}</p>
<h2 id="1-5-MongoDB的特点"><a href="#1-5-MongoDB的特点" class="headerlink" title="1.5 MongoDB的特点"></a>1.5 MongoDB的特点</h2><p>MongoDB主要有如下特点：<br>（ 1 ）高性能：<br>MongoDB提供高性能的数据持久性。特别是,<br>对嵌入式数据模型的支持减少了数据库系统上的I/O活动。<br>索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键。（文本索引解决搜索的需求、TTL索引解决历史数据自动过期的需求、地<br>理位置索引可用于构建各种 O2O 应用）<br>mmapv1、wiredtiger、mongorocks（rocksdb）、in-memory 等多引擎支持满足各种场景需求。<br>Gridfs解决文件存储的需求。<br>（ 2 ）高可用性：<br>MongoDB的复制工具称为副本集（replica set），它可提供自动故障转移和数据冗余。<br>（ 3 ）高扩展性：<br>MongoDB提供了水平可扩展性作为其核心功能的一部分。<br>分片将数据分布在一组集群的机器上。（海量数据存储，服务能力水平扩展）<br>从3.4开始，MongoDB支持基于片键创建数据区域。在一个平衡的集群中，MongoDB将一个区域所覆盖的读写只定向到该区域内的那些<br>片。<br>（ 4 ）丰富的查询支持：<br>MongoDB支持丰富的查询语言，支持读和写操作(CRUD)，比如数据聚合、文本搜索和地理空间查询等。<br>（ 5 ）其他特点：如无模式（动态模式）、灵活的文档模型、</p>
<h1 id="2-单机部署"><a href="#2-单机部署" class="headerlink" title="2 单机部署"></a>2 单机部署</h1><h2 id="2-1-Windows系统中的安装启动"><a href="#2-1-Windows系统中的安装启动" class="headerlink" title="2.1 Windows系统中的安装启动"></a>2.1 Windows系统中的安装启动</h2><h4 id="第一步：下载安装包"><a href="#第一步：下载安装包" class="headerlink" title="第一步：下载安装包"></a>第一步：下载安装包</h4><p>MongoDB 提供了可用于 32 位和 64 位系统的预编译二进制包，你可以从MongoDB官网下载安装，MongoDB 预编译二进制包下载地址：<br><a href="https://www.mongodb.com/download-center#community" target="_blank" rel="noopener">https://www.mongodb.com/download-center#community</a></p>
<p>根据上图所示下载zip包。<br>提示：版本的选择：<br>MongoDB的版本命名规范如：x.y.z；<br>y为奇数时表示当前版本为开发版，如：1.5.2、4.1.13；<br>y为偶数时表示当前版本为稳定版，如：1.6.3、4.0.10；<br>z是修正版本号，数字越大越好。<br>详情：<a href="http://docs.mongodb.org/manual/release-notes/#release-version-numbers" target="_blank" rel="noopener">http://docs.mongodb.org/manual/release-notes/#release-version-numbers</a></p>
<h4 id="第二步：解压安装启动"><a href="#第二步：解压安装启动" class="headerlink" title="第二步：解压安装启动"></a>第二步：解压安装启动</h4><h4 id="将压缩包解压到一个目录中。"><a href="#将压缩包解压到一个目录中。" class="headerlink" title="将压缩包解压到一个目录中。"></a>将压缩包解压到一个目录中。</h4><p>在解压目录中，手动建立一个目录用于存放数据文件，如data/db</p>
<h4 id="方式-1-：命令行参数方式启动服务"><a href="#方式-1-：命令行参数方式启动服务" class="headerlink" title="方式 1 ：命令行参数方式启动服务"></a>方式 1 ：命令行参数方式启动服务</h4><p>在bin目录中打开命令行提示符，输入如下命令：</p>
<p>我们在启动信息中可以看到，mongoDB的默认端口是 27017 ，如果我们想改变默认的启动端口，可以通过–port来指定端口。<br>为了方便我们每次启动，可以将安装目录的bin目录设置到环境变量的path中，bin目录下是一些常用命令，比如mongod启动服务用的，<br>mongo客户端连接服务用的。</p>
<h4 id="方式-2-：配置文件方式启动服务"><a href="#方式-2-：配置文件方式启动服务" class="headerlink" title="方式 2 ：配置文件方式启动服务"></a>方式 2 ：配置文件方式启动服务</h4><p>在解压目录中新建config文件夹，该文件夹中新建配置文件mongod.conf，内如参考如下：</p>
<p>详细配置项内容可以参考官方文档：<a href="https://docs.mongodb.com/manual/reference/configuration-options/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/configuration-options/</a><br>【注意】<br>1 ）配置文件中如果使用双引号，比如路径地址，自动会将双引号的内容转义。如果不转义，则会报错：</p>
<h4 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h4><p>a. 对\换成/或\<br>b. 如果路径中没有空格，则无需加引号。<br>2 ）配置文件中不能以Tab分割字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod - -dbpath&#x3D;..\data\db</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">#The directory where the mongod instance stores its data.Default Value is &quot;\data\db&quot; on Windows.</span><br><span class="line">dbPath: D:\ 02 _Server\DBServer\mongodb-win 32 - x 86 _ 64 - 2008 plus-ssl- 4. 0. 1 \data</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error-parsing-yaml-config-file-yaml-cpp-error-at-line- 3 - column- 15 - unknown-escape-character-d</span><br></pre></td></tr></table></figure>

<h4 id="解决：-1"><a href="#解决：-1" class="headerlink" title="解决："></a>解决：</h4><h4 id="将其转换成空格。"><a href="#将其转换成空格。" class="headerlink" title="将其转换成空格。"></a>将其转换成空格。</h4><h4 id="启动方式："><a href="#启动方式：" class="headerlink" title="启动方式："></a>启动方式：</h4><h4 id="更多参数配置："><a href="#更多参数配置：" class="headerlink" title="更多参数配置："></a>更多参数配置：</h4><h2 id="2-2-Shell连接-mongo命令"><a href="#2-2-Shell连接-mongo命令" class="headerlink" title="2.2 Shell连接(mongo命令)"></a>2.2 Shell连接(mongo命令)</h2><p>在命令提示符输入以下shell命令即可完成登陆</p>
<h4 id="查看已经有的数据库"><a href="#查看已经有的数据库" class="headerlink" title="查看已经有的数据库"></a>查看已经有的数据库</h4><p>退出mongodb</p>
<h4 id="更多参数可以通过帮助查看："><a href="#更多参数可以通过帮助查看：" class="headerlink" title="更多参数可以通过帮助查看："></a>更多参数可以通过帮助查看：</h4><h4 id="提示："><a href="#提示：" class="headerlink" title="提示："></a>提示：</h4><p>MongoDB javascript shell是一个基于javascript的解释器，故是支持js程序的。</p>
<h2 id="2-3-Compass-图形化界面客户端"><a href="#2-3-Compass-图形化界面客户端" class="headerlink" title="2.3 Compass-图形化界面客户端"></a>2.3 Compass-图形化界面客户端</h2><p>到MongoDB官网下载MongoDB Compass，<br>地址：<a href="https://www.mongodb.com/download-center/v2/compass?initial=true" target="_blank" rel="noopener">https://www.mongodb.com/download-center/v2/compass?initial=true</a><br>如果是下载安装版，则按照步骤安装；如果是下载加压缩版，直接解压，执行里面的MongoDBCompassCommunity.exe文件即可。<br>在打开的界面中，输入主机地址、端口等相关信息，点击连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod - f ..&#x2F;config&#x2F;mongod.conf</span><br><span class="line">或</span><br><span class="line">mongod - -config ..&#x2F;config&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">destination: file</span><br><span class="line">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span><br><span class="line">path: &quot;D:&#x2F; 02 _Server&#x2F;DBServer&#x2F;mongodb-win 32 - x 86 _ 64 - 2008 plus-ssl- 4. 0. 1 &#x2F;log&#x2F;mongod.log&quot;</span><br><span class="line">logAppend: true</span><br><span class="line">storage:</span><br><span class="line">journal:</span><br><span class="line">enabled: true</span><br><span class="line">#The directory where the mongod instance stores its data.Default Value is &quot;&#x2F;data&#x2F;db&quot;.</span><br><span class="line">dbPath: &quot;D:&#x2F; 02 _Server&#x2F;DBServer&#x2F;mongodb-win 32 - x 86 _ 64 - 2008 plus-ssl- 4. 0. 1 &#x2F;data&quot;</span><br><span class="line">net:</span><br><span class="line">#bindIp: 127. 0. 0. 1</span><br><span class="line">port: 27017</span><br><span class="line">setParameter:</span><br><span class="line">enableLocalhostAuthBypass: false</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br><span class="line">或</span><br><span class="line">mongo - -host&#x3D; 127. 0. 0. 1 - -port&#x3D; 27017</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;show databases</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo - -help</span><br></pre></td></tr></table></figure>

<h2 id="2-4-Linux系统中的安装启动和连接"><a href="#2-4-Linux系统中的安装启动和连接" class="headerlink" title="2.4 Linux系统中的安装启动和连接"></a>2.4 Linux系统中的安装启动和连接</h2><p>目标：在Linux中部署一个单机的MongoDB，作为生产环境下使用。<br>提示：和Windows下操作差不多。<br>步骤如下：<br>（ 1 ）先到官网下载压缩包mongod-linux-x 86 _ 64 - 4. 0. 10 .tgz。<br>（ 2 ）上传压缩包到Linux中，解压到当前目录：</p>
<h4 id="（-3-）移动解压后的文件夹到指定的目录中："><a href="#（-3-）移动解压后的文件夹到指定的目录中：" class="headerlink" title="（ 3 ）移动解压后的文件夹到指定的目录中："></a>（ 3 ）移动解压后的文件夹到指定的目录中：</h4><h4 id="（-4-）新建几个目录，分别用来存储数据和日志："><a href="#（-4-）新建几个目录，分别用来存储数据和日志：" class="headerlink" title="（ 4 ）新建几个目录，分别用来存储数据和日志："></a>（ 4 ）新建几个目录，分别用来存储数据和日志：</h4><h4 id="（-5-）新建并修改配置文件"><a href="#（-5-）新建并修改配置文件" class="headerlink" title="（ 5 ）新建并修改配置文件"></a>（ 5 ）新建并修改配置文件</h4><h4 id="配置文件的内容如下："><a href="#配置文件的内容如下：" class="headerlink" title="配置文件的内容如下："></a>配置文件的内容如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar - xvf mongodb-linux-x 86 _ 64 - 4. 0. 10 .tgz</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv mongodb-linux-x 86 _ 64 - 4. 0. 10 &#x2F;usr&#x2F;local&#x2F;mongodb</span><br></pre></td></tr></table></figure>
<h4 id="数据存储目录"><a href="#数据存储目录" class="headerlink" title="#数据存储目录"></a>#数据存储目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir - p &#x2F;mongodb&#x2F;single&#x2F;data&#x2F;db</span><br><span class="line">#日志存储目录</span><br><span class="line">mkdir - p &#x2F;mongodb&#x2F;single&#x2F;log</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;mongodb&#x2F;single&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">#MongoDB发送所有日志输出的目标指定为文件</span><br><span class="line"># #The path of the log file to which mongod or mongos should send all diagnostic logging information</span><br><span class="line">destination: file</span><br><span class="line">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span><br><span class="line">path: &quot;&#x2F;mongodb&#x2F;single&#x2F;log&#x2F;mongod.log&quot;</span><br><span class="line">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span><br><span class="line">logAppend: true</span><br><span class="line">storage:</span><br><span class="line">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span><br><span class="line">##The directory where the mongod instance stores its data.Default Value is &quot;&#x2F;data&#x2F;db&quot;.</span><br><span class="line">dbPath: &quot;&#x2F;mongodb&#x2F;single&#x2F;data&#x2F;db&quot;</span><br><span class="line">journal:</span><br><span class="line">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span><br><span class="line">enabled: true</span><br><span class="line">processManagement:</span><br><span class="line">#启用在后台运行mongos或mongod进程的守护进程模式。</span><br><span class="line">fork: true</span><br><span class="line">net:</span><br><span class="line">#服务实例绑定的IP，默认是localhost</span><br><span class="line">bindIp: localhost, 192. 168. 0. 2</span><br></pre></td></tr></table></figure>

<p>（ 6 ）启动MongoDB服务</p>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><p>如果启动后不是successfully，则是启动失败了。原因基本上就是配置文件有问题。</p>
<h4 id="通过进程来查看服务是否启动了："><a href="#通过进程来查看服务是否启动了：" class="headerlink" title="通过进程来查看服务是否启动了："></a>通过进程来查看服务是否启动了：</h4><p>（ 7 ）分别使用mongo命令和compass工具来连接测试。<br>提示：如果远程连接不上，需要配置防火墙放行，或直接关闭linux防火墙</p>
<h4 id="（-8-）停止关闭服务"><a href="#（-8-）停止关闭服务" class="headerlink" title="（ 8 ）停止关闭服务"></a>（ 8 ）停止关闭服务</h4><h4 id="停止服务的方式有两种：快速关闭和标准关闭，下面依次说明："><a href="#停止服务的方式有两种：快速关闭和标准关闭，下面依次说明：" class="headerlink" title="停止服务的方式有两种：快速关闭和标准关闭，下面依次说明："></a>停止服务的方式有两种：快速关闭和标准关闭，下面依次说明：</h4><h4 id="（一）快速关闭方法（快速，简单，数据可能会出错）"><a href="#（一）快速关闭方法（快速，简单，数据可能会出错）" class="headerlink" title="（一）快速关闭方法（快速，简单，数据可能会出错）"></a>（一）快速关闭方法（快速，简单，数据可能会出错）</h4><p>目标：通过系统的kill命令直接杀死进程：<br>杀完要检查一下，避免有的没有杀掉。</p>
<h4 id="【补充】"><a href="#【补充】" class="headerlink" title="【补充】"></a>【补充】</h4><h4 id="如果一旦是因为数据损坏，则需要进行如下操作（了解）："><a href="#如果一旦是因为数据损坏，则需要进行如下操作（了解）：" class="headerlink" title="如果一旦是因为数据损坏，则需要进行如下操作（了解）："></a>如果一旦是因为数据损坏，则需要进行如下操作（了解）：</h4><p>1 ）删除lock文件：</p>
<h4 id="2-）修复数据："><a href="#2-）修复数据：" class="headerlink" title="2 ）修复数据："></a>2 ）修复数据：</h4><h4 id="（二）标准的关闭方法（数据不容易出错，但麻烦）："><a href="#（二）标准的关闭方法（数据不容易出错，但麻烦）：" class="headerlink" title="（二）标准的关闭方法（数据不容易出错，但麻烦）："></a>（二）标准的关闭方法（数据不容易出错，但麻烦）：</h4><p>目标：通过mongo客户端中的shutdownServer命令来关闭服务<br>主要的操作步骤参考如下：</p>
<h1 id="3-基本常用命令"><a href="#3-基本常用命令" class="headerlink" title="3 基本常用命令"></a>3 基本常用命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#bindIp</span><br><span class="line">#绑定的端口，默认是 27017</span><br><span class="line">port: 27017</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bobohost single]# &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;bin&#x2F;mongod - f &#x2F;mongodb&#x2F;single&#x2F;mongod.conf</span><br><span class="line">about to fork child process, waiting until server is ready for connections.</span><br><span class="line">forked process: 90384</span><br><span class="line">child process started successfully, parent exiting</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bobohost single]# ps - ef |grep mongod</span><br><span class="line">root  90384  1  0 8 月 26? 00 : 02 : 13 &#x2F;usr&#x2F;local&#x2F;mongdb&#x2F;bin&#x2F;mongod - f &#x2F;mongodb&#x2F;single&#x2F;mongod.conf</span><br></pre></td></tr></table></figure>
<h4 id="查看防火墙状态"><a href="#查看防火墙状态" class="headerlink" title="#查看防火墙状态"></a>#查看防火墙状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br><span class="line">#临时关闭防火墙</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">#开机禁止启动防火墙</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>
<h4 id="通过进程编号关闭节点"><a href="#通过进程编号关闭节点" class="headerlink" title="#通过进程编号关闭节点"></a>#通过进程编号关闭节点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill - 2 54410</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm - f &#x2F;mongodb&#x2F;single&#x2F;data&#x2F;db&#x2F;*.lock</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;mongdb&#x2F;bin&#x2F;mongod - -repair - -dbpath&#x3D;&#x2F;mongodb&#x2F;single&#x2F;data&#x2F;db</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;客户端登录服务，注意，这里通过localhost登录，如果需要远程登录，必须先登录认证才行。</span><br><span class="line">mongo - -port 27017</span><br><span class="line">&#x2F;&#x2F;#切换到admin库</span><br><span class="line">use admin</span><br><span class="line">&#x2F;&#x2F;关闭服务</span><br><span class="line">db.shutdownServer()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">专栏文章评论 comment</span><br><span class="line">字段名称 字段含义 字段类型 备注</span><br><span class="line">_id ID ObjectId或String Mongo的主键的字段</span><br><span class="line">articleid 文章ID String</span><br><span class="line">content 评论内容 String</span><br><span class="line">userid 评论人ID String</span><br><span class="line">nickname 评论人昵称 String</span><br><span class="line">createdatetime 评论的日期时间 Date</span><br><span class="line">likenum 点赞数 Int</span><br><span class="line">replynum 回复数 Int</span><br><span class="line">state 状态 String 0 ：不可见； 1 ：可见；</span><br><span class="line">parentid 上级ID String 如果为 0 表示文章的顶级评论</span><br></pre></td></tr></table></figure>
<h2 id="3-1-案例需求"><a href="#3-1-案例需求" class="headerlink" title="3.1 案例需求"></a>3.1 案例需求</h2><p>存放文章评论的数据存放到MongoDB中，数据结构参考如下：<br>数据库：articledb</p>
<h2 id="3-2-数据库操作"><a href="#3-2-数据库操作" class="headerlink" title="3.2 数据库操作"></a>3.2 数据库操作</h2><h2 id="3-2-1-选择和创建数据库"><a href="#3-2-1-选择和创建数据库" class="headerlink" title="3.2.1 选择和创建数据库"></a>3.2.1 选择和创建数据库</h2><h4 id="选择和创建数据库的语法格式："><a href="#选择和创建数据库的语法格式：" class="headerlink" title="选择和创建数据库的语法格式："></a>选择和创建数据库的语法格式：</h4><p>如果数据库不存在则自动创建，例如，以下语句创建spitdb数据库：</p>
<h4 id="查看有权限查看的所有的数据库命令"><a href="#查看有权限查看的所有的数据库命令" class="headerlink" title="查看有权限查看的所有的数据库命令"></a>查看有权限查看的所有的数据库命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意: 在 MongoDB 中，集合只有在内容插入后才会创建! 就是说，创建集合(数据表)后要再插入一个文档(记录)，集合才会真正创建。</span><br></pre></td></tr></table></figure>
<h1 id="查看当前正在使用的数据库命令"><a href="#查看当前正在使用的数据库命令" class="headerlink" title="查看当前正在使用的数据库命令"></a>查看当前正在使用的数据库命令</h1><p>MongoDB 中默认的数据库为 test，如果你没有选择数据库，集合将存放在 test 数据库中。</p>
<p>另外：<br>数据库名可以是满足以下条件的任意UTF-8字符串。<br>不能是空字符串（””)。<br>不得含有’ ‘（空格)、.、$、/、\和\0 (空字符)。<br>应全部小写。<br>最多 64 字节。<br>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。<br>admin： 从权限的角度来看，这是”root”数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特<br>定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。<br>local: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合<br>config: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</p>
<h2 id="3-2-2-数据库的删除"><a href="#3-2-2-数据库的删除" class="headerlink" title="3.2.2 数据库的删除"></a>3.2.2 数据库的删除</h2><p>MongoDB 删除数据库的语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名称</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use articledb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line">或</span><br><span class="line">show databases</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure>

<h4 id="提示：主要用来删除已经持久化的数据库"><a href="#提示：主要用来删除已经持久化的数据库" class="headerlink" title="提示：主要用来删除已经持久化的数据库"></a>提示：主要用来删除已经持久化的数据库</h4><h2 id="3-3-集合操作"><a href="#3-3-集合操作" class="headerlink" title="3.3 集合操作"></a>3.3 集合操作</h2><h4 id="集合，类似关系型数据库中的表。"><a href="#集合，类似关系型数据库中的表。" class="headerlink" title="集合，类似关系型数据库中的表。"></a>集合，类似关系型数据库中的表。</h4><h4 id="可以显示的创建，也可以隐式的创建。"><a href="#可以显示的创建，也可以隐式的创建。" class="headerlink" title="可以显示的创建，也可以隐式的创建。"></a>可以显示的创建，也可以隐式的创建。</h4><h3 id="3-3-1-集合的显式创建（了解）"><a href="#3-3-1-集合的显式创建（了解）" class="headerlink" title="3.3.1 集合的显式创建（了解）"></a>3.3.1 集合的显式创建（了解）</h3><h4 id="基本语法格式："><a href="#基本语法格式：" class="headerlink" title="基本语法格式："></a>基本语法格式：</h4><h4 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name: 要创建的集合名称</span><br></pre></td></tr></table></figure>
<p>例如：创建一个名为mycollection的普通集合。</p>
<p>查看当前库中的表：show tables命令</p>
<h4 id="集合的命名规范："><a href="#集合的命名规范：" class="headerlink" title="集合的命名规范："></a>集合的命名规范：</h4><h4 id="集合名不能是空字符串””。"><a href="#集合名不能是空字符串””。" class="headerlink" title="集合名不能是空字符串””。"></a>集合名不能是空字符串””。</h4><h4 id="集合名不能含有-0字符（空字符-，这个字符表示集合名的结尾。"><a href="#集合名不能含有-0字符（空字符-，这个字符表示集合名的结尾。" class="headerlink" title="集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。"></a>集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">集合名不能以&quot;system.&quot;开头，这是为系统集合保留的前缀。</span><br><span class="line">用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除</span><br><span class="line">非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</span><br></pre></td></tr></table></figure>
<h3 id="3-3-2-集合的隐式创建"><a href="#3-3-2-集合的隐式创建" class="headerlink" title="3.3.2 集合的隐式创建"></a>3.3.2 集合的隐式创建</h3><h4 id="当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。"><a href="#当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。" class="headerlink" title="当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。"></a>当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合。</h4><h4 id="详见文档的插入章节。"><a href="#详见文档的插入章节。" class="headerlink" title="详见文档的插入章节。"></a>详见文档的插入章节。</h4><h4 id="提示：通常我们使用隐式创建文档即可。"><a href="#提示：通常我们使用隐式创建文档即可。" class="headerlink" title="提示：通常我们使用隐式创建文档即可。"></a>提示：通常我们使用隐式创建文档即可。</h4><h3 id="3-3-3-集合的删除"><a href="#3-3-3-集合的删除" class="headerlink" title="3.3.3 集合的删除"></a>3.3.3 集合的删除</h3><h4 id="集合删除语法格式如下："><a href="#集合删除语法格式如下：" class="headerlink" title="集合删除语法格式如下："></a>集合删除语法格式如下：</h4><h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>如果成功删除选定集合，则 drop() 方法返回 true，否则返回 false。<br>例如：要删除mycollection集合</p>
<h2 id="3-4-文档基本CRUD"><a href="#3-4-文档基本CRUD" class="headerlink" title="3.4 文档基本CRUD"></a>3.4 文档基本CRUD</h2><p>文档（document）的数据结构和 JSON 基本一样。<br>所有存储在集合中的数据都是 BSON 格式。</p>
<h3 id="3-4-1-文档的插入"><a href="#3-4-1-文档的插入" class="headerlink" title="3.4.1 文档的插入"></a>3.4.1 文档的插入</h3><h4 id="（-1-）单个文档插入"><a href="#（-1-）单个文档插入" class="headerlink" title="（ 1 ）单个文档插入"></a>（ 1 ）单个文档插入</h4><p>使用insert() 或 save() 方法向集合中插入文档，语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(name)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(&quot;mycollection&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show collections</span><br><span class="line">或</span><br><span class="line">show tables</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.collection.drop()</span><br><span class="line">或</span><br><span class="line">db.集合.drop()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.mycollection.drop()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br><span class="line">document documentor array 要插入到集合中的文档或文档数组。（(json格式）</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeConcern document</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Optional. A document expressing the write concern. Omit to use the default write concern.</span><br><span class="line">See Write Concern.Do not explicitly set the write concern for the operation if run in a</span><br><span class="line">transaction. To use write concern with transactions, see Transactions and Write Concern.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ordered boolean</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可选。如果为真，则按顺序插入数组中的文档，如果其中一个文档出现错误，MongoDB将返回而</span><br><span class="line">不处理数组中的其余文档。如果为假，则执行无序插入，如果其中一个文档出现错误，则继续处理</span><br><span class="line">数组中的主文档。在版本2.6+中默认为true</span><br></pre></td></tr></table></figure>
<h4 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h4><h4 id="【示例】"><a href="#【示例】" class="headerlink" title="【示例】"></a>【示例】</h4><p>要向comment的集合(表)中插入一条测试数据：</p>
<h4 id="提示：-1"><a href="#提示：-1" class="headerlink" title="提示："></a>提示：</h4><p>1 ）comment集合如果不存在，则会隐式创建<br>2 ）mongo中的数字，默认情况下是double类型，如果要存整型，必须使用函数NumberInt(整型数字)，否则取出来就有问题了。<br>3 ）插入当前日期使用new Date()<br>4 ）插入的数据没有指定_id，会自动生成主键值<br>5 ）如果某字段没值，可以赋值为null，或不写该字段。</p>
<p>执行后，如下，说明插入一个数据成功了。</p>
<h4 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h4><h4 id="1-文档中的键-值对是有序的。"><a href="#1-文档中的键-值对是有序的。" class="headerlink" title="1. 文档中的键/值对是有序的。"></a>1. 文档中的键/值对是有序的。</h4><h4 id="2-文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档-。"><a href="#2-文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档-。" class="headerlink" title="2. 文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。"></a>2. 文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</h4><ol start="3">
<li>MongoDB区分类型和大小写。</li>
<li>MongoDB的文档不能有重复的键。</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。<br>文档键命名规范：<br>键不能含有\0 (空字符)。这个字符用来表示键的结尾。<br>.和$有特别的意义，只有在特定环境下才能使用。<br>以下划线”_”开头的键是保留的(不是严格要求的)。</li>
</ol>
<p>（ 2 ）批量插入<br>语法：</p>
<h4 id="参数：-1"><a href="#参数：-1" class="headerlink" title="参数："></a>参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(</span><br><span class="line">&lt;document or array of documents&gt;,</span><br><span class="line">&#123;</span><br><span class="line">writeConcern: &lt;document&gt;,</span><br><span class="line">ordered: &lt;boolean&gt;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.comment.insert(&#123;&quot;articleid&quot;:&quot; 100000 &quot;,&quot;content&quot;:&quot;今天天气真好，阳光明</span><br><span class="line">媚&quot;,&quot;userid&quot;:&quot; 1001 &quot;,&quot;nickname&quot;:&quot;Rose&quot;,&quot;createdatetime&quot;:new Date(),&quot;likenum&quot;:NumberInt( 10 ),&quot;state&quot;:null&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insertMany(</span><br><span class="line">[ &lt;document 1 &gt; , &lt;document 2 &gt;, ... ],</span><br><span class="line">&#123;</span><br><span class="line">writeConcern: &lt;document&gt;,</span><br><span class="line">ordered: &lt;boolean&gt;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br><span class="line">document document 要插入到集合中的文档或文档数组。（(json格式）</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeConcern document</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Optional. A document expressing the write concern. Omit to use the default write</span><br><span class="line">concern.Do not explicitly set the write concern for the operation if run in a transaction. To</span><br><span class="line">use write concern with transactions, see Transactions and Write Concern.</span><br><span class="line">ordered boolean 可选。一个布尔值，指定Mongod实例应执行有序插入还是无序插入。默认为true。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br><span class="line">query document 可选。使用查询运算符指定选择筛选器。若要返回集合中的所有文档，请省略此参数或传递空文档(&#123;&#125;)。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">projection document 可选。指定要在与查询筛选器匹配的文档中返回的字段（投影）。若要返回匹配文档中的所有字段，请省略此参数。</span><br></pre></td></tr></table></figure>
<h4 id="【示例】-1"><a href="#【示例】-1" class="headerlink" title="【示例】"></a>【示例】</h4><h4 id="批量插入多条文章评论："><a href="#批量插入多条文章评论：" class="headerlink" title="批量插入多条文章评论："></a>批量插入多条文章评论：</h4><h4 id="提示：-2"><a href="#提示：-2" class="headerlink" title="提示："></a>提示：</h4><p>插入时指定了_id，则主键就是该值。<br>如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。<br>因为批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。如（了解）：</p>
<h3 id="3-4-2-文档的基本查询"><a href="#3-4-2-文档的基本查询" class="headerlink" title="3.4.2 文档的基本查询"></a>3.4.2 文档的基本查询</h3><h4 id="查询数据的语法格式如下："><a href="#查询数据的语法格式如下：" class="headerlink" title="查询数据的语法格式如下："></a>查询数据的语法格式如下：</h4><h4 id="参数：-2"><a href="#参数：-2" class="headerlink" title="参数："></a>参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.comment.insertMany([</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 1 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我</span><br><span class="line">他。&quot;,&quot;userid&quot;:&quot; 1002 &quot;,&quot;nickname&quot;:&quot;相忘于江湖&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 -</span><br><span class="line">05 T 22 : 08 : 15. 522 Z&quot;),&quot;likenum&quot;:NumberInt( 1000 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 2 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;,&quot;userid&quot;:&quot; 1005 &quot;,&quot;nickname&quot;:&quot;伊人憔</span><br><span class="line">悴&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 - 05 T 23 : 58 : 51. 485 Z&quot;),&quot;likenum&quot;:NumberInt( 888 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 3 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;我一直喝凉开水，冬天夏天都喝。&quot;,&quot;userid&quot;:&quot; 1004 &quot;,&quot;nickname&quot;:&quot;杰克船</span><br><span class="line">长&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 - 06 T 01 : 05 : 06. 321 Z&quot;),&quot;likenum&quot;:NumberInt( 666 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 4 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;专家说不能空腹吃饭，影响健康。&quot;,&quot;userid&quot;:&quot; 1003 &quot;,&quot;nickname&quot;:&quot;凯</span><br><span class="line">撒&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 - 06 T 08 : 18 : 35. 288 Z&quot;),&quot;likenum&quot;:NumberInt( 2000 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 5 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;研究表明，刚烧开的水千万不能喝，因为烫</span><br><span class="line">嘴。&quot;,&quot;userid&quot;:&quot; 1003 &quot;,&quot;nickname&quot;:&quot;凯撒&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 -</span><br><span class="line">06 T 11 : 01 : 02. 521 Z&quot;),&quot;likenum&quot;:NumberInt( 3000 ),&quot;state&quot;:&quot; 1 &quot;&#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">db.comment.insertMany([</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 1 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我</span><br><span class="line">他。&quot;,&quot;userid&quot;:&quot; 1002 &quot;,&quot;nickname&quot;:&quot;相忘于江湖&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 -</span><br><span class="line">05 T 22 : 08 : 15. 522 Z&quot;),&quot;likenum&quot;:NumberInt( 1000 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 2 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;,&quot;userid&quot;:&quot; 1005 &quot;,&quot;nickname&quot;:&quot;伊人憔</span><br><span class="line">悴&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 - 05 T 23 : 58 : 51. 485 Z&quot;),&quot;likenum&quot;:NumberInt( 888 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 3 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;我一直喝凉开水，冬天夏天都喝。&quot;,&quot;userid&quot;:&quot; 1004 &quot;,&quot;nickname&quot;:&quot;杰克船</span><br><span class="line">长&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 - 06 T 01 : 05 : 06. 321 Z&quot;),&quot;likenum&quot;:NumberInt( 666 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 4 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;专家说不能空腹吃饭，影响健康。&quot;,&quot;userid&quot;:&quot; 1003 &quot;,&quot;nickname&quot;:&quot;凯</span><br><span class="line">撒&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 - 06 T 08 : 18 : 35. 288 Z&quot;),&quot;likenum&quot;:NumberInt( 2000 ),&quot;state&quot;:&quot; 1 &quot;&#125;,</span><br><span class="line">&#123;&quot;_id&quot;:&quot; 5 &quot;,&quot;articleid&quot;:&quot; 100001 &quot;,&quot;content&quot;:&quot;研究表明，刚烧开的水千万不能喝，因为烫</span><br><span class="line">嘴。&quot;,&quot;userid&quot;:&quot; 1003 &quot;,&quot;nickname&quot;:&quot;凯撒&quot;,&quot;createdatetime&quot;:new Date(&quot; 2019 - 08 -</span><br><span class="line">06 T 11 : 01 : 02. 521 Z&quot;),&quot;likenum&quot;:NumberInt( 3000 ),&quot;state&quot;:&quot; 1 &quot;&#125;</span><br><span class="line">]);</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">print (e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&lt;query&gt;, [projection])</span><br></pre></td></tr></table></figure>

<h4 id="【示例】-2"><a href="#【示例】-2" class="headerlink" title="【示例】"></a>【示例】</h4><h4 id="（-1-）查询所有"><a href="#（-1-）查询所有" class="headerlink" title="（ 1 ）查询所有"></a>（ 1 ）查询所有</h4><p>如果我们要查询spit集合的所有文档，我们输入以下命令</p>
<p>这里你会发现每条文档会有一个叫_id的字段，这个相当于我们原来关系数据库中表的主键，当你在插入文档记录时没有指定该字段，<br>MongoDB会自动创建，其类型是ObjectID类型。<br>如果我们在插入文档记录时指定该字段也可以，其类型可以是ObjectID类型，也可以是MongoDB支持的任意类型。</p>
<p>如果我想按一定条件来查询，比如我想查询userid为 1003 的记录，怎么办？很简单！只 要在find()中添加参数即可，参数也是json格式，如<br>下：</p>
<p>如果你只需要返回符合条件的第一条数据，我们可以使用findOne命令来实现，语法和find一样。<br>如：查询用户编号是 1003 的记录，但只最多返回符合条件的第一条记录：</p>
<p>（ 2 ）投影查询（Projection Query）：<br>如果要查询结果返回部分字段，则需要使用投影查询（不显示所有字段，只显示指定的字段）。<br>如：查询结果只显示_id、userid、nickname:</p>
<p>默认_id会显示。<br>如：查询结果只显示、userid、nickname，不显示_id：</p>
<p>再例如：查询所有数据，但只显示_id、userid、nickname:</p>
<h3 id="3-4-3-文档的更新"><a href="#3-4-3-文档的更新" class="headerlink" title="3.4.3 文档的更新"></a>3.4.3 文档的更新</h3><h4 id="更新文档的语法："><a href="#更新文档的语法：" class="headerlink" title="更新文档的语法："></a>更新文档的语法：</h4><h4 id="参数：-3"><a href="#参数：-3" class="headerlink" title="参数："></a>参数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find()</span><br><span class="line">或</span><br><span class="line">db.comment.find(&#123;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;userid:&#39; 1003 &#39;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.findOne(&#123;userid:&#39; 1003 &#39;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.comment.find(&#123;userid:&quot; 1003 &quot;&#125;,&#123;userid: 1 ,nickname: 1 &#125;)</span><br><span class="line">&#123; &quot;_id&quot; : &quot; 4 &quot;, &quot;userid&quot; : &quot; 1003 &quot;, &quot;nickname&quot; : &quot;凯撒&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot; 5 &quot;, &quot;userid&quot; : &quot; 1003 &quot;, &quot;nickname&quot; : &quot;凯撒&quot; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.comment.find(&#123;userid:&quot; 1003 &quot;&#125;,&#123;userid: 1 ,nickname: 1 ,_id: 0 &#125;)</span><br><span class="line">&#123; &quot;userid&quot; : &quot; 1003 &quot;, &quot;nickname&quot; : &quot;凯撒&quot; &#125;</span><br><span class="line">&#123; &quot;userid&quot; : &quot; 1003 &quot;, &quot;nickname&quot; : &quot;凯撒&quot; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.comment.find(&#123;&#125;,&#123;userid: 1 ,nickname: 1 &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(query, update, options)</span><br><span class="line">&#x2F;&#x2F;或</span><br><span class="line">db.collection.update(</span><br><span class="line">&lt;query&gt;,</span><br><span class="line">&lt;update&gt;,</span><br><span class="line">&#123;</span><br><span class="line">upsert: &lt;boolean&gt;,</span><br><span class="line">multi: &lt;boolean&gt;,</span><br><span class="line">writeConcern: &lt;document&gt;,</span><br><span class="line">collation: &lt;document&gt;,</span><br><span class="line">arrayFilters: [ &lt;filterdocument 1 &gt;, ... ],</span><br><span class="line">hint: &lt;document|string&gt; &#x2F;&#x2F; Available starting in MongoDB 4. 2</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Parqueryameter Tdocumentype Description更新的选择条件。可以使用与find（）方法中相同的查询选择器，类似sql update查询内where后面的。。在3.0版中进行了更改：当使用upsert:true执行update（）时，如果查询使用点表示法在_id字段上指定条件，则MongoDB将拒绝插入新文档。</span><br><span class="line">update documentorpipeline 要应用的修改。该值可以是：包含更新运算符表达式的文档，或仅包含：对的替换文档，或在MongoDB 4.2中启动聚合管道。管道可以由以下阶段组成： 其别名set 其别名unset 其别名replaceWith。换句话说：它是update的对象和一些更新的操作符（如inc...）等，也可以理解为</span><br><span class="line">upsertmulti booleanboolean 可选。如果设置为可选。如果设置为truetrue，则在没有与查询条件匹配的文档时创建新文档。默认值为，则更新符合查询条件的多个文档。如果设置为false，则更新一个文档。默认值为false，如果找不到匹配项，则不会插入新文档。false。</span><br><span class="line">writeConcerndocument可选。表示写问题的文档。抛出异常的级别。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collation document</span><br></pre></td></tr></table></figure>
<p>可选。指定要用于操作的校对规则。 (^)<br>校对规则允许用户为字符串比较指定特定于语言的规则，例如字母大小写和重音标记的规则。校对规则选项具有以下语法：<br>校对规则：区域设置：{， (^)<br>caseLecaseFirst:vel:，，<br>强度：numericor， (^) dering:，<br>替代：最大变量：， (^) ，<br>向后：}<br>指定校对规则时，区域设置字段是必需的；所有其他校对规则字段都是可选的。有关字段的说明，请参阅校对规则文档。如果未指定校对规则，但集合具有默认校对规则（请参见db.createCollection（）），则该操作将使用为集合指定的校对规则。 (^)<br>如果没有为集合或操作指定校对规则，3.4版新增。 MongoDB将使用以前版本中使用的简单二进制比较进行字符串比较。不能为一个操作指定多个校对规则。例如，不能为每个字段指定不同的校对规则，或者如果使用排序执行查找，则不能将一个校对规则用于查找，另一个校对规则用于排序。<br>arrayFiltersarray 可选。一个筛选文档数组，用于确定要为数组字段上的更新操作修改哪些数组元素。在更新文档中，使用[标识符（]）都必须指定一个对应的数组筛选器文档。也就是说，不能为同一标识符指定多个数组筛选器文档。[3.6版+ 筛选的运算符来义标识符，然后在组过滤档中用。如果标识符未在更档中，则不有标识符的组筛选档。注， 必须小开头，并且只<br>hint Documentor string 可选。指定用于支持查询谓词的索引的文档或字符串。该选项可以采用索引规范文档或索引名称字符串。如果指定的索引不存在，则说明操作错误。例如，请参阅版本 4 中的“为更新操作指定提示。<br>提示：<br>主要关注前四个参数即可。<br>【示例】<br>（ 1 ）覆盖的修改<br>如果我们想修改_id为 1 的记录，点赞量为 1001 ，输入以下语句：<br>执行后，我们会发现，这条文档除了likenum字段其它字段都不见了，<br>（ 2 ）局部修改<br>为了解决这个问题，我们需要使用修改器$set来实现，命令如下：<br>我们想修改_id为 2 的记录，浏览量为 889 ，输入以下语句：</p>
<h4 id="这样就OK啦。"><a href="#这样就OK啦。" class="headerlink" title="这样就OK啦。"></a>这样就OK啦。</h4><h4 id="（-3-）批量的修改"><a href="#（-3-）批量的修改" class="headerlink" title="（ 3 ）批量的修改"></a>（ 3 ）批量的修改</h4><h4 id="更新所有用户为-1003-的用户的昵称为凯撒大帝。"><a href="#更新所有用户为-1003-的用户的昵称为凯撒大帝。" class="headerlink" title="更新所有用户为 1003 的用户的昵称为凯撒大帝。"></a>更新所有用户为 1003 的用户的昵称为凯撒大帝。</h4><h4 id="提示：如果不加后面的参数，则只更新符合条件的第一条记录"><a href="#提示：如果不加后面的参数，则只更新符合条件的第一条记录" class="headerlink" title="提示：如果不加后面的参数，则只更新符合条件的第一条记录"></a>提示：如果不加后面的参数，则只更新符合条件的第一条记录</h4><h4 id="（-3-）列值增长的修改"><a href="#（-3-）列值增长的修改" class="headerlink" title="（ 3 ）列值增长的修改"></a>（ 3 ）列值增长的修改</h4><p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用$inc运算符来实现。<br>需求：对 3 号数据的点赞数，每次递增 1</p>
<h3 id="3-4-4-删除文档"><a href="#3-4-4-删除文档" class="headerlink" title="3.4.4 删除文档"></a>3.4.4 删除文档</h3><h4 id="删除文档的语法结构："><a href="#删除文档的语法结构：" class="headerlink" title="删除文档的语法结构："></a>删除文档的语法结构：</h4><h4 id="以下语句可以将数据全部删除，请慎用"><a href="#以下语句可以将数据全部删除，请慎用" class="headerlink" title="以下语句可以将数据全部删除，请慎用"></a>以下语句可以将数据全部删除，请慎用</h4><p>如果删除_id=1的记录，输入以下语句</p>
<h2 id="3-5-文档的分页查询"><a href="#3-5-文档的分页查询" class="headerlink" title="3.5 文档的分页查询"></a>3.5 文档的分页查询</h2><h3 id="3-5-1-统计查询"><a href="#3-5-1-统计查询" class="headerlink" title="3.5.1 统计查询"></a>3.5.1 统计查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(&#123;_id:&quot; 1 &quot;&#125;,&#123;likenum:NumberInt( 1001 )&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(&#123;_id:&quot; 2 &quot;&#125;,&#123;$set:&#123;likenum:NumberInt( 889 )&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="默认只修改第一条数据"><a href="#默认只修改第一条数据" class="headerlink" title="//默认只修改第一条数据"></a>//默认只修改第一条数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(&#123;userid:&quot; 1003 &quot;&#125;,&#123;$set:&#123;nickname:&quot;凯撒 2 &quot;&#125;&#125;)</span><br><span class="line">&#x2F;&#x2F;修改所有符合条件的数据</span><br><span class="line">db.comment.update(&#123;userid:&quot; 1003 &quot;&#125;,&#123;$set:&#123;nickname:&quot;凯撒大帝&quot;&#125;&#125;,&#123;multi:true&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(&#123;_id:&quot; 3 &quot;&#125;,&#123;$inc:&#123;likenum:NumberInt( 1 )&#125;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.remove(条件)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.remove(&#123;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.remove(&#123;_id:&quot; 1 &quot;&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br><span class="line">query document 查询选择条件。</span><br><span class="line">options document 可选。用于修改计数的额外选项。</span><br></pre></td></tr></table></figure>
<p>统计查询使用count()方法，语法如下：</p>
<h4 id="参数：-4"><a href="#参数：-4" class="headerlink" title="参数："></a>参数：</h4><h4 id="提示：-3"><a href="#提示：-3" class="headerlink" title="提示："></a>提示：</h4><h4 id="可选项暂时不使用。"><a href="#可选项暂时不使用。" class="headerlink" title="可选项暂时不使用。"></a>可选项暂时不使用。</h4><h4 id="【示例】-3"><a href="#【示例】-3" class="headerlink" title="【示例】"></a>【示例】</h4><h4 id="（-1-）统计所有记录数："><a href="#（-1-）统计所有记录数：" class="headerlink" title="（ 1 ）统计所有记录数："></a>（ 1 ）统计所有记录数：</h4><p>统计comment集合的所有的记录数：</p>
<h4 id="（-2-）按条件统计记录数："><a href="#（-2-）按条件统计记录数：" class="headerlink" title="（ 2 ）按条件统计记录数："></a>（ 2 ）按条件统计记录数：</h4><p>例如：统计userid为 1003 的记录条数</p>
<h4 id="提示：-4"><a href="#提示：-4" class="headerlink" title="提示："></a>提示：</h4><p>默认情况下count()方法返回符合条件的全部记录条数。</p>
<h3 id="3-5-2-分页列表查询"><a href="#3-5-2-分页列表查询" class="headerlink" title="3.5.2 分页列表查询"></a>3.5.2 分页列表查询</h3><p>可以使用limit()方法来读取指定数量的数据，使用skip()方法来跳过指定数量的数据。<br>基本语法如下所示：</p>
<p>如果你想返回指定条数的记录，可以在find方法后调用limit来返回结果(TopN)，默认值 20 ，例如：</p>
<p>skip方法同样接受一个数字参数作为跳过的记录条数。（前N个不要）,默认值是 0</p>
<h4 id="分页查询：需求：每页-2-个，第二页开始：跳过前两条数据，接着值显示-3-和-4-条数据"><a href="#分页查询：需求：每页-2-个，第二页开始：跳过前两条数据，接着值显示-3-和-4-条数据" class="headerlink" title="分页查询：需求：每页 2 个，第二页开始：跳过前两条数据，接着值显示 3 和 4 条数据"></a>分页查询：需求：每页 2 个，第二页开始：跳过前两条数据，接着值显示 3 和 4 条数据</h4><h3 id="3-5-3-排序查询"><a href="#3-5-3-排序查询" class="headerlink" title="3.5.3 排序查询"></a>3.5.3 排序查询</h3><p>sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用<br>于降序排列。<br>语法如下所示：</p>
<h4 id="例如："><a href="#例如：" class="headerlink" title="例如："></a>例如：</h4><p>对userid降序排列，并对访问量进行升序排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.count(query, options)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.count()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.count(&#123;userid:&quot; 1003 &quot;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().limit( 3 )</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().skip( 3 )</span><br></pre></td></tr></table></figure>
<h4 id="第一页"><a href="#第一页" class="headerlink" title="//第一页"></a>//第一页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().skip( 0 ).limit( 2 )</span><br><span class="line">&#x2F;&#x2F;第二页</span><br><span class="line">db.comment.find().skip( 2 ).limit( 2 )</span><br><span class="line">&#x2F;&#x2F;第三页</span><br><span class="line">db.comment.find().skip( 4 ).limit( 2 )</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.find().sort(&#123;KEY: 1 &#125;)</span><br><span class="line">或</span><br><span class="line">db.集合名称.find().sort(排序方式)</span><br></pre></td></tr></table></figure>

<h4 id="提示：-5"><a href="#提示：-5" class="headerlink" title="提示："></a>提示：</h4><p>skip(), limilt(), sort()三个放在一起执行的时候，执行的顺序是先 sort(), 然后是 skip()，最后是显示的 limit()，和命令编写顺序无关。</p>
<h2 id="3-6-文档的更多查询"><a href="#3-6-文档的更多查询" class="headerlink" title="3.6 文档的更多查询"></a>3.6 文档的更多查询</h2><h3 id="3-6-1-正则的复杂条件查询"><a href="#3-6-1-正则的复杂条件查询" class="headerlink" title="3.6.1 正则的复杂条件查询"></a>3.6.1 正则的复杂条件查询</h3><p>MongoDB的模糊查询是通过正则表达式的方式实现的。格式为：</p>
<p>提示：正则表达式是js的语法，直接量的写法。<br>例如，我要查询评论内容包含“开水”的所有文档，代码如下：</p>
<h4 id="如果要查询评论的内容中以“专家”开头的，代码如下："><a href="#如果要查询评论的内容中以“专家”开头的，代码如下：" class="headerlink" title="如果要查询评论的内容中以“专家”开头的，代码如下："></a>如果要查询评论的内容中以“专家”开头的，代码如下：</h4><h3 id="3-6-2-比较查询"><a href="#3-6-2-比较查询" class="headerlink" title="3.6.2 比较查询"></a>3.6.2 比较查询</h3><h4 id="lt-lt-gt-gt-这个操作符也是很常用的，格式如下"><a href="#lt-lt-gt-gt-这个操作符也是很常用的，格式如下" class="headerlink" title="&lt;, &lt;=, &gt;, &gt;= 这个操作符也是很常用的，格式如下:"></a>&lt;, &lt;=, &gt;, &gt;= 这个操作符也是很常用的，格式如下:</h4><h4 id="示例：查询评论点赞数量大于-700-的记录"><a href="#示例：查询评论点赞数量大于-700-的记录" class="headerlink" title="示例：查询评论点赞数量大于 700 的记录"></a>示例：查询评论点赞数量大于 700 的记录</h4><h3 id="3-6-3-包含查询"><a href="#3-6-3-包含查询" class="headerlink" title="3.6.3 包含查询"></a>3.6.3 包含查询</h3><p>包含使用$in操作符。 示例：查询评论的集合中userid字段包含 1003 或 1004 的文档</p>
<p>不包含使用$nin操作符。 示例：查询评论集合中userid字段不包含 1003 和 1004 的文档</p>
<h3 id="3-6-4-条件连接查询"><a href="#3-6-4-条件连接查询" class="headerlink" title="3.6.4 条件连接查询"></a>3.6.4 条件连接查询</h3><p>我们如果需要查询同时满足两个以上条件，需要使用$and操作符将条件进行关联。（相 当于SQL的and） 格式为：</p>
<p>示例：查询评论集合中likenum大于等于 700 并且小于 2000 的文档：</p>
<p>如果两个以上条件之间是或者的关系，我们使用 操作符进行关联，与前面 and的使用方式相同 格式为：</p>
<p>示例：查询评论集合中userid为 1003 ，或者点赞数小于 1000 的文档记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().sort(&#123;userid:- 1 ,likenum: 1 &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123;field:&#x2F;正则表达式&#x2F;&#125;)</span><br><span class="line">或</span><br><span class="line">db.集合.find(&#123;字段:&#x2F;正则表达式&#x2F;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;content:&#x2F;开水&#x2F;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;content:&#x2F;^专家&#x2F;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find(&#123; &quot;field&quot; : &#123; $gt: value &#125;&#125;) &#x2F;&#x2F; 大于: field &gt; value</span><br><span class="line">db.集合名称.find(&#123; &quot;field&quot; : &#123; $lt: value &#125;&#125;) &#x2F;&#x2F; 小于: field &lt; value</span><br><span class="line">db.集合名称.find(&#123; &quot;field&quot; : &#123; $gte: value &#125;&#125;) &#x2F;&#x2F; 大于等于: field &gt;&#x3D; value</span><br><span class="line">db.集合名称.find(&#123; &quot;field&quot; : &#123; $lte: value &#125;&#125;) &#x2F;&#x2F; 小于等于: field &lt;&#x3D; value</span><br><span class="line">db.集合名称.find(&#123; &quot;field&quot; : &#123; $ne: value &#125;&#125;) &#x2F;&#x2F; 不等于: field !&#x3D; value</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;likenum:&#123;$gt:NumberInt( 700 )&#125;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;userid:&#123;$in:[&quot; 1003 &quot;,&quot; 1004 &quot;]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;userid:&#123;$nin:[&quot; 1003 &quot;,&quot; 1004 &quot;]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$and:[ &#123; &#125;,&#123; &#125;,&#123; &#125; ]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;$and:[&#123;likenum:&#123;$gte:NumberInt( 700 )&#125;&#125;,&#123;likenum:&#123;$lt:NumberInt( 2000 )&#125;&#125;]&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$or:[ &#123; &#125;,&#123; &#125;,&#123; &#125; ]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(&#123;$or:[ &#123;userid:&quot; 1003 &quot;&#125; ,&#123;likenum:&#123;$lt: 1000 &#125; &#125;]&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-7-常用命令小结"><a href="#3-7-常用命令小结" class="headerlink" title="3.7 常用命令小结"></a>3.7 常用命令小结</h2><h1 id="4-索引-Index"><a href="#4-索引-Index" class="headerlink" title="4 索引-Index"></a>4 索引-Index</h1><h2 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h2><p>索引支持在MongoDB中高效地执行查询。如果没有索引，MongoDB必须执行全集合扫描，即扫描集合中的每个文档，以选择与查询语句<br>匹配的文档。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非<br>常致命的。<br>如果查询存在适当的索引，MongoDB可以使用该索引限制必须检查的文档数。<br>索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。索引存储特定字段或一组字段的值，按字段值排序。索引项的排<br>序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。<br>官网文档：<a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/indexes/</a><br>了解：<br>MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）</p>
<h2 id="4-2-索引的类型"><a href="#4-2-索引的类型" class="headerlink" title="4.2 索引的类型"></a>4.2 索引的类型</h2><h2 id="4-2-1-单字段索引"><a href="#4-2-1-单字段索引" class="headerlink" title="4.2.1 单字段索引"></a>4.2.1 单字段索引</h2><p>MongoDB支持在文档的单个字段上创建用户定义的升序/降序索引，称为单字段索引（Single Field Index）。<br>对于单个字段索引和排序操作，索引键的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引。</p>
<h2 id="4-2-2-复合索引"><a href="#4-2-2-复合索引" class="headerlink" title="4.2.2 复合索引"></a>4.2.2 复合索引</h2><p>MongoDB还支持多个字段的用户定义索引，即复合索引（Compound Index）。<br>复合索引中列出的字段顺序具有重要意义。例如，如果复合索引由{ userid: 1 , score: - 1 }组成，则索引首先按userid正序排序，然后<br>在每个userid的值内，再在按score倒序排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">选择切换数据库：use articledb</span><br><span class="line">插入数据：db.comment.insert(&#123;bson数据&#125;)</span><br><span class="line">查询所有数据：db.comment.find();</span><br><span class="line">条件查询数据：db.comment.find(&#123;条件&#125;)</span><br><span class="line">查询符合条件的第一条记录：db.comment.findOne(&#123;条件&#125;)</span><br><span class="line">查询符合条件的前几条记录：db.comment.find(&#123;条件&#125;).limit(条数)</span><br><span class="line">查询符合条件的跳过的记录：db.comment.find(&#123;条件&#125;).skip(条数)</span><br><span class="line">修改数据：db.comment.update(&#123;条件&#125;,&#123;修改后的数据&#125;) 或db.comment.update(&#123;条件&#125;,&#123;$set:&#123;要修改部分的字段:数据&#125;)</span><br><span class="line">修改数据并自增某字段值：db.comment.update(&#123;条件&#125;,&#123;$inc:&#123;自增的字段:步进值&#125;&#125;)</span><br><span class="line">删除数据：db.comment.remove(&#123;条件&#125;)</span><br><span class="line">统计查询：db.comment.count(&#123;条件&#125;)</span><br><span class="line">模糊查询：db.comment.find(&#123;字段名:&#x2F;正则表达式&#x2F;&#125;)</span><br><span class="line">条件比较运算：db.comment.find(&#123;字段名:&#123;$gt:值&#125;&#125;)</span><br><span class="line">包含查询：db.comment.find(&#123;字段名:&#123;$in:[值 1 ，值 2 ]&#125;&#125;)或db.comment.find(&#123;字段名:&#123;$nin:[值 1 ，值 2 ]&#125;&#125;)</span><br><span class="line">条件连接查询：db.comment.find(&#123;$and:[&#123;条件 1 &#125;,&#123;条件 2 &#125;]&#125;)或db.comment.find(&#123;$or:[&#123;条件 1 &#125;,&#123;条件 2 &#125;]&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-其他索引"><a href="#4-2-3-其他索引" class="headerlink" title="4.2.3 其他索引"></a>4.2.3 其他索引</h3><p>地理空间索引（Geospatial Index）、文本索引（Text Indexes）、哈希索引（Hashed Indexes）。</p>
<p>地理空间索引（Geospatial Index）<br>为了支持对地理空间坐标数据的有效查询，MongoDB提供了两种特殊的索引：返回结果时使用平面几何的二维索引和返回结果时使用球面<br>几何的二维球面索引。<br>文本索引（Text Indexes）<br>MongoDB提供了一种文本索引类型，支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如“the”、“a”、“or”），<br>而将集合中的词作为词干，只存储根词。<br>哈希索引（Hashed Indexes）<br>为了支持基于散列的分片，MongoDB提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分布更加随机，但只支<br>持相等匹配，不支持基于范围的查询。</p>
<h2 id="4-3-索引的管理操作"><a href="#4-3-索引的管理操作" class="headerlink" title="4.3 索引的管理操作"></a>4.3 索引的管理操作</h2><h3 id="4-3-1-索引的查看"><a href="#4-3-1-索引的查看" class="headerlink" title="4.3.1 索引的查看"></a>4.3.1 索引的查看</h3><h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><h4 id="返回一个集合中的所有索引的数组。"><a href="#返回一个集合中的所有索引的数组。" class="headerlink" title="返回一个集合中的所有索引的数组。"></a>返回一个集合中的所有索引的数组。</h4><h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><p>提示：该语法命令运行要求是MongoDB 3.0+<br>【示例】<br>查看comment集合中所有的索引情况</p>
<p>结果中显示的是默认_id索引。<br>默认_id索引：<br>MongoDB在创建集合的过程中，在_id字段上创建一个唯一的索引，默认名字为_id_，该索引可防止客户端插入两个具有相同值的文<br>档，您不能在_id字段上删除此索引。<br>注意：该索引是唯一索引，因此值不能重复，即_id值不能重复的。在分片集群中，通常使用_id作为片键。</p>
<h3 id="4-3-2-索引的创建"><a href="#4-3-2-索引的创建" class="headerlink" title="4.3.2 索引的创建"></a>4.3.2 索引的创建</h3><h4 id="说明：-1"><a href="#说明：-1" class="headerlink" title="说明："></a>说明：</h4><h4 id="在集合上创建索引。"><a href="#在集合上创建索引。" class="headerlink" title="在集合上创建索引。"></a>在集合上创建索引。</h4><h4 id="语法：-1"><a href="#语法：-1" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.getIndexes()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.getIndexes()</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">&quot;v&quot; : 2 ,</span><br><span class="line">&quot;key&quot; : &#123;</span><br><span class="line">&quot;_id&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;name&quot; : &quot;_id_&quot;,</span><br><span class="line">&quot;ns&quot; : &quot;articledb.comment&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(keys, options)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys document</span><br></pre></td></tr></table></figure>
<h4 id="包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。对于字段上的升序索引，请"><a href="#包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。对于字段上的升序索引，请" class="headerlink" title="包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。对于字段上的升序索引，请"></a>包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。对于字段上的升序索引，请</h4><h4 id="指定值-1-；对于降序索引，请指定值-1。比如：-字段-1-或-1-，其中-1-为指定按升序创建索引，如果你"><a href="#指定值-1-；对于降序索引，请指定值-1。比如：-字段-1-或-1-，其中-1-为指定按升序创建索引，如果你" class="headerlink" title="指定值 1 ；对于降序索引，请指定值-1。比如：{字段: 1 或- 1 }，其中 1 为指定按升序创建索引，如果你"></a>指定值 1 ；对于降序索引，请指定值-1。比如：{字段: 1 或- 1 }，其中 1 为指定按升序创建索引，如果你</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">想按降序来创建索引指定为 -1 即可。另外，MongoDB支持几种不同的索引类型，包括文本、地理空</span><br><span class="line">间和哈希索引。</span><br><span class="line">options document 可选。包含一组控制索引创建的选项的文档。有关详细信息，请参见选项详情列表。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br><span class="line">background Boolean 建索引过程会阻塞其它数据库操作，&quot;background&quot; 可选参数。 &quot;background&quot; backgr默认值为ound可指定以后台方式创建索引，即增加false。</span><br><span class="line">unique Boolean 建立的索引是否唯一。指定为true创建唯一索引。默认值为false.</span><br><span class="line">name string 索引的名称。如果未指定，称。 MongoDB的通过连接索引的字段名和排序顺序生成一个索引名</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dropDups Boolean 3.0+false版本已废弃。. 在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sparse Boolean 对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为引字段中不会查询出不包含对应字段的文档.。默认值为 false. true的话，在索</span><br><span class="line">expireAfterSeconds integer 指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。</span><br><span class="line">v indeversionx 索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。</span><br><span class="line">weights document 索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。</span><br><span class="line">default_language string 对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语</span><br><span class="line">language_override string 对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language. language，默认值为</span><br></pre></td></tr></table></figure>
<h4 id="参数：-5"><a href="#参数：-5" class="headerlink" title="参数："></a>参数：</h4><p>options（更多选项）列表：</p>
<h4 id="提示：-6"><a href="#提示：-6" class="headerlink" title="提示："></a>提示：</h4><p>注意在 3.0.0 版本前创建索引方法为 db.collection.ensureIndex()，之后的版本使用了 db.collection.createIndex() 方法，<br>ensureIndex()还能用，但只是 createIndex()的别名。</p>
<h4 id="【示例】-4"><a href="#【示例】-4" class="headerlink" title="【示例】"></a>【示例】</h4><p>（ 1 ）单字段索引示例：对userid字段建立索引：</p>
<h4 id="参数-1-：按升序创建索引"><a href="#参数-1-：按升序创建索引" class="headerlink" title="参数 1 ：按升序创建索引"></a>参数 1 ：按升序创建索引</h4><h4 id="可以查看一下："><a href="#可以查看一下：" class="headerlink" title="可以查看一下："></a>可以查看一下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.createIndex(&#123;userid: 1 &#125;)</span><br><span class="line">&#123;</span><br><span class="line">&quot;createdCollectionAutomatically&quot; : false,</span><br><span class="line">&quot;numIndexesBefore&quot; : 1 ,</span><br><span class="line">&quot;numIndexesAfter&quot; : 2 ,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.getIndexes()</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">&quot;v&quot; : 2 ,</span><br><span class="line">&quot;key&quot; : &#123;</span><br><span class="line">&quot;_id&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;name&quot; : &quot;_id_&quot;,</span><br><span class="line">&quot;ns&quot; : &quot;articledb.comment&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;v&quot; : 2 ,</span><br><span class="line">&quot;key&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;name&quot; : &quot;userid_ 1 &quot;,</span><br><span class="line">&quot;ns&quot; : &quot;articledb.comment&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Parameter Type Description</span><br><span class="line">index string ordocument 指定要删除的索引。可以通过索引名称或索引规范文档指定索引。若要删除文本索引，请指定索引名称。</span><br></pre></td></tr></table></figure>
<p>索引名字为`userid_<br>compass查看：</p>
<h4 id=""><a href="#" class="headerlink" title="`"></a>`</h4><p>（ 2 ）复合索引：对userid和nickname同时建立复合（Compound）索引：</p>
<h4 id="查看一下索引："><a href="#查看一下索引：" class="headerlink" title="查看一下索引："></a>查看一下索引：</h4><p>compass中：</p>
<h3 id="4-3-3-索引的移除"><a href="#4-3-3-索引的移除" class="headerlink" title="4.3.3 索引的移除"></a>4.3.3 索引的移除</h3><h4 id="说明：可以移除指定的索引，或移除所有索引"><a href="#说明：可以移除指定的索引，或移除所有索引" class="headerlink" title="说明：可以移除指定的索引，或移除所有索引"></a>说明：可以移除指定的索引，或移除所有索引</h4><h4 id="一、指定索引的移除"><a href="#一、指定索引的移除" class="headerlink" title="一、指定索引的移除"></a>一、指定索引的移除</h4><h4 id="语法：-2"><a href="#语法：-2" class="headerlink" title="语法："></a>语法：</h4><h4 id="参数：-6"><a href="#参数：-6" class="headerlink" title="参数："></a>参数：</h4><h4 id="【示例】-5"><a href="#【示例】-5" class="headerlink" title="【示例】"></a>【示例】</h4><p>删除comment集合中userid字段上的升序索引：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.createIndex(&#123;userid: 1 ,nickname:- 1 &#125;)</span><br><span class="line">&#123;</span><br><span class="line">&quot;createdCollectionAutomatically&quot; : false,</span><br><span class="line">&quot;numIndexesBefore&quot; : 2 ,</span><br><span class="line">&quot;numIndexesAfter&quot; : 3 ,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.getIndexes()</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">&quot;v&quot; : 2 ,</span><br><span class="line">&quot;key&quot; : &#123;</span><br><span class="line">&quot;_id&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;name&quot; : &quot;_id_&quot;,</span><br><span class="line">&quot;ns&quot; : &quot;articledb.comment&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;v&quot; : 2 ,</span><br><span class="line">&quot;key&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;name&quot; : &quot;userid_ 1 &quot;,</span><br><span class="line">&quot;ns&quot; : &quot;articledb.comment&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;v&quot; : 2 ,</span><br><span class="line">&quot;key&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : 1 ,</span><br><span class="line">&quot;nickname&quot; : - 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;name&quot; : &quot;userid_ 1 _nickname_- 1 &quot;,</span><br><span class="line">&quot;ns&quot; : &quot;articledb.comment&quot;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndex(index)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.dropIndex(&#123;userid: 1 &#125;)</span><br><span class="line">&#123; &quot;nIndexesWas&quot; : 3 , &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure>

<h4 id="查看已经删除了。"><a href="#查看已经删除了。" class="headerlink" title="查看已经删除了。"></a>查看已经删除了。</h4><h4 id="二、所有索引的移除"><a href="#二、所有索引的移除" class="headerlink" title="二、所有索引的移除"></a>二、所有索引的移除</h4><h4 id="语法：-3"><a href="#语法：-3" class="headerlink" title="语法："></a>语法：</h4><h4 id="【示例】-6"><a href="#【示例】-6" class="headerlink" title="【示例】"></a>【示例】</h4><p>删除spit集合中所有索引。</p>
<p>提示：_id的字段的索引是无法删除的，只能删除非_id字段的索引。</p>
<h2 id="4-4-索引的使用"><a href="#4-4-索引的使用" class="headerlink" title="4.4 索引的使用^"></a>4.4 索引的使用^</h2><h3 id="4-4-1-执行计划"><a href="#4-4-1-执行计划" class="headerlink" title="4.4.1 执行计划"></a>4.4.1 执行计划</h3><p>分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询的情况，如查询耗费的时间、是<br>否基于索引查询等。<br>那么，通常，我们想知道，建立的索引是否有效，效果如何，都需要通过执行计划查看。<br>语法：</p>
<h4 id="【示例】-7"><a href="#【示例】-7" class="headerlink" title="【示例】"></a>【示例】</h4><p>查看根据userid查询数据的情况：</p>
<p>关键点看：”stage” : “COLLSCAN”,表示全集合扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndexes()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.dropIndexes()</span><br><span class="line">&#123;</span><br><span class="line">&quot;nIndexesWas&quot; : 2 ,</span><br><span class="line">&quot;msg&quot; : &quot;non-_id indexes dropped for collection&quot;,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query,options).explain(options)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:&quot; 1003 &quot;&#125;).explain()</span><br><span class="line">&#123;</span><br><span class="line">&quot;queryPlanner&quot; : &#123;</span><br><span class="line">&quot;plannerVersion&quot; : 1 ,</span><br><span class="line">&quot;namespace&quot; : &quot;articledb.comment&quot;,</span><br><span class="line">&quot;indexFilterSet&quot; : false,</span><br><span class="line">&quot;parsedQuery&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : &#123;</span><br><span class="line">&quot;$eq&quot; : &quot; 1003 &quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;winningPlan&quot; : &#123;</span><br><span class="line">&quot;stage&quot; : &quot;COLLSCAN&quot;,</span><br><span class="line">&quot;filter&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : &#123;</span><br><span class="line">&quot;$eq&quot; : &quot; 1003 &quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;direction&quot; : &quot;forward&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;rejectedPlans&quot; : [ ]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;serverInfo&quot; : &#123;</span><br><span class="line">&quot;host&quot; : &quot; 9 ef 3740277 ad&quot;,</span><br><span class="line">&quot;port&quot; : 27017 ,</span><br><span class="line">&quot;version&quot; : &quot; 4. 0. 10 &quot;,</span><br><span class="line">&quot;gitVersion&quot; : &quot;c 389 e 7 f 69 f 637 f 7 a 1 ac 3 cc 9 fae 843 b 635 f 20 b 766 &quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面对userid建立索引</p>
<h4 id="再次查看执行计划："><a href="#再次查看执行计划：" class="headerlink" title="再次查看执行计划："></a>再次查看执行计划：</h4><p>关键点看：”stage” : “IXSCAN”,基于索引的扫描<br>compass查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.createIndex(&#123;userid: 1 &#125;)</span><br><span class="line">&#123;</span><br><span class="line">&quot;createdCollectionAutomatically&quot; : false,</span><br><span class="line">&quot;numIndexesBefore&quot; : 1 ,</span><br><span class="line">&quot;numIndexesAfter&quot; : 2 ,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:&quot; 1013 &quot;&#125;).explain()</span><br><span class="line">&#123;</span><br><span class="line">&quot;queryPlanner&quot; : &#123;</span><br><span class="line">&quot;plannerVersion&quot; : 1 ,</span><br><span class="line">&quot;namespace&quot; : &quot;articledb.comment&quot;,</span><br><span class="line">&quot;indexFilterSet&quot; : false,</span><br><span class="line">&quot;parsedQuery&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : &#123;</span><br><span class="line">&quot;$eq&quot; : &quot; 1013 &quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;winningPlan&quot; : &#123;</span><br><span class="line">&quot;stage&quot; : &quot;FETCH&quot;,</span><br><span class="line">&quot;inputStage&quot; : &#123;</span><br><span class="line">&quot;stage&quot; : &quot;IXSCAN&quot;,</span><br><span class="line">&quot;keyPattern&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;indexName&quot; : &quot;userid_ 1 &quot;,</span><br><span class="line">&quot;isMultiKey&quot; : false,</span><br><span class="line">&quot;multiKeyPaths&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : [ ]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;isUnique&quot; : false,</span><br><span class="line">&quot;isSparse&quot; : false,</span><br><span class="line">&quot;isPartial&quot; : false,</span><br><span class="line">&quot;indexVersion&quot; : 2 ,</span><br><span class="line">&quot;direction&quot; : &quot;forward&quot;,</span><br><span class="line">&quot;indexBounds&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : [</span><br><span class="line">&quot;[\&quot; 1013 \&quot;, \&quot; 1013 \&quot;]&quot;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;rejectedPlans&quot; : [ ]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;serverInfo&quot; : &#123;</span><br><span class="line">&quot;host&quot; : &quot; 9 ef 3740277 ad&quot;,</span><br><span class="line">&quot;port&quot; : 27017 ,</span><br><span class="line">&quot;version&quot; : &quot; 4. 0. 10 &quot;,</span><br><span class="line">&quot;gitVersion&quot; : &quot;c 389 e 7 f 69 f 637 f 7 a 1 ac 3 cc 9 fae 843 b 635 f 20 b 766 &quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-2-涵盖的查询"><a href="#4-4-2-涵盖的查询" class="headerlink" title="4.4.2 涵盖的查询"></a>4.4.2 涵盖的查询</h3><p>Covered Queries<br>当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存。 这些覆盖的查询可以<br>非常有效。</p>
<p>更多：<a href="https://docs.mongodb.com/manual/core/query-optimization/#read-operations-covered-query" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/query-optimization/#read-operations-covered-query</a><br>【示例】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.comment.find(&#123;userid:&quot; 1003 &quot;&#125;,&#123;userid: 1 ,_id: 0 &#125;)</span><br><span class="line">&#123; &quot;userid&quot; : &quot; 1003 &quot; &#125;</span><br><span class="line">&#123; &quot;userid&quot; : &quot; 1003 &quot; &#125;</span><br><span class="line">&gt; db.comment.find(&#123;userid:&quot; 1003 &quot;&#125;,&#123;userid: 1 ,_id: 0 &#125;).explain()</span><br><span class="line">&#123;</span><br><span class="line">&quot;queryPlanner&quot; : &#123;</span><br><span class="line">&quot;plannerVersion&quot; : 1 ,</span><br><span class="line">&quot;namespace&quot; : &quot;articledb.comment&quot;,</span><br><span class="line">&quot;indexFilterSet&quot; : false,</span><br><span class="line">&quot;parsedQuery&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : &#123;</span><br><span class="line">&quot;$eq&quot; : &quot; 1003 &quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;winningPlan&quot; : &#123;</span><br><span class="line">&quot;stage&quot; : &quot;PROJECTION&quot;,</span><br><span class="line">&quot;transformBy&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : 1 ,</span><br><span class="line">&quot;_id&quot; : 0</span><br><span class="line">&#125;,</span><br><span class="line">&quot;inputStage&quot; : &#123;</span><br><span class="line">&quot;stage&quot; : &quot;IXSCAN&quot;,</span><br><span class="line">&quot;keyPattern&quot; : &#123;</span><br></pre></td></tr></table></figure>

<p>Compass中：</p>
<h1 id="5-文章评论"><a href="#5-文章评论" class="headerlink" title="5 文章评论"></a>5 文章评论</h1><h2 id="5-1-需求分析"><a href="#5-1-需求分析" class="headerlink" title="5.1 需求分析"></a>5.1 需求分析</h2><h4 id="某头条的文章评论业务如下："><a href="#某头条的文章评论业务如下：" class="headerlink" title="某头条的文章评论业务如下："></a>某头条的文章评论业务如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&quot;userid&quot; : 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;indexName&quot; : &quot;userid_ 1 &quot;,</span><br><span class="line">&quot;isMultiKey&quot; : false,</span><br><span class="line">&quot;multiKeyPaths&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : [ ]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;isUnique&quot; : false,</span><br><span class="line">&quot;isSparse&quot; : false,</span><br><span class="line">&quot;isPartial&quot; : false,</span><br><span class="line">&quot;indexVersion&quot; : 2 ,</span><br><span class="line">&quot;direction&quot; : &quot;forward&quot;,</span><br><span class="line">&quot;indexBounds&quot; : &#123;</span><br><span class="line">&quot;userid&quot; : [</span><br><span class="line">&quot;[\&quot; 1003 \&quot;, \&quot; 1003 \&quot;]&quot;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;rejectedPlans&quot; : [ ]</span><br><span class="line">&#125;,</span><br><span class="line">&quot;serverInfo&quot; : &#123;</span><br><span class="line">&quot;host&quot; : &quot;bobohost.localdomain&quot;,</span><br><span class="line">&quot;port&quot; : 27017 ,</span><br><span class="line">&quot;version&quot; : &quot; 4. 0. 10 &quot;,</span><br><span class="line">&quot;gitVersion&quot; : &quot;c 389 e 7 f 69 f 637 f 7 a 1 ac 3 cc 9 fae 843 b 635 f 20 b 766 &quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">专栏文章评论 comment</span><br><span class="line">字段名称 字段含义 字段类型 备注</span><br><span class="line">_id ID ObjectId或String Mongo的主键的字段</span><br><span class="line">articleid 文章ID String</span><br><span class="line">content 评论内容 String</span><br><span class="line">userid 评论人ID String</span><br><span class="line">nickname 评论人昵称 String</span><br><span class="line">createdatetime 评论的日期时间 Date</span><br><span class="line">likenum 点赞数 Int32</span><br><span class="line">replynum 回复数 Int32</span><br><span class="line">state 状态 String 0 ：不可见； 1 ：可见；</span><br><span class="line">parentid 上级ID String 如果为 0 表示文章的顶级评论</span><br></pre></td></tr></table></figure>
<p>文章示例参考：早晨空腹喝水，是对还是错？<a href="https://www.toutiao.com/a6721476546088927748/" target="_blank" rel="noopener">https://www.toutiao.com/a6721476546088927748/</a><br>需要实现以下功能：<br>1 ）基本增删改查API<br>2 ）根据文章id查询评论<br>3 ）评论点赞</p>
<h2 id="5-2-表结构分析"><a href="#5-2-表结构分析" class="headerlink" title="5.2 表结构分析"></a>5.2 表结构分析</h2><p>数据库：articledb</p>
<h2 id="5-3-技术选型"><a href="#5-3-技术选型" class="headerlink" title="5.3 技术选型"></a>5.3 技术选型</h2><h3 id="5-3-1-mongodb-driver（了解）"><a href="#5-3-1-mongodb-driver（了解）" class="headerlink" title="5.3.1 mongodb-driver（了解）"></a>5.3.1 mongodb-driver（了解）</h3><p>mongodb-driver是mongo官方推出的java连接mongoDB的驱动包，相当于JDBC驱动。我们通过一个入门的案例来了解mongodb-driver<br>的基本使用。<br>官方驱动说明和下载：<a href="http://mongodb.github.io/mongo-java-driver/" target="_blank" rel="noopener">http://mongodb.github.io/mongo-java-driver/</a><br>官方驱动示例文档：<a href="http://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/" target="_blank" rel="noopener">http://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/</a></p>
<h3 id="5-3-2-SpringDataMongoDB"><a href="#5-3-2-SpringDataMongoDB" class="headerlink" title="5.3.2 SpringDataMongoDB"></a>5.3.2 SpringDataMongoDB</h3><p>SpringData家族成员之一，用于操作MongoDB的持久层框架，封装了底层的mongodb-driver。<br>官网主页： <a href="https://projects.spring.io/spring-data-mongodb/" target="_blank" rel="noopener">https://projects.spring.io/spring-data-mongodb/</a><br>我们十次方项目的吐槽微服务就采用SpringDataMongoDB框架。</p>
<h2 id="5-4-文章微服务模块搭建"><a href="#5-4-文章微服务模块搭建" class="headerlink" title="5.4 文章微服务模块搭建"></a>5.4 文章微服务模块搭建</h2><p>（ 1 ）搭建项目工程article，pom.xml引入依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot; 1. 0 &quot; encoding&#x3D;&quot;UTF- 8 &quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F; 4. 0. 0 &quot;</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w 3 .org&#x2F; 2001 &#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F; 4. 0. 0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven- 4. 0. 0 .xsd&quot;&gt;</span><br><span class="line">&lt;modelVersion&gt; 4. 0. 0 &lt;&#x2F;modelVersion&gt;</span><br><span class="line">&lt;parent&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;version&gt; 2. 1. 6 .RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">&lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository - -&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br><span class="line">&lt;groupId&gt;cn.itcast&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;article&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;version&gt; 1. 0 - SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>（ 2 ）创建application.yml</p>
<h4 id="（-3-）创建启动类"><a href="#（-3-）创建启动类" class="headerlink" title="（ 3 ）创建启动类"></a>（ 3 ）创建启动类</h4><p>cn.itcast.article.ArticleApplication</p>
<h4 id="（-4-）启动项目，看是否能正常启动，控制台没有错误。"><a href="#（-4-）启动项目，看是否能正常启动，控制台没有错误。" class="headerlink" title="（ 4 ）启动项目，看是否能正常启动，控制台没有错误。"></a>（ 4 ）启动项目，看是否能正常启动，控制台没有错误。</h4><h2 id="5-5-文章评论实体类的编写"><a href="#5-5-文章评论实体类的编写" class="headerlink" title="5.5 文章评论实体类的编写"></a>5.5 文章评论实体类的编写</h2><p>创建实体类 创建包cn.itcast.article，包下建包po用于存放实体类，创建实体类<br>cn.itcast.article.po.Comment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">#数据源配置</span><br><span class="line">data:</span><br><span class="line">mongodb:</span><br><span class="line"># 主机地址</span><br><span class="line">host: 192. 168. 40. 141</span><br><span class="line"># 数据库</span><br><span class="line">database: articledb</span><br><span class="line"># 默认端口是 27017</span><br><span class="line">port: 27017</span><br><span class="line">#也可以使用uri连接</span><br><span class="line">#uri: mongodb:&#x2F;&#x2F; 192. 168. 40. 134 : 27017 &#x2F;articledb</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.article;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class ArticleApplication &#123;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">SpringApplication.run(ArticleApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.article.po;</span><br><span class="line">import org.springframework.data.annotation.Id;</span><br><span class="line">import org.springframework.data.mongodb.core.index.Indexed;</span><br><span class="line">import org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line">import org.springframework.data.mongodb.core.mapping.Field;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.Date;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 文章评论实体类</span><br><span class="line">*&#x2F;</span><br><span class="line">&#x2F;&#x2F;把一个java类声明为mongodb的文档，可以通过collection参数指定这个类对应的文档。</span><br><span class="line">&#x2F;&#x2F;@Document(collection&#x3D;&quot;mongodb 对应 collection 名&quot;)</span><br><span class="line">&#x2F;&#x2F; 若未加 @Document ，该 bean save 到 mongo 的 comment collection</span><br><span class="line">&#x2F;&#x2F; 若添加 @Document ，则 save 到 comment collection</span><br><span class="line">@Document(collection&#x3D;&quot;comment&quot;)&#x2F;&#x2F;可以省略，如果省略，则默认使用类名小写映射集合</span><br><span class="line">&#x2F;&#x2F;复合索引</span><br><span class="line">&#x2F;&#x2F; @CompoundIndex( def &#x3D; &quot;&#123;&#39;userid&#39;: 1 , &#39;nickname&#39;: - 1 &#125;&quot;)</span><br><span class="line">public class Comment implements Serializable &#123;</span><br><span class="line">&#x2F;&#x2F;主键标识，该属性的值会自动对应mongodb的主键字段&quot;_id&quot;，如果该属性名就叫“id”,则该注解可以省略，否则必须写</span><br><span class="line">@Id</span><br><span class="line">private String id;&#x2F;&#x2F;主键</span><br><span class="line">&#x2F;&#x2F;该属性对应mongodb的字段的名字，如果一致，则无需该注解</span><br><span class="line">@Field(&quot;content&quot;)</span><br></pre></td></tr></table></figure>

<p>private String content;//吐槽内容<br>private Date publishtime;//发布日期<br>//添加了一个单字段的索引<br>@Indexed<br>private String userid;//发布人ID<br>private String nickname;//昵称<br>private LocalDateTime createdatetime;//评论的日期时间<br>private Integer likenum;//点赞数<br>private Integer replynum;//回复数<br>private String state;//状态<br>private String parentid;//上级ID<br>private String articleid;<br>//getter and setter…..</p>
<p>public String getId() {<br>return id;<br>}</p>
<p>public void setId(String id) {<br>this.id = id;<br>}</p>
<p>public String getContent() {<br>return content;<br>}</p>
<p>public void setContent(String content) {<br>this.content = content;<br>}</p>
<p>public Date getPublishtime() {<br>return publishtime;<br>}</p>
<p>public void setPublishtime(Date publishtime) {<br>this.publishtime = publishtime;<br>}</p>
<p>public String getUserid() {<br>return userid;<br>}</p>
<p>public void setUserid(String userid) {<br>this.userid = userid;<br>}</p>
<p>public String getNickname() {<br>return nickname;<br>}</p>
<p>public void setNickname(String nickname) {<br>this.nickname = nickname;<br>}</p>
<p>public LocalDateTime getCreatedatetime() {<br>return createdatetime;<br>}</p>
<p>public void setCreatedatetime(LocalDateTime createdatetime) {<br>this.createdatetime = createdatetime;<br>}</p>
<p>public Integer getLikenum() {<br>return likenum;<br>}</p>
<p>public void setLikenum(Integer likenum) {<br>this.likenum = likenum;<br>}</p>
<p>public Integer getReplynum() {<br>return replynum;<br>}</p>
<p>public void setReplynum(Integer replynum) {<br>this.replynum = replynum;<br>}</p>
<p>public String getState() {<br>return state;<br>}</p>
<p>public void setState(String state) {<br>this.state = state;<br>}</p>
<p>public String getParentid() {</p>
<h4 id="说明：-2"><a href="#说明：-2" class="headerlink" title="说明："></a>说明：</h4><p>索引可以大大提升查询效率，一般在查询字段上添加索引，索引的添加可以通过Mongo的命令来添加，也可以在Java的实体类中通过注解添<br>加。</p>
<p>1 ）单字段索引注解@Indexed<br>org.springframework.data.mongodb.core.index.Indexed.class<br>声明该字段需要索引，建索引可以大大的提高查询效率。<br>Mongo命令参考：</p>
<p>2 ）复合索引注解@CompoundIndex<br>org.springframework.data.mongodb.core.index.CompoundIndex.class<br>复合索引的声明，建复合索引可以有效地提高多字段的查询效率。<br>Mongo命令参考：</p>
<h2 id="5-6-文章评论的基本增删改查"><a href="#5-6-文章评论的基本增删改查" class="headerlink" title="5.6 文章评论的基本增删改查"></a>5.6 文章评论的基本增删改查</h2><p>（ 1 ）创建数据访问接口 cn.itcast.article包下创建dao包，包下创建接口<br>cn.itcast.article.dao.CommentRepository</p>
<p>（ 2 ）创建业务逻辑类 cn.itcast.article包下创建service包，包下创建类<br>cn.itcast.article.service.CommentService</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">return parentid;</span><br><span class="line">&#125;</span><br><span class="line">public void setParentid(String parentid) &#123;</span><br><span class="line">this.parentid &#x3D; parentid;</span><br><span class="line">&#125;</span><br><span class="line">public String getArticleid() &#123;</span><br><span class="line">return articleid;</span><br><span class="line">&#125;</span><br><span class="line">public void setArticleid(String articleid) &#123;</span><br><span class="line">this.articleid &#x3D; articleid;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public String toString() &#123;</span><br><span class="line">return &quot;Comment&#123;&quot; +</span><br><span class="line">&quot;id&#x3D;&#39;&quot; + id + &#39;\&#39;&#39; +</span><br><span class="line">&quot;, content&#x3D;&#39;&quot; + content + &#39;\&#39;&#39; +</span><br><span class="line">&quot;, publishtime&#x3D;&quot; + publishtime +</span><br><span class="line">&quot;, userid&#x3D;&#39;&quot; + userid + &#39;\&#39;&#39; +</span><br><span class="line">&quot;, nickname&#x3D;&#39;&quot; + nickname + &#39;\&#39;&#39; +</span><br><span class="line">&quot;, createdatetime&#x3D;&quot; + createdatetime +</span><br><span class="line">&quot;, likenum&#x3D;&quot; + likenum +</span><br><span class="line">&quot;, replynum&#x3D;&quot; + replynum +</span><br><span class="line">&quot;, state&#x3D;&#39;&quot; + state + &#39;\&#39;&#39; +</span><br><span class="line">&quot;, parentid&#x3D;&#39;&quot; + parentid + &#39;\&#39;&#39; +</span><br><span class="line">&quot;, articleid&#x3D;&#39;&quot; + articleid + &#39;\&#39;&#39; +</span><br><span class="line">&#39;&#125;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.createIndex(&#123;&quot;userid&quot;: 1 &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.createIndex(&#123;&quot;userid&quot;: 1 ,&quot;nickname&quot;:- 1 &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.article.dao;</span><br><span class="line">import cn.itcast.article.po.Comment;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.data.mongodb.repository.MongoRepository;</span><br><span class="line">&#x2F;&#x2F;评论的持久层接口</span><br><span class="line">public interface CommentRepository extends MongoRepository&lt;Comment,String&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.article.service;</span><br><span class="line">import cn.itcast.article.dao.CommentRepository;</span><br></pre></td></tr></table></figure>

<p>（ 3 ）新建Junit测试类，测试保存和查询所有：<br>cn.itcast.article.service.CommentServiceTest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import cn.itcast.article.po.Comment;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import java.util.List;</span><br><span class="line">&#x2F;&#x2F;评论的业务层</span><br><span class="line">@Service</span><br><span class="line">public class CommentService &#123;</span><br><span class="line">&#x2F;&#x2F;注入dao</span><br><span class="line">@Autowired</span><br><span class="line">private CommentRepository commentRepository;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 保存一个评论</span><br><span class="line">* @param comment</span><br><span class="line">*&#x2F;</span><br><span class="line">public void saveComment(Comment comment)&#123;</span><br><span class="line">&#x2F;&#x2F;如果需要自定义主键，可以在这里指定主键；如果不指定主键，MongoDB会自动生成主键</span><br><span class="line">&#x2F;&#x2F;设置一些默认初始值。。。</span><br><span class="line">&#x2F;&#x2F;调用dao</span><br><span class="line">commentRepository.save(comment);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 更新评论</span><br><span class="line">* @param comment</span><br><span class="line">*&#x2F;</span><br><span class="line">public void updateComment(Comment comment)&#123;</span><br><span class="line">&#x2F;&#x2F;调用dao</span><br><span class="line">commentRepository.save(comment);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 根据id删除评论</span><br><span class="line">* @param id</span><br><span class="line">*&#x2F;</span><br><span class="line">public void deleteCommentById(String id)&#123;</span><br><span class="line">&#x2F;&#x2F;调用dao</span><br><span class="line">commentRepository.deleteById(id);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 查询所有评论</span><br><span class="line">* @return</span><br><span class="line">*&#x2F;</span><br><span class="line">public List&lt;Comment&gt; findCommentList()&#123;</span><br><span class="line">&#x2F;&#x2F;调用dao</span><br><span class="line">return commentRepository.findAll();</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 根据id查询评论</span><br><span class="line">* @param id</span><br><span class="line">* @return</span><br><span class="line">*&#x2F;</span><br><span class="line">public Comment findCommentById(String id)&#123;</span><br><span class="line">&#x2F;&#x2F;调用dao</span><br><span class="line">return commentRepository.findById(id).get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="-1"><a href="#-1" class="headerlink" title="}"></a>}</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.article.service;</span><br><span class="line">import cn.itcast.article.ArticleApplication;</span><br><span class="line">import cn.itcast.article.po.Comment;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.test.context.junit 4 .SpringRunner;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.List;</span><br><span class="line">&#x2F;&#x2F;测试评论的业务层</span><br></pre></td></tr></table></figure>

<h4 id="添加结果："><a href="#添加结果：" class="headerlink" title="添加结果："></a>添加结果：</h4><h2 id="5-7-根据上级ID查询文章评论的分页列表"><a href="#5-7-根据上级ID查询文章评论的分页列表" class="headerlink" title="5.7 根据上级ID查询文章评论的分页列表"></a>5.7 根据上级ID查询文章评论的分页列表</h2><p>（ 1 ）CommentRepository新增方法定义</p>
<p>（ 2 ）CommentService新增方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;SpringBoot的Junit集成测试</span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">&#x2F;&#x2F;SpringBoot的测试环境初始化，参数：启动类</span><br><span class="line">@SpringBootTest(classes &#x3D; ArticleApplication.class)</span><br><span class="line">public class CommentServiceTest &#123;</span><br><span class="line">&#x2F;&#x2F;注入Service</span><br><span class="line">@Autowired</span><br><span class="line">private CommentService commentService;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 保存一个评论</span><br><span class="line">*&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testSaveComment()&#123;</span><br><span class="line">Comment comment&#x3D;new Comment();</span><br><span class="line">comment.setArticleid(&quot; 100000 &quot;);</span><br><span class="line">comment.setContent(&quot;测试添加的数据&quot;);</span><br><span class="line">comment.setCreatedatetime(LocalDateTime.now());</span><br><span class="line">comment.setUserid(&quot; 1003 &quot;);</span><br><span class="line">comment.setNickname(&quot;凯撒大帝&quot;);</span><br><span class="line">comment.setState(&quot; 1 &quot;);</span><br><span class="line">comment.setLikenum( 0 );</span><br><span class="line">comment.setReplynum( 0 );</span><br><span class="line">commentService.saveComment(comment);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 查询所有数据</span><br><span class="line">*&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testFindAll()&#123;</span><br><span class="line">List&lt;Comment&gt; list &#x3D; commentService.findCommentList();</span><br><span class="line">System.out.println(list);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 测试根据id查询</span><br><span class="line">*&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testFindCommentById()&#123;</span><br><span class="line">Comment comment &#x3D; commentService.findCommentById(&quot; 5 d 6 a 27 b 81 b 8 d 374798 cf 0 b 41 &quot;);</span><br><span class="line">System.out.println(comment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;根据父id，查询子评论的分页列表</span><br><span class="line">Page&lt;Comment&gt; findByParentid(String parentid, Pageable pageable);</span><br></pre></td></tr></table></figure>

<p>（ 3 ）junit测试用例：<br>cn.itcast.article.service.CommentServiceTest</p>
<h4 id="（-4-）测试"><a href="#（-4-）测试" class="headerlink" title="（ 4 ）测试"></a>（ 4 ）测试</h4><p>使用compass快速插入一条测试数据，数据的内容是对 3 号评论内容进行评论。</p>
<h4 id="执行测试，结果："><a href="#执行测试，结果：" class="headerlink" title="执行测试，结果："></a>执行测试，结果：</h4><h2 id="5-8-MongoTemplate实现评论点赞"><a href="#5-8-MongoTemplate实现评论点赞" class="headerlink" title="5.8 MongoTemplate实现评论点赞"></a>5.8 MongoTemplate实现评论点赞</h2><p>我们看一下以下点赞的临时示例代码： CommentService 新增updateThumbup方法</p>
<h4 id="以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加-1-就可以了，没必要查询出所有字段修改后再更新所有字"><a href="#以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加-1-就可以了，没必要查询出所有字段修改后再更新所有字" class="headerlink" title="以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加 1 就可以了，没必要查询出所有字段修改后再更新所有字"></a>以上方法虽然实现起来比较简单，但是执行效率并不高，因为我只需要将点赞数加 1 就可以了，没必要查询出所有字段修改后再更新所有字</h4><h4 id="段。-蝴蝶效应"><a href="#段。-蝴蝶效应" class="headerlink" title="段。(蝴蝶效应)"></a>段。(蝴蝶效应)</h4><p>我们可以使用MongoTemplate类来实现对某列的操作。 （ 1 ）修改CommentService</p>
<h4 id="-2"><a href="#-2" class="headerlink" title="/**"></a>/**</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 根据父id查询分页列表</span><br><span class="line">* @param parentid</span><br><span class="line">* @param page</span><br><span class="line">* @param size</span><br><span class="line">* @return</span><br><span class="line">*&#x2F;</span><br><span class="line">public Page&lt;Comment&gt; findCommentListPageByParentid(String parentid,int page ,int size)&#123;</span><br><span class="line">return commentRepository.findByParentid(parentid, PageRequest.of(page- 1 ,size));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="-3"><a href="#-3" class="headerlink" title="/**"></a>/**</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 测试根据父id查询子评论的分页列表</span><br><span class="line">*&#x2F;</span><br><span class="line">@Test</span><br><span class="line">public void testFindCommentListPageByParentid()&#123;</span><br><span class="line">Page&lt;Comment&gt; pageResponse &#x3D; commentService.findCommentListPageByParentid(&quot; 3 &quot;, 1 , 2 );</span><br><span class="line">System.out.println(&quot;----总记录数：&quot;+pageResponse.getTotalElements());</span><br><span class="line">System.out.println(&quot;----当前页数据：&quot;+pageResponse.getContent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="—总记录数：-1"><a href="#—总记录数：-1" class="headerlink" title="- —总记录数： 1"></a>- —总记录数： 1</h4><ul>
<li>—当前页数据：[Comment{id=’ 33 ‘, content=’你年轻，火力大’, publishtime=null, userid=’ 1003 ‘, nickname=’凯撒大帝’,<br>createdatetime=null, likenum=null, replynum=null, state=’null’, parentid=’ 3 ‘, articleid=’ 100001 ‘}]</li>
</ul>
<h4 id="-4"><a href="#-4" class="headerlink" title="/**"></a>/**</h4><h4 id="点赞-效率低"><a href="#点赞-效率低" class="headerlink" title="* 点赞-效率低"></a>* 点赞-效率低</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* @param id</span><br><span class="line">*&#x2F;</span><br><span class="line">public void updateCommentThumbupToIncrementingOld(String id)&#123;</span><br><span class="line">Comment comment &#x3D; CommentRepository.findById(id).get();</span><br><span class="line">comment.setLikenum(comment.getLikenum()+ 1 );</span><br><span class="line">CommentRepository.save(comment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;注入MongoTemplate</span><br><span class="line">@Autowired</span><br><span class="line">private MongoTemplate mongoTemplate;</span><br></pre></td></tr></table></figure>

<h4 id="（-2-）测试用例："><a href="#（-2-）测试用例：" class="headerlink" title="（ 2 ）测试用例："></a>（ 2 ）测试用例：</h4><p>cn.itcast.article.service.CommentServiceTest</p>
<h4 id="执行测试用例后，发现点赞数-1了："><a href="#执行测试用例后，发现点赞数-1了：" class="headerlink" title="执行测试用例后，发现点赞数+1了："></a>执行测试用例后，发现点赞数+1了：</h4><h4 id="-5"><a href="#-5" class="headerlink" title="/**"></a>/**</h4><h4 id="点赞数-1"><a href="#点赞数-1" class="headerlink" title="* 点赞数+ 1"></a>* 点赞数+ 1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* @param id</span><br><span class="line">*&#x2F;</span><br><span class="line">public void updateCommentLikenum(String id)&#123;</span><br><span class="line">&#x2F;&#x2F;查询对象</span><br><span class="line">Query query&#x3D;Query.query(Criteria.where(&quot;_id&quot;).is(id));</span><br><span class="line">&#x2F;&#x2F;更新对象</span><br><span class="line">Update update&#x3D;new Update();</span><br><span class="line">&#x2F;&#x2F;局部更新，相当于$set</span><br><span class="line">&#x2F;&#x2F; update.set(key,value)</span><br><span class="line">&#x2F;&#x2F;递增$inc</span><br><span class="line">&#x2F;&#x2F; update.inc(&quot;likenum&quot;, 1 );</span><br><span class="line">update.inc(&quot;likenum&quot;);</span><br><span class="line">&#x2F;&#x2F;参数 1 ：查询对象</span><br><span class="line">&#x2F;&#x2F;参数 2 ：更新对象</span><br><span class="line">&#x2F;&#x2F;参数 3 ：集合的名字或实体类的类型Comment.class</span><br><span class="line">mongoTemplate.updateFirst(query,update,&quot;comment&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="-6"><a href="#-6" class="headerlink" title="/**"></a>/**</h4><h4 id="点赞数-1-1"><a href="#点赞数-1-1" class="headerlink" title="* 点赞数+ 1"></a>* 点赞数+ 1</h4><h4 id="-7"><a href="#-7" class="headerlink" title="*/"></a>*/</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testUpdateCommentLikenum()&#123;</span><br><span class="line">&#x2F;&#x2F;对 3 号文档的点赞数+ 1</span><br><span class="line">commentService.updateCommentLikenum(&quot; 3 &quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://nlbyd1119.online/2020/06/23/mongodb/" title="mongodb" target="_blank" rel="external">http://nlbyd1119.online/2020/06/23/mongodb/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/nlby" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/nlby" target="_blank"><span class="text-dark">nlby</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    <div id="git"></div>
<link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
<script src="https://billts.site/js/gitment.js"></script>
<script>
var gitment = new Gitment({
  id: window.decodeURIComponent(window.location.pathname),
  owner: 'nlby',
  repo: 'nlbyvh.github.io',
  oauth: {
    client_id: '6d53a92df707fc123e7a',
    client_secret: '2bd9e28afe88cb142fa8fa7092c9a8c20ae25555',
  },
})
gitment.render('git')
</script>
  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2020/06/23/%E5%8D%8E%E4%B8%BA%E4%BA%91ECS%E9%85%8D%E7%BD%AE/" title="华为云ECS配置"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2020/06/23/docker/" title="docker"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	

    <div class="copyright">
    	
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
<script src="//cdn.jsdelivr.net/npm/gitment@0.0.3/dist/gitment.browser.min.js"></script>
<script>
var gitment = new Gitment({
  // id默认为当前页面url，如果url后带参数或锚点，gitment要重新初始化
  // https://github.com/imsun/gitment/issues/55
  // 解决方案：id:window.location.pathname,或者将id设置为当前页面标题
  id: 'mongodb', 
  owner: 'nlby', // 可以是你的GitHub用户名，也可以是github id
  repo: 'nlbyvh.github.io',
  oauth: {
    client_id: '6d53a92df707fc123e7a',
    client_secret: '2bd9e28afe88cb142fa8fa7092c9a8c20ae25555',
  }
})
gitment.render('comments')
</script>









<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/violet.model.json"},"display":{"position":"left","width":180,"height":360},"mobile":{"show":true},"log":false});</script></body>
</html>