<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>go-study-5 | Memory</title>
  <meta name="description" content="Go基础学习其五">
<meta property="og:type" content="article">
<meta property="og:title" content="go-study-5">
<meta property="og:url" content="http://nlbyd1119.online/2020/07/02/go-study-5/index.html">
<meta property="og:site_name" content="Memory">
<meta property="og:description" content="Go基础学习其五">
<meta property="og:locale" content="zh">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/fileyunxing1.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/copyfile.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/20190316084535903.jpg">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190702-124039.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190702-124719.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190703-155441.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190703-155739.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190703-155821.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190704-113648.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190704-122357.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190704-172759.png">
<meta property="og:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/WX20190720-210316.png">
<meta property="article:published_time" content="2020-07-02T15:38:16.000Z">
<meta property="article:modified_time" content="2020-07-14T02:35:32.807Z">
<meta property="article:author" content="nlby">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://nlbyd1119.online/2020/07/02/go-study-5/img/fileyunxing1.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://nlbyd1119.online/2020/07/02/go-study-5/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Memory" type="application/atom+xml">
  
  
    <link rel="icon" href="https://i.loli.net/2020/09/12/4y1TBOItE9w8WFq.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitment@0.0.3/style/default.min.css">
  
  
  
<meta name="generator" content="Hexo 4.2.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/nlby" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">nlby</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> NanJing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
      </ul>
      
	

	  <embed src="https://jxiaoc.github.io/animeMusic/demo.html" width="100%"/>
	  <iframe frameborder="no" border="0" marginwidth="0"
						marginheight="0" width="100%" height=86 src="//music.163.com/outchain/player?type=0&id=4872500795&auto=0&height=66">
	  </iframe>
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>记录和总结一下学习过程及其他</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/2005/">2005</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2006/">2006</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2007/">2007</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2008/">2008</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2009/">2009</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2011/">2011</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2012/">2012</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2013/">2013</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2014/">2014</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2017/">2017</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/70/">70</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/80/">80</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flask/">Flask</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JSP/">JSP</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NoSql/">NoSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ORM/">ORM</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%A1%86%E6%9E%B6/">Web框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fabric/">fabric</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live2d/">live2d</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/numpy/">numpy</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pandas/">pandas</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/plot/">plot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%A8%E9%83%A8%E6%88%90%E4%B8%BAF/">全部成为F</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%99%E6%B3%95/">写法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%9F%E8%83%BD%E7%82%B9%E5%AD%A6%E4%B9%A0/">功能点学习</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%85%A8/">安全</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%B9%E5%99%A8/">容器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8E%A7%E5%88%B6%E5%99%A8/">控制器</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">数据可视化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E5%BF%97/">日志</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8/">框架使用</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A6%82%E5%BF%B5/">概念</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A8%A1%E6%9D%BF/">模板</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7/">版本控制工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8C%AB%E8%85%BB/">猫腻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83/">环境</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">环境配置</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/">知识点总结</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A1%AC%E4%BB%B6/">硬件</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%BB%E5%8A%A8%E5%B8%83%E5%B1%80/">移动布局</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%B0%E5%BD%95/">记录</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BA%E6%96%87/">论文</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/" rel="tag">Go</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a><span class="tag-list-count">40</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python-Science/" rel="tag">Python Science</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PythonWeb/" rel="tag">PythonWeb</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%93%E4%B8%9A%E8%AF%BE/" rel="tag">专业课</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6/" rel="tag">博客框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A3%B0%E4%BC%98%E8%AE%B0%E5%BD%95/" rel="tag">声优记录</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E8%AF%B4%E6%95%B4%E7%90%86/" rel="tag">小说整理</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%88%E6%9E%9C/" rel="tag">效果</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" rel="tag">版本控制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%95%AA%E5%89%A7%E8%AE%B0%E5%BD%95/" rel="tag">番剧记录</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%9A%E7%94%A8/" rel="tag">通用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a><span class="tag-list-count">10</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Go/" style="font-size: 13.5px;">Go</a> <a href="/tags/JavaWeb/" style="font-size: 14px;">JavaWeb</a> <a href="/tags/Python-Science/" style="font-size: 13.6px;">Python Science</a> <a href="/tags/PythonWeb/" style="font-size: 13.3px;">PythonWeb</a> <a href="/tags/android/" style="font-size: 13.8px;">android</a> <a href="/tags/sql/" style="font-size: 13px;">sql</a> <a href="/tags/%E4%B8%93%E4%B8%9A%E8%AF%BE/" style="font-size: 13px;">专业课</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 13.2px;">前端</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 13.4px;">区块链</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6/" style="font-size: 13px;">博客框架</a> <a href="/tags/%E5%A3%B0%E4%BC%98%E8%AE%B0%E5%BD%95/" style="font-size: 13.1px;">声优记录</a> <a href="/tags/%E5%B0%8F%E8%AF%B4%E6%95%B4%E7%90%86/" style="font-size: 13.1px;">小说整理</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.3px;">总结</a> <a href="/tags/%E6%95%88%E6%9E%9C/" style="font-size: 13px;">效果</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 13px;">机器学习</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 13px;">正则表达式</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 13px;">版本控制</a> <a href="/tags/%E7%95%AA%E5%89%A7%E8%AE%B0%E5%BD%95/" style="font-size: 13.9px;">番剧记录</a> <a href="/tags/%E9%80%9A%E7%94%A8/" style="font-size: 13px;">通用</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 13.7px;">随笔</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">51</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">25</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">13</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/18/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%92%8Csolidity%E5%A4%8D%E4%B9%A0%E5%85%B6%E4%BA%8C/" class="title">以太坊和solidity复习其二</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-18T06:18:39.000Z" itemprop="datePublished">2020-10-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/">知识点总结</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/14/8086%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F/" class="title">8086指令系统</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-14T12:12:48.000Z" itemprop="datePublished">2020-10-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/13/go-http/" class="title">go http</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-13T08:28:32.000Z" itemprop="datePublished">2020-10-13</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/12/security%E6%B5%8B%E8%AF%95/" class="title">security测试</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-12T14:12:14.000Z" itemprop="datePublished">2020-10-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/80/">80</a>
              </p>
              <p class="item-title">
                <a href="/2020/10/11/%E5%9D%82%E6%9C%AC%E7%9C%9F%E7%BB%AB/" class="title">坂本真绫</a>
              </p>
              <p class="item-date">
                <time datetime="2020-10-11T13:05:10.000Z" itemprop="datePublished">2020-10-11</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
	<!------ 位置可自定义 ------>
<div class="Canvas" style="position: fixed; right: 0px; bottom: 0px;z-index: 99999999" id="L2dCanvas"></div>

<!------ 依赖 JS | Dependent JS ------>
<!---- 可选 | Optional ---->
<!-- 兼容低版本浏览器 | Compatible with low-level browsers -->
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"> </script>
<!-- 音频播放兼容 | Audio playback compatible -->
<script src="https://cdn.jsdelivr.net/npm/howler@2.1.3/dist/howler.min.js"></script>
<!---- 必需 | Required ---->
<script src="https://cdn.jsdelivr.net/gh/nlby/live2dCDN@1.0.2/static/live2dcubismcore.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pixi.js@4.6.1/dist/pixi.min.js"></script>
<!-- live2dv3.js -->
<script src="https://cdn.jsdelivr.net/gh/nlby/live2dCDN@1.0.2/static/live2dv3.js"></script>

<!------ 加载Live2d模型 | Load Live2d model ------>	
<script>
    window.onload = () => {
        new l2dViewer({
             el: document.getElementById('L2dCanvas'),
                basePath: 'https://cdn.jsdelivr.net/gh/nlby/live2dCDN@1.1.1/assets/', // 模型根目录
                modelName: 'xuefeng_3', // 模型目录
                sizeLimit: false,
                mobileLimit: false
            
            
        })
    }
</script>
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-go-study-5" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      go-study-5
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2020/07/02/go-study-5/" class="article-date">
	  <time datetime="2020-07-02T15:38:16.000Z" itemprop="datePublished">2020-07-02</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link" href="/tags/Go/" rel="tag">Go</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/07/02/go-study-5/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p><strong>Go基础学习其五</strong></p>
<a id="more"></a>
<p>2020.6.30-7.1 学习了go的time包和文件操作相关的内容。</p>
<p><strong>笔记</strong></p>
<h1 id="time包"><a href="#time包" class="headerlink" title="time包"></a>time包</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	time包：</span></span><br><span class="line"><span class="comment">		1年=365天，day</span></span><br><span class="line"><span class="comment">		1天=24小时，hour</span></span><br><span class="line"><span class="comment">		1小时=60分钟，minute</span></span><br><span class="line"><span class="comment">		1分钟=60秒，second</span></span><br><span class="line"><span class="comment">		1秒钟=1000毫秒，millisecond</span></span><br><span class="line"><span class="comment">		1毫秒=1000微秒，microsecond--&gt;μs</span></span><br><span class="line"><span class="comment">		1微秒=1000纳秒，nanosecond--&gt;ns</span></span><br><span class="line"><span class="comment">		1纳秒=1000皮秒，picosecond--&gt;ps</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//1.获取当前的时间</span></span><br><span class="line">	 t1 := time.Now()</span><br><span class="line">	 fmt.Printf(<span class="string">"%T\n"</span>,t1)</span><br><span class="line">	 fmt.Println(t1) <span class="comment">//2019-06-26 10:46:40.349196 +0800 CST m=+0.000495846</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//2.获取指定的时间</span></span><br><span class="line">	 t2 := time.Date(<span class="number">2008</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">30</span>,<span class="number">28</span>,<span class="number">0</span>,time.Local)</span><br><span class="line">	 fmt.Println(t2) <span class="comment">//2008-07-15 16:30:28 +0800 CST</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//3.time--&gt;string之间的转换</span></span><br><span class="line">	 <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 t1.Format("格式模板")--&gt;string</span></span><br><span class="line"><span class="comment">	 	模板的日期必须是固定：06-1-2-3-4-5</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">	 s1 := t1.Format(<span class="string">"2006-1-2 15:04:05"</span>)</span><br><span class="line">	 fmt.Println(s1)</span><br><span class="line"></span><br><span class="line">	 s2 := t1.Format(<span class="string">"2006/01/02"</span>)</span><br><span class="line">	 fmt.Println(s2)</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//string--&gt;time</span></span><br><span class="line">	 <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 time.Parse("模板",str)--&gt;time,err</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">	 s3 := <span class="string">"1999年10月10日"</span><span class="comment">//string</span></span><br><span class="line">	 t3 ,err := time.Parse(<span class="string">"2006年01月02日"</span>,s3)</span><br><span class="line">	 <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">	 	fmt.Println(<span class="string">"err:"</span>,err)</span><br><span class="line">	 &#125;</span><br><span class="line">	 fmt.Println(t3)</span><br><span class="line">	 fmt.Printf(<span class="string">"%T\n"</span>,t3)</span><br><span class="line"></span><br><span class="line">	 fmt.Println(t1.String())</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//4.根据当前时间，获取指定的内容</span></span><br><span class="line">	year,month,day :=  t1.Date() <span class="comment">//年，月，日</span></span><br><span class="line">	fmt.Println(year,month,day)</span><br><span class="line"></span><br><span class="line">	hour,min,sec := t1.Clock()</span><br><span class="line">	fmt.Println(hour,min,sec) <span class="comment">//时，分，秒</span></span><br><span class="line"></span><br><span class="line">	year2 := t1.Year()</span><br><span class="line">	fmt.Println(<span class="string">"年："</span>,year2)</span><br><span class="line">	fmt.Println(t1.YearDay())</span><br><span class="line"></span><br><span class="line">	month2 := t1.Month()</span><br><span class="line">	fmt.Println(<span class="string">"月："</span>,month2)</span><br><span class="line">	fmt.Println(<span class="string">"日："</span>,t1.Day())</span><br><span class="line">	fmt.Println(<span class="string">"时："</span>,t1.Hour())</span><br><span class="line">	fmt.Println(<span class="string">"分钟："</span>,t1.Minute())</span><br><span class="line">	fmt.Println(<span class="string">"秒："</span>,t1.Second())</span><br><span class="line">	fmt.Println(<span class="string">"纳秒："</span>,t1.Nanosecond())</span><br><span class="line"></span><br><span class="line">	fmt.Println(t1.Weekday()) <span class="comment">//Wednesday</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//5.时间戳：指定的日期，距离1970年1月1日0点0时0分0秒的时间差值：秒，纳秒</span></span><br><span class="line"></span><br><span class="line">	t4 := time.Date(<span class="number">1970</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,time.UTC)</span><br><span class="line">	timeStamp1:=t4.Unix() <span class="comment">//秒的差值</span></span><br><span class="line">	fmt.Println(timeStamp1)</span><br><span class="line">	timeStamp2 := t1.Unix()</span><br><span class="line">	fmt.Println(timeStamp2)</span><br><span class="line"></span><br><span class="line">	timeStamp3 := t4.UnixNano()</span><br><span class="line">	fmt.Println(timeStamp3) <span class="comment">//3600 000 000 000</span></span><br><span class="line">	timeStamp4 := t1.UnixNano()</span><br><span class="line">	fmt.Println(timeStamp4)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//6.时间间隔</span></span><br><span class="line">	t5 := t1.Add(time.Minute)</span><br><span class="line">	fmt.Println(t1)</span><br><span class="line">	fmt.Println(t5)</span><br><span class="line">	fmt.Println(t1.Add(<span class="number">24</span> * time.Hour))</span><br><span class="line"></span><br><span class="line">	t6 := t1.AddDate(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">	fmt.Println(t6)</span><br><span class="line"></span><br><span class="line">	d1 := t5.Sub(t1)</span><br><span class="line">	fmt.Println(d1)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//7.睡眠</span></span><br><span class="line">	time.Sleep(<span class="number">3</span> *time.Second) <span class="comment">//让当前的程序进入睡眠状态</span></span><br><span class="line">	fmt.Println(<span class="string">"main。。。over。。。。。"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//睡眠[1-10]的随机秒数</span></span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	randNum := rand.Intn(<span class="number">10</span>) + <span class="number">1</span> <span class="comment">//int</span></span><br><span class="line">	fmt.Println(randNum)</span><br><span class="line">	time.Sleep(time.Duration(randNum)*time.Second)</span><br><span class="line">	fmt.Println(<span class="string">"睡醒了。。"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="一、File文件操作"><a href="#一、File文件操作" class="headerlink" title="一、File文件操作"></a>一、File文件操作</h1><p>首先，file类是在os包中的，封装了底层的文件描述符和相关信息，同时封装了Read和Write的实现。</p>
<h2 id="1、FileInfo接口"><a href="#1、FileInfo接口" class="headerlink" title="1、FileInfo接口"></a>1、FileInfo接口</h2><p>FileInfo接口中定义了File信息相关的方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> FileInfo <span class="keyword">interface</span> &#123;</span><br><span class="line">	Name() <span class="keyword">string</span>       <span class="comment">// base name of the file 文件名.扩展名 aa.txt</span></span><br><span class="line">	Size() <span class="keyword">int64</span>        <span class="comment">// 文件大小，字节数 12540</span></span><br><span class="line">	Mode() FileMode     <span class="comment">// 文件权限 -rw-rw-rw-</span></span><br><span class="line">	ModTime() time.Time <span class="comment">// 修改时间 2018-04-13 16:30:53 +0800 CST</span></span><br><span class="line">	IsDir() <span class="keyword">bool</span>        <span class="comment">// 是否文件夹</span></span><br><span class="line">	Sys() <span class="keyword">interface</span>&#123;&#125;   <span class="comment">// 基础数据源接口(can return nil)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2、权限"><a href="#2、权限" class="headerlink" title="2、权限"></a>2、权限</h2><p>至于操作权限perm，除非创建文件时才需要指定，不需要创建新文件时可以将其设定为０。虽然go语言给perm权限设定了很多的常量，但是习惯上也可以直接使用数字，如0666(具体含义和Unix系统的一致)。</p>
<p>权限控制：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">linux 下有<span class="number">2</span>种文件权限表示方式，即“符号表示”和“八进制表示”。</span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）符号表示方式:</span><br><span class="line">-      ---         ---        ---</span><br><span class="line"><span class="keyword">type</span>   owner       group      others</span><br><span class="line">文件的权限是这样子分配的 读 写 可执行 分别对应的是 r w x 如果没有那一个权限，用 - 代替</span><br><span class="line">(-文件 d目录 |连接符号)</span><br><span class="line">例如：-rwxr-xr-x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）八进制表示方式：	</span><br><span class="line">r ——&gt; <span class="number">004</span></span><br><span class="line">w ——&gt; <span class="number">002</span></span><br><span class="line">x ——&gt; <span class="number">001</span></span><br><span class="line">- ——&gt; <span class="number">000</span></span><br><span class="line"></span><br><span class="line"><span class="number">0755</span></span><br><span class="line"><span class="number">0777</span></span><br><span class="line"><span class="number">0555</span></span><br><span class="line"><span class="number">0444</span></span><br><span class="line"><span class="number">0666</span></span><br></pre></td></tr></table></figure>



<h2 id="3、打开模式"><a href="#3、打开模式" class="headerlink" title="3、打开模式"></a>3、打开模式</h2><p>文件打开模式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    O_RDONLY <span class="keyword">int</span> = syscall.O_RDONLY <span class="comment">// 只读模式打开文件</span></span><br><span class="line">    O_WRONLY <span class="keyword">int</span> = syscall.O_WRONLY <span class="comment">// 只写模式打开文件</span></span><br><span class="line">    O_RDWR   <span class="keyword">int</span> = syscall.O_RDWR   <span class="comment">// 读写模式打开文件</span></span><br><span class="line">    O_APPEND <span class="keyword">int</span> = syscall.O_APPEND <span class="comment">// 写操作时将数据附加到文件尾部</span></span><br><span class="line">    O_CREATE <span class="keyword">int</span> = syscall.O_CREAT  <span class="comment">// 如果不存在将创建一个新文件</span></span><br><span class="line">    O_EXCL   <span class="keyword">int</span> = syscall.O_EXCL   <span class="comment">// 和O_CREATE配合使用，文件必须不存在</span></span><br><span class="line">    O_SYNC   <span class="keyword">int</span> = syscall.O_SYNC   <span class="comment">// 打开文件用于同步I/O</span></span><br><span class="line">    O_TRUNC  <span class="keyword">int</span> = syscall.O_TRUNC  <span class="comment">// 如果可能，打开时清空文件</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="4、File操作"><a href="#4、File操作" class="headerlink" title="4、File操作"></a>4、File操作</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> File</span><br><span class="line"><span class="comment">//File代表一个打开的文件对象。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Create</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="params">(file *File, err error)</span></span></span><br><span class="line"><span class="comment">//Create采用模式0666（任何人都可读写，不可执行）创建一个名为name的文件，如果文件已存在会截断它（为空文件）。如果成功，返回的文件对象可用于I/O；对应的文件描述符具有O_RDWR模式。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="params">(file *File, err error)</span></span></span><br><span class="line"><span class="comment">//Open打开一个文件用于读取。如果操作成功，返回的文件对象的方法可用于读取数据；对应的文件描述符具有O_RDONLY模式。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OpenFile</span><span class="params">(name <span class="keyword">string</span>, flag <span class="keyword">int</span>, perm FileMode)</span> <span class="params">(file *File, err error)</span></span></span><br><span class="line"><span class="comment">//OpenFile是一个更一般性的文件打开函数，大多数调用者都应用Open或Create代替本函数。它会使用指定的选项（如O_RDONLY等）、指定的模式（如0666等）打开指定名称的文件。如果操作成功，返回的文件对象可用于I/O。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewFile</span><span class="params">(fd <span class="keyword">uintptr</span>, name <span class="keyword">string</span>)</span> *<span class="title">File</span></span></span><br><span class="line"><span class="comment">//NewFile使用给出的Unix文件描述符和名称创建一个文件。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pipe</span><span class="params">()</span> <span class="params">(r *File, w *File, err error)</span></span></span><br><span class="line"><span class="comment">//Pipe返回一对关联的文件对象。从r的读取将返回写入w的数据。本函数会返回两个文件对象和可能的错误。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span></span><br><span class="line"><span class="comment">//Name方法返回（提供给Open/Create等方法的）文件名称。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Stat</span><span class="params">()</span> <span class="params">(fi FileInfo, err error)</span></span></span><br><span class="line"><span class="comment">//Stat返回描述文件f的FileInfo类型值。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Fd</span><span class="params">()</span> <span class="title">uintptr</span></span></span><br><span class="line"><span class="comment">//Fd返回与文件f对应的整数类型的Unix文件描述符。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Chdir</span><span class="params">()</span> <span class="title">error</span></span></span><br><span class="line"><span class="comment">//Chdir将当前工作目录修改为f，f必须是一个目录。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Chmod</span><span class="params">(mode FileMode)</span> <span class="title">error</span></span></span><br><span class="line"><span class="comment">//Chmod修改文件的模式。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Chown</span><span class="params">(uid, gid <span class="keyword">int</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="comment">//Chown修改文件的用户ID和组ID。如果出错，错误底层类型是*PathError。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Close</span><span class="params">()</span> <span class="title">error</span></span></span><br><span class="line"><span class="comment">//Close关闭文件f，使文件不能用于读写。它返回可能出现的错误。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Readdir</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">(fi []FileInfo, err error)</span></span></span><br><span class="line"><span class="comment">//Readdir读取目录f的内容，返回一个有n个成员的[]FileInfo，这些FileInfo是被Lstat返回的，采用目录顺序。对本函数的下一次调用会返回上一次调用剩余未读取的内容的信息。如果n&gt;0，Readdir函数会返回一个最多n个成员的切片。这时，如果Readdir返回一个空切片，它会返回一个非nil的错误说明原因。如果到达了目录f的结尾，返回值err会是io.EOF。如果n&lt;=0，Readdir函数返回目录中剩余所有文件对象的FileInfo构成的切片。此时，如果Readdir调用成功（读取所有内容直到结尾），它会返回该切片和nil的错误值。如果在到达结尾前遇到错误，会返回之前成功读取的FileInfo构成的切片和该错误。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Readdirnames</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">(names []<span class="keyword">string</span>, err error)</span></span></span><br><span class="line"><span class="comment">//Readdir读取目录f的内容，返回一个有n个成员的[]string，切片成员为目录中文件对象的名字，采用目录顺序。对本函数的下一次调用会返回上一次调用剩余未读取的内容的信息。如果n&gt;0，Readdir函数会返回一个最多n个成员的切片。这时，如果Readdir返回一个空切片，它会返回一个非nil的错误说明原因。如果到达了目录f的结尾，返回值err会是io.EOF。如果n&lt;=0，Readdir函数返回目录中剩余所有文件对象的名字构成的切片。此时，如果Readdir调用成功（读取所有内容直到结尾），它会返回该切片和nil的错误值。如果在到达结尾前遇到错误，会返回之前成功读取的名字构成的切片和该错误。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Truncate</span><span class="params">(size <span class="keyword">int64</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="comment">//Truncate改变文件的大小，它不会改变I/O的当前位置。 如果截断文件，多出的部分就会被丢弃。如果出错，错误底层类型是*PathError。</span></span><br></pre></td></tr></table></figure>



<h2 id="5、示例代码"><a href="#5、示例代码" class="headerlink" title="5、示例代码"></a>5、示例代码</h2><p>文件信息：FileInfo</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	FileInfo：文件信息</span></span><br><span class="line"><span class="comment">		interface</span></span><br><span class="line"><span class="comment">			Name()，文件名</span></span><br><span class="line"><span class="comment">			Size()，文件大小，字节为单位</span></span><br><span class="line"><span class="comment">			IsDir()，是否是目录</span></span><br><span class="line"><span class="comment">			ModTime()，修改时间</span></span><br><span class="line"><span class="comment">			Mode()，权限</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	fileInfo,err :=  os.Stat(<span class="string">"/Users/ruby/Documents/pro/a/aa.txt"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		fmt.Println(<span class="string">"err :"</span>,err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"%T\n"</span>,fileInfo)</span><br><span class="line">	<span class="comment">//文件名</span></span><br><span class="line">	fmt.Println(fileInfo.Name())</span><br><span class="line">	<span class="comment">//文件大小</span></span><br><span class="line">	fmt.Println(fileInfo.Size())</span><br><span class="line">	<span class="comment">//是否是目录</span></span><br><span class="line">	fmt.Println(fileInfo.IsDir()) <span class="comment">//IsDirectory</span></span><br><span class="line">	<span class="comment">//修改时间</span></span><br><span class="line">	fmt.Println(fileInfo.ModTime())</span><br><span class="line">	<span class="comment">//权限</span></span><br><span class="line">	fmt.Println(fileInfo.Mode()) <span class="comment">//-rw-r--r--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行结果：</p>
<p><img src="img/fileyunxing1.png" alt="fileyunxing1"></p>
<p>文件操作实例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"path/filepath"</span></span><br><span class="line">	<span class="string">"path"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	文件操作：</span></span><br><span class="line"><span class="comment">	1.路径：</span></span><br><span class="line"><span class="comment">		相对路径：relative</span></span><br><span class="line"><span class="comment">			ab.txt</span></span><br><span class="line"><span class="comment">			相对于当前工程</span></span><br><span class="line"><span class="comment">		绝对路径：absolute</span></span><br><span class="line"><span class="comment">			/Users/ruby/Documents/pro/a/aa.txt</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		.当前目录</span></span><br><span class="line"><span class="comment">		..上一层</span></span><br><span class="line"><span class="comment">	2.创建文件夹，如果文件夹存在，创建失败</span></span><br><span class="line"><span class="comment">		os.MkDir()，创建一层</span></span><br><span class="line"><span class="comment">		os.MkDirAll()，可以创建多层</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	3.创建文件，Create采用模式0666（任何人都可读写，不可执行）创建一个名为name的文件，如果文件已存在会截断它（为空文件）</span></span><br><span class="line"><span class="comment">		os.Create()，创建文件</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	4.打开文件：让当前的程序，和指定的文件之间建立一个连接</span></span><br><span class="line"><span class="comment">		os.Open(filename)</span></span><br><span class="line"><span class="comment">		os.OpenFile(filename,mode,perm)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	5.关闭文件：程序和文件之间的链接断开。</span></span><br><span class="line"><span class="comment">		file.Close()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	5.删除文件或目录：慎用，慎用，再慎用</span></span><br><span class="line"><span class="comment">		os.Remove()，删除文件和空目录</span></span><br><span class="line"><span class="comment">		os.RemoveAll()，删除所有</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 <span class="comment">//1.路径</span></span><br><span class="line">	 fileName1:=<span class="string">"/Users/ruby/Documents/pro/a/aa.txt"</span></span><br><span class="line">	 fileName2:=<span class="string">"bb.txt"</span></span><br><span class="line">	 fmt.Println(filepath.IsAbs(fileName1)) <span class="comment">//true</span></span><br><span class="line">	 fmt.Println(filepath.IsAbs(fileName2)) <span class="comment">//false</span></span><br><span class="line">	 fmt.Println(filepath.Abs(fileName1))</span><br><span class="line">	 fmt.Println(filepath.Abs(fileName2)) <span class="comment">// /Users/ruby/go/src/l_file/bb.txt</span></span><br><span class="line"></span><br><span class="line">	 fmt.Println(<span class="string">"获取父目录："</span>,path.Join(fileName1,<span class="string">".."</span>))</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//2.创建目录</span></span><br><span class="line">	 <span class="comment">//err := os.Mkdir("/Users/ruby/Documents/pro/a/bb",os.ModePerm)</span></span><br><span class="line">	 <span class="comment">//if err != nil&#123;</span></span><br><span class="line">	 <span class="comment">//	fmt.Println("err:",err)</span></span><br><span class="line">	 <span class="comment">//	return</span></span><br><span class="line">	 <span class="comment">//&#125;</span></span><br><span class="line">	 <span class="comment">//fmt.Println("文件夹创建成功。。")</span></span><br><span class="line">	 <span class="comment">//err :=os.MkdirAll("/Users/ruby/Documents/pro/a/cc/dd/ee",os.ModePerm)</span></span><br><span class="line">	 <span class="comment">//if err != nil&#123;</span></span><br><span class="line">	 <span class="comment">//	fmt.Println("err:",err)</span></span><br><span class="line">	 <span class="comment">//	return</span></span><br><span class="line">	 <span class="comment">//&#125;</span></span><br><span class="line">	 <span class="comment">//fmt.Println("多层文件夹创建成功")</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//3.创建文件:Create采用模式0666（任何人都可读写，不可执行）创建一个名为name的文件，如果文件已存在会截断它（为空文件）</span></span><br><span class="line">	 <span class="comment">//file1,err :=os.Create("/Users/ruby/Documents/pro/a/ab.txt")</span></span><br><span class="line">	 <span class="comment">//if err != nil&#123;</span></span><br><span class="line">	 <span class="comment">//	fmt.Println("err：",err)</span></span><br><span class="line">	 <span class="comment">//	return</span></span><br><span class="line">	 <span class="comment">//&#125;</span></span><br><span class="line">	 <span class="comment">//fmt.Println(file1)</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//file2,err := os.Create(fileName2)//创建相对路径的文件，是以当前工程为参照的</span></span><br><span class="line">	 <span class="comment">//if err != nil&#123;</span></span><br><span class="line">	 <span class="comment">//	fmt.Println("err :",err)</span></span><br><span class="line">	 <span class="comment">//	return</span></span><br><span class="line">	 <span class="comment">//&#125;</span></span><br><span class="line">	 <span class="comment">//fmt.Println(file2)</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//4.打开文件：</span></span><br><span class="line">	 <span class="comment">//file3 ,err := os.Open(fileName1) //只读的</span></span><br><span class="line">	 <span class="comment">//if err != nil&#123;</span></span><br><span class="line">	 <span class="comment">//	fmt.Println("err:",err)</span></span><br><span class="line">	 <span class="comment">//	return</span></span><br><span class="line">	 <span class="comment">//&#125;</span></span><br><span class="line">	 <span class="comment">//fmt.Println(file3)</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	第一个参数：文件名称</span></span><br><span class="line"><span class="comment">	第二个参数：文件的打开方式</span></span><br><span class="line"><span class="comment">		const (</span></span><br><span class="line"><span class="comment">	// Exactly one of O_RDONLY, O_WRONLY, or O_RDWR must be specified.</span></span><br><span class="line"><span class="comment">		O_RDONLY int = syscall.O_RDONLY // open the file read-only.</span></span><br><span class="line"><span class="comment">		O_WRONLY int = syscall.O_WRONLY // open the file write-only.</span></span><br><span class="line"><span class="comment">		O_RDWR   int = syscall.O_RDWR   // open the file read-write.</span></span><br><span class="line"><span class="comment">		// The remaining values may be or'ed in to control behavior.</span></span><br><span class="line"><span class="comment">		O_APPEND int = syscall.O_APPEND // append data to the file when writing.</span></span><br><span class="line"><span class="comment">		O_CREATE int = syscall.O_CREAT  // create a new file if none exists.</span></span><br><span class="line"><span class="comment">		O_EXCL   int = syscall.O_EXCL   // used with O_CREATE, file must not exist.</span></span><br><span class="line"><span class="comment">		O_SYNC   int = syscall.O_SYNC   // open for synchronous I/O.</span></span><br><span class="line"><span class="comment">		O_TRUNC  int = syscall.O_TRUNC  // truncate regular writable file when opened.</span></span><br><span class="line"><span class="comment">	)</span></span><br><span class="line"><span class="comment">	第三个参数：文件的权限：文件不存在创建文件，需要指定权限</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 <span class="comment">//file4,err := os.OpenFile(fileName1,os.O_RDONLY|os.O_WRONLY,os.ModePerm)</span></span><br><span class="line">	 <span class="comment">//if err != nil&#123;</span></span><br><span class="line">	 <span class="comment">//	fmt.Println("err:",err)</span></span><br><span class="line">	 <span class="comment">//	return</span></span><br><span class="line">	 <span class="comment">//&#125;</span></span><br><span class="line">	 <span class="comment">//fmt.Println(file4)</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//5关闭文件，</span></span><br><span class="line">	 <span class="comment">//file4.Close()</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//6.删除文件或文件夹：</span></span><br><span class="line">	 <span class="comment">//删除文件</span></span><br><span class="line">	<span class="comment">//err :=  os.Remove("/Users/ruby/Documents/pro/a/aa.txt")</span></span><br><span class="line">	<span class="comment">//if err != nil&#123;</span></span><br><span class="line">	<span class="comment">//	fmt.Println("err:",err)</span></span><br><span class="line">	<span class="comment">//	return</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">//fmt.Println("删除文件成功。。")</span></span><br><span class="line">	<span class="comment">//删除目录</span></span><br><span class="line">	err :=  os.RemoveAll(<span class="string">"/Users/ruby/Documents/pro/a/cc"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		fmt.Println(<span class="string">"err:"</span>,err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">"删除目录成功。。"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="二、I-O操作"><a href="#二、I-O操作" class="headerlink" title="二、I/O操作"></a>二、I/O操作</h1><p>I/O操作也叫输入输出操作。其中I是指Input，O是指Output，用于读或者写数据的，有些语言中也叫流操作，是指数据通信的通道。</p>
<p>Golang 标准库对 IO 的抽象非常精巧，各个组件可以随意组合，可以作为接口设计的典范。</p>
<h2 id="1、io包"><a href="#1、io包" class="headerlink" title="1、io包"></a>1、io包</h2><p>io包中提供I/O原始操作的一系列接口。它主要包装了一些已有的实现，如 os 包中的那些，并将这些抽象成为实用性的功能和一些其他相关的接口。</p>
<p>由于这些接口和原始的操作以不同的实现包装了低级操作，客户不应假定它们对于并行执行是安全的。</p>
<p>在io包中最重要的是两个接口：Reader和Writer接口，首先来介绍这两个接口．</p>
<p>Reader接口的定义，Read()方法用于读取数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">        Read(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Read 将 len(p) 个字节读取到 p 中。它返回读取的字节数 n（0 &lt;&#x3D; n &lt;&#x3D; len(p)）以及任何遇到的错误。即使 Read 返回的 n &lt; len(p)，它也会在调用过程中使用 p的全部作为暂存空间。若一些数据可用但不到 len(p) 个字节，Read 会照例返回可用的东西，而不是等待更多。</span><br><span class="line"></span><br><span class="line">当 Read 在成功读取 n &gt; 0 个字节后遇到一个错误或 EOF 情况，它就会返回读取的字节数。它会从相同的调用中返回（非nil的）错误或从随后的调用中返回错误（和 n &#x3D;&#x3D; 0）。这种一般情况的一个例子就是 Reader 在输入流结束时会返回一个非零的字节数，可能的返回不是 err &#x3D;&#x3D; EOF 就是 err &#x3D;&#x3D; nil。无论如何，下一个 Read 都应当返回 0, EOF。</span><br><span class="line"></span><br><span class="line">调用者应当总在考虑到错误 err 前处理 n &gt; 0 的字节。这样做可以在读取一些字节，以及允许的 EOF 行为后正确地处理I&#x2F;O错误。</span><br><span class="line"></span><br><span class="line">Read 的实现会阻止返回零字节的计数和一个 nil 错误，调用者应将这种情况视作空操作。</span><br></pre></td></tr></table></figure>





<p>Writer接口的定义，Write()方法用于写出数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">        Write(p []<span class="keyword">byte</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Write 将 len(p) 个字节从 p 中写入到基本数据流中。它返回从 p 中被写入的字节数n（0 &lt;&#x3D; n &lt;&#x3D; len(p)）以及任何遇到的引起写入提前停止的错误。若 Write 返回的n &lt; len(p)，它就必须返回一个非nil的错误。Write 不能修改此切片的数据，即便它是临时的。</span><br></pre></td></tr></table></figure>



<p>Seeker接口的定义，封装了基本的 Seek 方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Seeker <span class="keyword">interface</span> &#123;</span><br><span class="line">        Seek(offset <span class="keyword">int64</span>, whence <span class="keyword">int</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Seeker 用来移动数据的读写指针</span><br><span class="line">Seek 设置下一次读写操作的指针位置，每次的读写操作都是从指针位置开始的</span><br><span class="line">whence 的含义：</span><br><span class="line">	如果 whence 为 0：表示从数据的开头开始移动指针</span><br><span class="line">	如果 whence 为 1：表示从数据的当前指针位置开始移动指针</span><br><span class="line">	如果 whence 为 2：表示从数据的尾部开始移动指针</span><br><span class="line">offset 是指针移动的偏移量</span><br><span class="line">	返回移动后的指针位置和移动过程中遇到的任何错误</span><br></pre></td></tr></table></figure>



<p> ReaderFrom接口的定义，封装了基本的 ReadFrom 方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReaderFrom <span class="keyword">interface</span> &#123;</span><br><span class="line">        ReadFrom(r Reader) (n <span class="keyword">int64</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReadFrom 从 r 中读取数据到对象的数据流中</span><br><span class="line">	直到 r 返回 EOF 或 r 出现读取错误为止</span><br><span class="line">	返回值 n 是读取的字节数</span><br><span class="line">	返回值 err 就是 r 的返回值 err</span><br></pre></td></tr></table></figure>



<p>WriterTo接口的定义，封装了基本的 WriteTo 方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> WriterTo <span class="keyword">interface</span> &#123;</span><br><span class="line">        WriteTo(w Writer) (n <span class="keyword">int64</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WriterTo 将对象的数据流写入到 w 中</span><br><span class="line">	直到对象的数据流全部写入完毕或遇到写入错误为止</span><br><span class="line">	返回值 n 是写入的字节数</span><br><span class="line">	返回值 err 就是 w 的返回值 err</span><br></pre></td></tr></table></figure>



<p>定义ReaderAt接口，ReaderAt 接口封装了基本的 ReadAt 方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReaderAt <span class="keyword">interface</span> &#123;</span><br><span class="line">        ReadAt(p []<span class="keyword">byte</span>, off <span class="keyword">int64</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ReadAt 从对象数据流的 off 处读出数据到 p 中</span><br><span class="line">	忽略数据的读写指针，从数据的起始位置偏移 off 处开始读取</span><br><span class="line">	如果对象的数据流只有部分可用，不足以填满 p</span><br><span class="line">	则 ReadAt 将等待所有数据可用之后，继续向 p 中写入</span><br><span class="line">	直到将 p 填满后再返回</span><br><span class="line">	在这点上 ReadAt 要比 Read 更严格</span><br><span class="line">	返回读取的字节数 n 和读取时遇到的错误</span><br><span class="line">	如果 n &lt; len(p)，则需要返回一个 err 值来说明</span><br><span class="line">	为什么没有将 p 填满（比如 EOF）</span><br><span class="line">	如果 n &#x3D; len(p)，而且对象的数据没有全部读完，则</span><br><span class="line">	err 将返回 nil</span><br><span class="line">	如果 n &#x3D; len(p)，而且对象的数据刚好全部读完，则</span><br><span class="line">	err 将返回 EOF 或者 nil（不确定）</span><br></pre></td></tr></table></figure>



<p>定义WriterAt接口，WriterAt 接口封装了基本的 WriteAt 方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> WriterAt <span class="keyword">interface</span> &#123;</span><br><span class="line">        WriteAt(p []<span class="keyword">byte</span>, off <span class="keyword">int64</span>) (n <span class="keyword">int</span>, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WriteAt 将 p 中的数据写入到对象数据流的 off 处</span><br><span class="line">	忽略数据的读写指针，从数据的起始位置偏移 off 处开始写入</span><br><span class="line">	返回写入的字节数和写入时遇到的错误</span><br><span class="line">	如果 n &lt; len(p)，则必须返回一个 err 值来说明</span><br><span class="line">	为什么没有将 p 完全写入</span><br></pre></td></tr></table></figure>





<p>其他。。。</p>
<h2 id="2、文件读写"><a href="#2、文件读写" class="headerlink" title="2、文件读写"></a>2、文件读写</h2><p>file类是在os包中的，封装了底层的文件描述符和相关信息，同时封装了Read和Write的实现。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="comment">//Read方法从f中读取最多len(b)字节数据并写入b。它返回读取的字节数和可能遇到的任何错误。文件终止标志是读取0个字节且返回值err为io.EOF。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">ReadAt</span><span class="params">(b []<span class="keyword">byte</span>, off <span class="keyword">int64</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="comment">//ReadAt从指定的位置（相对于文件开始位置）读取len(b)字节数据并写入b。它返回读取的字节数和可能遇到的任何错误。当n&lt;len(b)时，本方法总是会返回错误；如果是因为到达文件结尾，返回值err会是io.EOF。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Write</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="comment">//Write向文件中写入len(b)字节数据。它返回写入的字节数和可能遇到的任何错误。如果返回值n!=len(b)，本方法会返回一个非nil的错误。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">WriteString</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(ret <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="comment">//WriteString类似Write，但接受一个字符串参数。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">WriteAt</span><span class="params">(b []<span class="keyword">byte</span>, off <span class="keyword">int64</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="comment">//WriteAt在指定的位置（相对于文件开始位置）写入len(b)字节数据。它返回写入的字节数和可能遇到的任何错误。如果返回值n!=len(b)，本方法会返回一个非nil的错误。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Seek</span><span class="params">(offset <span class="keyword">int64</span>, whence <span class="keyword">int</span>)</span> <span class="params">(ret <span class="keyword">int64</span>, err error)</span></span></span><br><span class="line"><span class="comment">//Seek设置下一次读/写的位置。offset为相对偏移量，而whence决定相对位置：0为相对文件开头，1为相对当前位置，2为相对文件结尾。它返回新的偏移量（相对开头）和可能的错误。</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Sync</span><span class="params">()</span> <span class="params">(err error)</span></span></span><br><span class="line"><span class="comment">//Sync递交文件的当前内容进行稳定的存储。一般来说，这表示将文件系统的最近写入的数据在内存中的拷贝刷新到硬盘中稳定保存。</span></span><br></pre></td></tr></table></figure>



<h2 id="3、实例代码"><a href="#3、实例代码" class="headerlink" title="3、实例代码"></a>3、实例代码</h2><p>读取文件中的数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	读取数据：</span></span><br><span class="line"><span class="comment">		Reader接口：</span></span><br><span class="line"><span class="comment">			Read(p []byte)(n int, error)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 <span class="comment">//读取本地aa.txt文件中的数据</span></span><br><span class="line">	 <span class="comment">//step1：打开文件</span></span><br><span class="line">	 fileName := <span class="string">"/Users/ruby/Documents/pro/a/aa.txt"</span></span><br><span class="line">	 file,err := os.Open(fileName)</span><br><span class="line">	 <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">	 	fmt.Println(<span class="string">"err:"</span>,err)</span><br><span class="line">	 	<span class="keyword">return</span></span><br><span class="line">	 &#125;</span><br><span class="line">	 <span class="comment">//step3：关闭文件</span></span><br><span class="line">	 <span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//step2：读取数据</span></span><br><span class="line">	 bs := <span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">	 <span class="comment">/*</span></span><br><span class="line"><span class="comment">	 //第一次读取</span></span><br><span class="line"><span class="comment">	 n,err :=file.Read(bs)</span></span><br><span class="line"><span class="comment">	 fmt.Println(err) //&lt;nil&gt;</span></span><br><span class="line"><span class="comment">	 fmt.Println(n) //4</span></span><br><span class="line"><span class="comment">	 fmt.Println(bs) //[97 98 99 100]</span></span><br><span class="line"><span class="comment">	fmt.Println(string(bs)) //abcd</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	//第二次读取</span></span><br><span class="line"><span class="comment">	n,err = file.Read(bs)</span></span><br><span class="line"><span class="comment">	fmt.Println(err)//&lt;nil&gt;</span></span><br><span class="line"><span class="comment">	fmt.Println(n)//4</span></span><br><span class="line"><span class="comment">	fmt.Println(bs) //[101 102 103 104]</span></span><br><span class="line"><span class="comment">	fmt.Println(string(bs)) //efgh</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	//第三次读取</span></span><br><span class="line"><span class="comment">	n,err = file.Read(bs)</span></span><br><span class="line"><span class="comment">	fmt.Println(err) //&lt;nil&gt;</span></span><br><span class="line"><span class="comment">	fmt.Println(n) //2</span></span><br><span class="line"><span class="comment">	fmt.Println(bs) //[105 106 103 104]</span></span><br><span class="line"><span class="comment">	fmt.Println(string(bs)) //ijgh</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	//第四次读取</span></span><br><span class="line"><span class="comment">	n,err = file.Read(bs)</span></span><br><span class="line"><span class="comment">	fmt.Println(err) //EOF</span></span><br><span class="line"><span class="comment">	fmt.Println(n) //0</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 n := <span class="number">-1</span></span><br><span class="line">	 <span class="keyword">for</span>&#123;</span><br><span class="line">	 	n,err = file.Read(bs)</span><br><span class="line">	 	<span class="keyword">if</span> n == <span class="number">0</span> || err == io.EOF&#123;</span><br><span class="line">	 		fmt.Println(<span class="string">"读取到了文件的末尾，结束读取操作。。"</span>)</span><br><span class="line">	 		<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	 	fmt.Println(<span class="keyword">string</span>(bs[:n]))</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>写出数据到本地文件：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	写出数据：</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	 fileName := <span class="string">"/Users/ruby/Documents/pro/a/ab.txt"</span></span><br><span class="line">	<span class="comment">//step1：打开文件</span></span><br><span class="line">	<span class="comment">//step2：写出数据</span></span><br><span class="line">	<span class="comment">//step3：关闭文件</span></span><br><span class="line">	<span class="comment">//file,err := os.Open(fileName)</span></span><br><span class="line">	file,err := os.OpenFile(fileName,os.O_CREATE|os.O_WRONLY|os.O_APPEND,os.ModePerm)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//写出数据</span></span><br><span class="line">	<span class="comment">//bs :=[]byte&#123;65,66,67,68,69,70&#125;//A,B,C,D,E,F</span></span><br><span class="line">	bs :=[] <span class="keyword">byte</span>&#123;<span class="number">97</span>,<span class="number">98</span>,<span class="number">99</span>,<span class="number">100</span>&#125; <span class="comment">//a,b,c,d</span></span><br><span class="line">	<span class="comment">//n,err := file.Write(bs)</span></span><br><span class="line">	n,err := file.Write(bs[:<span class="number">2</span>])</span><br><span class="line">	fmt.Println(n)</span><br><span class="line">	HandleErr(err)</span><br><span class="line">	file.WriteString(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//直接写出字符串</span></span><br><span class="line">	n,err = file.WriteString(<span class="string">"HelloWorld"</span>)</span><br><span class="line">	fmt.Println(n)</span><br><span class="line">	HandleErr(err)</span><br><span class="line"></span><br><span class="line">	file.WriteString(<span class="string">"\n"</span>)</span><br><span class="line">	n,err =file.Write([]<span class="keyword">byte</span>(<span class="string">"today"</span>))</span><br><span class="line">	fmt.Println(n)</span><br><span class="line">	HandleErr(err)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleErr</span><span class="params">(err error)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="三、文件复制"><a href="#三、文件复制" class="headerlink" title="三、文件复制"></a>三、文件复制</h1><p>在io包中主要是操作流的一些方法，今天主要学习一下copy。就是把一个文件复制到另一个目录下。</p>
<p>它的原理就是通过程序，从源文件读取文件中的数据，在写出到目标文件里。</p>
<p><img src="img/copyfile.png" alt="copyfile"></p>
<h2 id="1、方法一：io包下的Read-和Write-方法实现"><a href="#1、方法一：io包下的Read-和Write-方法实现" class="headerlink" title="1、方法一：io包下的Read()和Write()方法实现"></a>1、方法一：io包下的Read()和Write()方法实现</h2><p>我们可以通过io包下的Read()和Write()方法，边读边写，就能够实现文件的复制。这个方法是按块读取文件，块的大小也会影响到程序的性能。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">该函数的功能：实现文件的拷贝，返回值是拷贝的总数量(字节),错误</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyFile1</span><span class="params">(srcFile,destFile <span class="keyword">string</span>)</span><span class="params">(<span class="keyword">int</span>,error)</span></span>&#123;</span><br><span class="line">	file1,err:=os.Open(srcFile)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	file2,err:=os.OpenFile(destFile,os.O_WRONLY|os.O_CREATE,os.ModePerm)</span><br><span class="line">	<span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file1.Close()</span><br><span class="line">	<span class="keyword">defer</span> file2.Close()</span><br><span class="line">	<span class="comment">//拷贝数据</span></span><br><span class="line">	bs := <span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">1024</span>,<span class="number">1024</span>)</span><br><span class="line">	n :=<span class="number">-1</span><span class="comment">//读取的数据量</span></span><br><span class="line">	total := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		n,err = file1.Read(bs)</span><br><span class="line">		<span class="keyword">if</span> err == io.EOF || n == <span class="number">0</span>&#123;</span><br><span class="line">			fmt.Println(<span class="string">"拷贝完毕。。"</span>)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">			fmt.Println(<span class="string">"报错了。。。"</span>)</span><br><span class="line">			<span class="keyword">return</span> total,err</span><br><span class="line">		&#125;</span><br><span class="line">		total += n</span><br><span class="line">		file2.Write(bs[:n])</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> total,<span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2、方法二：io包下的Copy-方法实现"><a href="#2、方法二：io包下的Copy-方法实现" class="headerlink" title="2、方法二：io包下的Copy()方法实现"></a>2、方法二：io包下的Copy()方法实现</h2><p>我们也可以直接使用io包下的Copy()方法。</p>
<p>示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyFile2</span><span class="params">(srcFile, destFile <span class="keyword">string</span>)</span><span class="params">(<span class="keyword">int64</span>,error)</span></span>&#123;</span><br><span class="line">	file1,err:=os.Open(srcFile)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	file2,err:=os.OpenFile(destFile,os.O_WRONLY|os.O_CREATE,os.ModePerm)</span><br><span class="line">	<span class="keyword">if</span> err !=<span class="literal">nil</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file1.Close()</span><br><span class="line">	<span class="keyword">defer</span> file2.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> io.Copy(file2,file1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="扩展内容："><a href="#扩展内容：" class="headerlink" title="扩展内容："></a>扩展内容：</h3><p>在io包（golang 版本 1.12）中，不止提供了Copy()方法，还有另外2个公开的copy方法：CopyN()，CopyBuffer()。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Copy（dst,src） 为复制src 全部到 dst 中。</span><br><span class="line"></span><br><span class="line">CopyN(dst,src,n) 为复制src 中 n 个字节到 dst。</span><br><span class="line"></span><br><span class="line">CopyBuffer（dst,src,buf）为指定一个buf缓存区，以这个大小完全复制。</span><br></pre></td></tr></table></figure>



<p>他们的关系如下：</p>
<p><img src="img/20190316084535903.jpg" alt="20190316084535903"></p>
<p>(图片来自网络)</p>
<p>从图可以看出，无论是哪个copy方法最终都是由copyBuffer（）这个私有方法实现的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyBuffer</span><span class="params">(dst Writer, src Reader, buf []<span class="keyword">byte</span>)</span> <span class="params">(written <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// If the reader has a WriteTo method, use it to do the copy.</span></span><br><span class="line">	<span class="comment">// Avoids an allocation and a copy.</span></span><br><span class="line">	<span class="keyword">if</span> wt, ok := src.(WriterTo); ok &#123;</span><br><span class="line">		<span class="keyword">return</span> wt.WriteTo(dst)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Similarly, if the writer has a ReadFrom method, use it to do the copy.</span></span><br><span class="line">	<span class="keyword">if</span> rt, ok := dst.(ReaderFrom); ok &#123;</span><br><span class="line">		<span class="keyword">return</span> rt.ReadFrom(src)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> buf == <span class="literal">nil</span> &#123;</span><br><span class="line">		size := <span class="number">32</span> * <span class="number">1024</span></span><br><span class="line">		<span class="keyword">if</span> l, ok := src.(*LimitedReader); ok &amp;&amp; <span class="keyword">int64</span>(size) &gt; l.N &#123;</span><br><span class="line">			<span class="keyword">if</span> l.N &lt; <span class="number">1</span> &#123;</span><br><span class="line">				size = <span class="number">1</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				size = <span class="keyword">int</span>(l.N)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		buf = <span class="built_in">make</span>([]<span class="keyword">byte</span>, size)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		nr, er := src.Read(buf)</span><br><span class="line">		<span class="keyword">if</span> nr &gt; <span class="number">0</span> &#123;</span><br><span class="line">			nw, ew := dst.Write(buf[<span class="number">0</span>:nr])</span><br><span class="line">			<span class="keyword">if</span> nw &gt; <span class="number">0</span> &#123;</span><br><span class="line">				written += <span class="keyword">int64</span>(nw)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> ew != <span class="literal">nil</span> &#123;</span><br><span class="line">				err = ew</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> nr != nw &#123;</span><br><span class="line">				err = ErrShortWrite</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> er != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> er != EOF &#123;</span><br><span class="line">				err = er</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> written, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>从这部分代码可以看出，复制主要分为3种。</p>
<p> 1.如果被复制的Reader（src）会尝试能否断言成writerTo，如果可以则直接调用下面的writerTo方法</p>
<p> 2.如果 Writer（dst） 会尝试能否断言成ReadFrom ，如果可以则直接调用下面的readfrom方法</p>
<p> 3.如果都木有实现，则调用底层read实现复制。</p>
<p>其中，有这么一段代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> buf == <span class="literal">nil</span> &#123;</span><br><span class="line">		size := <span class="number">32</span> * <span class="number">1024</span></span><br><span class="line">		<span class="keyword">if</span> l, ok := src.(*LimitedReader); ok &amp;&amp; <span class="keyword">int64</span>(size) &gt; l.N &#123;</span><br><span class="line">			<span class="keyword">if</span> l.N &lt; <span class="number">1</span> &#123;</span><br><span class="line">				size = <span class="number">1</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				size = <span class="keyword">int</span>(l.N)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		buf = <span class="built_in">make</span>([]<span class="keyword">byte</span>, size)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<p>这部分主要是实现了对Copy和CopyN的处理。通过上面的调用关系图，我们看出CopyN在调用后，会把Reader转成LimiteReader。</p>
<p>区别是如果Copy，直接建立一个缓存区默认大小为 32* 1024 的buf，如果是CopyN 会先判断 要复制的字节数，如果小于默认大小，会创建一个等于要复制字节数的buf。</p>
<h2 id="3、方法三：ioutil包"><a href="#3、方法三：ioutil包" class="headerlink" title="3、方法三：ioutil包"></a>3、方法三：ioutil包</h2><p>第三种方法是使用ioutil包中的 <code>ioutil.WriteFile()</code>和 <code>ioutil.ReadFile()</code>，但由于使用一次性读取文件，再一次性写入文件的方式，所以该方法不适用于大文件，容易内存溢出。</p>
<p>示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">copyFile3</span><span class="params">(srcFile, destFile <span class="keyword">string</span>)</span><span class="params">(<span class="keyword">int</span>,error)</span></span>&#123;</span><br><span class="line">	input, err := ioutil.ReadFile(srcFile)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = ioutil.WriteFile(destFile, input, <span class="number">0644</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"操作失败："</span>, destFile)</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(input),<span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="4、总结"><a href="#4、总结" class="headerlink" title="4、总结"></a>4、总结</h2><p>最后，我们来测试一下这3种拷贝需要花费时间，拷贝的文件都是一样的一个mp4文件(400M)，<br><img src="img/WX20190702-124039.png" alt="WX20190702-124039"></p>
<p>代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	复制文件：</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//srcFile := "/home/ruby/文档/pro/aa.txt"</span></span><br><span class="line">	<span class="comment">//destFile := "/home/ruby/文档/aa.txt"</span></span><br><span class="line"></span><br><span class="line">	srcFile :=<span class="string">"/Users/ruby/Documents/pro/a/001_小程序入门.mp4"</span></span><br><span class="line">	destFile:=<span class="string">"001_小程序入门.mp4"</span></span><br><span class="line">	total,err:=copyFile1(srcFile,destFile)</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">	fmt.Println(total)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>第一种：io包下Read()和Write()直接读写：我们自己创建读取数据的切片的大小，直接影响性能。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">localhost:l_file ruby$ time <span class="keyword">go</span> run demo05_copy.<span class="keyword">go</span> </span><br><span class="line">拷贝完毕。。</span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line"><span class="number">401386819</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">real</span>    <span class="number">0</span>m7<span class="number">.911</span>s</span><br><span class="line">user    <span class="number">0</span>m2<span class="number">.900</span>s</span><br><span class="line">sys     <span class="number">0</span>m7<span class="number">.661</span>s</span><br></pre></td></tr></table></figure>



<p>第二种：io包下Copy()方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localhost:l_file ruby$ time <span class="keyword">go</span> run demo05_copy.<span class="keyword">go</span> </span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line"><span class="number">401386819</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">real</span>    <span class="number">0</span>m1<span class="number">.594</span>s</span><br><span class="line">user    <span class="number">0</span>m0<span class="number">.533</span>s</span><br><span class="line">sys     <span class="number">0</span>m1<span class="number">.136</span>s</span><br></pre></td></tr></table></figure>



<p>第三种：ioutil包</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">localhost:l_file ruby$ time <span class="keyword">go</span> run demo05_copy.<span class="keyword">go</span> </span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line"><span class="number">401386819</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">real</span>    <span class="number">0</span>m1<span class="number">.515</span>s</span><br><span class="line">user    <span class="number">0</span>m0<span class="number">.339</span>s</span><br><span class="line">sys     <span class="number">0</span>m0<span class="number">.625</span>s</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="img/WX20190702-124719.png" alt="WX20190702-124719"></p>
<p>这3种方式，在性能上，不管是还是io.Copy()还是ioutil包，性能都是还不错的。</p>
<h1 id="四、断点续传"><a href="#四、断点续传" class="headerlink" title="四、断点续传"></a>四、断点续传</h1><h2 id="1、Seeker接口"><a href="#1、Seeker接口" class="headerlink" title="1、Seeker接口"></a>1、Seeker接口</h2><p>Seeker是包装基本Seek方法的接口。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Seeker <span class="keyword">interface</span> &#123;</span><br><span class="line">        Seek(offset <span class="keyword">int64</span>, whence <span class="keyword">int</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>seek(offset,whence),设置指针光标的位置，随机读写文件：</p>
<pre><code>第一个参数：偏移量
第二个参数：如何设置            

            0：seekStart表示相对于文件开始，
            1：seekCurrent表示相对于当前偏移量，
            2：seek end表示相对于结束。</code></pre><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	SeekStart   = <span class="number">0</span> <span class="comment">// seek relative to the origin of the file</span></span><br><span class="line">	SeekCurrent = <span class="number">1</span> <span class="comment">// seek relative to the current offset</span></span><br><span class="line">	SeekEnd     = <span class="number">2</span> <span class="comment">// seek relative to the end</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<p>示例代码：</p>
<p>我们要读取本地/Users/ruby/Documents/pro/a 目录下的aa.txt文件，文件中的内容是：abcdefghij这几个字符。</p>
<p><img src="img/WX20190703-155441.png" alt="WX20190703-155441"></p>
<p>示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	seek(offset,whence),设置指针光标的位置</span></span><br><span class="line"><span class="comment">	第一个参数：偏移量</span></span><br><span class="line"><span class="comment">	第二个参数：如何设置</span></span><br><span class="line"><span class="comment">		0：seekStart表示相对于文件开始，</span></span><br><span class="line"><span class="comment">		1：seekCurrent表示相对于当前偏移量，</span></span><br><span class="line"><span class="comment">		2：seek end表示相对于结束。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	const (</span></span><br><span class="line"><span class="comment">	SeekStart   = 0 // seek relative to the origin of the file</span></span><br><span class="line"><span class="comment">	SeekCurrent = 1 // seek relative to the current offset</span></span><br><span class="line"><span class="comment">	SeekEnd     = 2 // seek relative to the end</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	随机读取文件：</span></span><br><span class="line"><span class="comment">		可以设置指针光标的位置</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	file,_:=os.OpenFile(<span class="string">"/Users/ruby/Documents/pro/a/aa.txt"</span>,os.O_RDWR,<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line">	bs :=[]<span class="keyword">byte</span>&#123;<span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">	file.Read(bs)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(bs))</span><br><span class="line"></span><br><span class="line">	file.Seek(<span class="number">4</span>,io.SeekStart)</span><br><span class="line">	file.Read(bs)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(bs))</span><br><span class="line">	file.Seek(<span class="number">2</span>,<span class="number">0</span>) <span class="comment">//也是SeekStart</span></span><br><span class="line">	file.Read(bs)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(bs))</span><br><span class="line"></span><br><span class="line">	file.Seek(<span class="number">3</span>,io.SeekCurrent)</span><br><span class="line">	file.Read(bs)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(bs))</span><br><span class="line"></span><br><span class="line">	file.Seek(<span class="number">0</span>,io.SeekEnd)</span><br><span class="line">	file.WriteString(<span class="string">"ABC"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="img/WX20190703-155739.png" alt="WX20190703-155739"></p>
<p>本地文件：</p>
<p><img src="img/WX20190703-155821.png" alt="WX20190703-155821"></p>
<h2 id="2、断点续传"><a href="#2、断点续传" class="headerlink" title="2、断点续传"></a>2、断点续传</h2><p>首先思考几个问题<br>Q1：如果你要传的文件，比较大，那么是否有方法可以缩短耗时？<br>Q2：如果在文件传递过程中，程序因各种原因被迫中断了，那么下次再重启时，文件是否还需要重头开始？<br>Q3：传递文件的时候，支持暂停和恢复么？即使这两个操作分布在程序进程被杀前后。</p>
<p>通过断点续传可以实现，不同的语言有不同的实现方式。我们看看Go语言中，通过Seek()方法如何实现：</p>
<p>先说一下思路：想实现断点续传，主要就是记住上一次已经传递了多少数据，那我们可以创建一个临时文件，记录已经传递的数据量，当恢复传递的时候，先从临时文件中读取上次已经传递的数据量，然后通过Seek()方法，设置到该读和该写的位置，再继续传递数据。</p>
<p>示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"io"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	断点续传：</span></span><br><span class="line"><span class="comment">		文件传递：文件复制</span></span><br><span class="line"><span class="comment">			/Users/ruby/Documents/pro/a/guliang.jpeg</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		复制到</span></span><br><span class="line"><span class="comment">			guliang4.jpeg</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	思路：</span></span><br><span class="line"><span class="comment">		边复制，边记录复制的总量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	srcFile:=<span class="string">"/Users/ruby/Documents/pro/a/guliang.jpeg"</span></span><br><span class="line">	destFile:=<span class="string">"guliang4.jpeg"</span></span><br><span class="line">	tempFile:=destFile+<span class="string">"temp.txt"</span></span><br><span class="line">	<span class="comment">//fmt.Println(tempFile)</span></span><br><span class="line">	file1,_:=os.Open(srcFile)</span><br><span class="line">	file2,_:=os.OpenFile(destFile,os.O_CREATE|os.O_WRONLY,os.ModePerm)</span><br><span class="line">	file3,_:=os.OpenFile(tempFile,os.O_CREATE|os.O_RDWR,os.ModePerm)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> file1.Close()</span><br><span class="line">	<span class="keyword">defer</span> file2.Close()</span><br><span class="line">	<span class="comment">//1.读取临时文件中的数据，根据seek</span></span><br><span class="line">	file3.Seek(<span class="number">0</span>,io.SeekStart)</span><br><span class="line">	bs:=<span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">100</span>,<span class="number">100</span>)</span><br><span class="line">	n1,err:=file3.Read(bs)</span><br><span class="line">	fmt.Println(n1)</span><br><span class="line">	countStr:=<span class="keyword">string</span>(bs[:n1])</span><br><span class="line">	fmt.Println(countStr)</span><br><span class="line">	<span class="comment">//count,_:=strconv.Atoi(countStr)</span></span><br><span class="line">	count,_:=strconv.ParseInt(countStr,<span class="number">10</span>,<span class="number">64</span>)</span><br><span class="line">	fmt.Println(count)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//2. 设置读，写的偏移量</span></span><br><span class="line">	file1.Seek(count,<span class="number">0</span>)</span><br><span class="line">	file2.Seek(count,<span class="number">0</span>)</span><br><span class="line">	data:=<span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">1024</span>,<span class="number">1024</span>)</span><br><span class="line">	n2:=<span class="number">-1</span><span class="comment">// 读取的数据量</span></span><br><span class="line">	n3:=<span class="number">-1</span><span class="comment">//写出的数据量</span></span><br><span class="line">	total :=<span class="keyword">int</span>(count)<span class="comment">//读取的总量</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>&#123;</span><br><span class="line">		<span class="comment">//3.读取数据</span></span><br><span class="line">		n2,err=file1.Read(data)</span><br><span class="line">		<span class="keyword">if</span> err ==io.EOF&#123;</span><br><span class="line">			fmt.Println(<span class="string">"文件复制完毕。。"</span>)</span><br><span class="line">			file3.Close()</span><br><span class="line">			os.Remove(tempFile)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//将数据写入到目标文件</span></span><br><span class="line">		n3,_=file2.Write(data[:n2])</span><br><span class="line">		total += n3</span><br><span class="line">		<span class="comment">//将复制总量，存储到临时文件中</span></span><br><span class="line">		file3.Seek(<span class="number">0</span>,io.SeekStart)</span><br><span class="line">		file3.WriteString(strconv.Itoa(total))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">//假装断电</span></span><br><span class="line">		<span class="comment">//if total&gt;8000&#123;</span></span><br><span class="line">		<span class="comment">//	panic("假装断电了。。。，假装的。。。")</span></span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="五、bufio包"><a href="#五、bufio包" class="headerlink" title="五、bufio包"></a>五、bufio包</h1><blockquote>
<p>@author：韩茹<br>版权所有：北京千锋互联科技有限公司</p>
</blockquote>
<p>生命不止，继续Go go go。。</p>
<p>Go语言在io操作中，还提供了一个bufio的包，使用这个包可以大幅提高文件读写的效率。</p>
<h2 id="1、bufio包原理"><a href="#1、bufio包原理" class="headerlink" title="1、bufio包原理"></a>1、bufio包原理</h2><p>bufio 是通过缓冲来提高效率。</p>
<p>io操作本身的效率并不低，低的是频繁的访问本地磁盘的文件。所以bufio就提供了缓冲区(分配一块内存)，读和写都先在缓冲区中，最后再读写文件，来降低访问本地磁盘的次数，从而提高效率。</p>
<p>简单的说就是，把文件读取进缓冲（内存）之后再读取的时候就可以避免文件系统的io 从而提高速度。同理，在进行写操作时，先把文件写入缓冲（内存），然后由缓冲写入文件系统。看完以上解释有人可能会表示困惑了，直接把 内容-&gt;文件 和 内容-&gt;缓冲-&gt;文件相比， 缓冲区好像没有起到作用嘛。其实缓冲区的设计是为了存储多次的写入，最后一口气把缓冲区内容写入文件。</p>
<p><img src="img/WX20190704-113648.png" alt="WX20190704-113648"></p>
<p>bufio 封装了io.Reader或io.Writer接口对象，并创建另一个也实现了该接口的对象。</p>
<p>io.Reader或io.Writer 接口实现read() 和 write() 方法，对于实现这个接口的对象都是可以使用这两个方法的。</p>
<p>Reader对象</p>
<p>bufio.Reader 是bufio中对io.Reader 的封装</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Reader implements buffering for an io.Reader object.</span></span><br><span class="line"><span class="keyword">type</span> Reader <span class="keyword">struct</span> &#123;</span><br><span class="line">	buf          []<span class="keyword">byte</span></span><br><span class="line">	rd           io.Reader <span class="comment">// reader provided by the client</span></span><br><span class="line">	r, w         <span class="keyword">int</span>       <span class="comment">// buf read and write positions</span></span><br><span class="line">	err          error</span><br><span class="line">	lastByte     <span class="keyword">int</span> <span class="comment">// last byte read for UnreadByte; -1 means invalid</span></span><br><span class="line">	lastRuneSize <span class="keyword">int</span> <span class="comment">// size of last rune read for UnreadRune; -1 means invalid</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bufio.Read(p []byte) 相当于读取大小len(p)的内容，思路如下：</p>
<ol>
<li>当缓存区有内容的时，将缓存区内容全部填入p并清空缓存区</li>
<li>当缓存区没有内容的时候且len(p)&gt;len(buf),即要读取的内容比缓存区还要大，直接去文件读取即可</li>
<li>当缓存区没有内容的时候且len(p)&lt;len(buf),即要读取的内容比缓存区小，缓存区从文件读取内容充满缓存区，并将p填满（此时缓存区有剩余内容）</li>
<li>以后再次读取时缓存区有内容，将缓存区内容全部填入p并清空缓存区（此时和情况1一样）</li>
</ol>
<p>源码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Read reads data into p.</span></span><br><span class="line"><span class="comment">// It returns the number of bytes read into p.</span></span><br><span class="line"><span class="comment">// The bytes are taken from at most one Read on the underlying Reader,</span></span><br><span class="line"><span class="comment">// hence n may be less than len(p).</span></span><br><span class="line"><span class="comment">// To read exactly len(p) bytes, use io.ReadFull(b, p).</span></span><br><span class="line"><span class="comment">// At EOF, the count will be zero and err will be io.EOF.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Read</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">	n = <span class="built_in">len</span>(p)</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> b.r == b.w &#123;</span><br><span class="line">		<span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(p) &gt;= <span class="built_in">len</span>(b.buf) &#123;</span><br><span class="line">			<span class="comment">// Large read, empty buffer.</span></span><br><span class="line">			<span class="comment">// Read directly into p to avoid copy.</span></span><br><span class="line">			n, b.err = b.rd.Read(p)</span><br><span class="line">			<span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line">				<span class="built_in">panic</span>(errNegativeRead)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">				b.lastByte = <span class="keyword">int</span>(p[n<span class="number">-1</span>])</span><br><span class="line">				b.lastRuneSize = <span class="number">-1</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> n, b.readErr()</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// One read.</span></span><br><span class="line">		<span class="comment">// Do not use b.fill, which will loop.</span></span><br><span class="line">		b.r = <span class="number">0</span></span><br><span class="line">		b.w = <span class="number">0</span></span><br><span class="line">		n, b.err = b.rd.Read(b.buf)</span><br><span class="line">		<span class="keyword">if</span> n &lt; <span class="number">0</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(errNegativeRead)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>, b.readErr()</span><br><span class="line">		&#125;</span><br><span class="line">		b.w += n</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// copy as much as we can</span></span><br><span class="line">	n = <span class="built_in">copy</span>(p, b.buf[b.r:b.w])</span><br><span class="line">	b.r += n</span><br><span class="line">	b.lastByte = <span class="keyword">int</span>(b.buf[b.r<span class="number">-1</span>])</span><br><span class="line">	b.lastRuneSize = <span class="number">-1</span></span><br><span class="line">	<span class="keyword">return</span> n, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>reader内部通过维护一个r, w 即读入和写入的位置索引来判断是否缓存区内容被全部读出。</p>
<p>Writer对象</p>
<p>bufio.Writer 是bufio中对io.Writer 的封装</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Writer implements buffering for an io.Writer object.</span></span><br><span class="line"><span class="comment">// If an error occurs writing to a Writer, no more data will be</span></span><br><span class="line"><span class="comment">// accepted and all subsequent writes, and Flush, will return the error.</span></span><br><span class="line"><span class="comment">// After all data has been written, the client should call the</span></span><br><span class="line"><span class="comment">// Flush method to guarantee all data has been forwarded to</span></span><br><span class="line"><span class="comment">// the underlying io.Writer.</span></span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">struct</span> &#123;</span><br><span class="line">	err error</span><br><span class="line">	buf []<span class="keyword">byte</span></span><br><span class="line">	n   <span class="keyword">int</span></span><br><span class="line">	wr  io.Writer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bufio.Write(p []byte) 的思路如下</p>
<ol>
<li>判断buf中可用容量是否可以放下 p</li>
<li>如果能放下，直接把p拼接到buf后面，即把内容放到缓冲区</li>
<li>如果缓冲区的可用容量不足以放下，且此时缓冲区是空的，直接把p写入文件即可</li>
<li>如果缓冲区的可用容量不足以放下，且此时缓冲区有内容，则用p把缓冲区填满，把缓冲区所有内容写入文件，并清空缓冲区</li>
<li>判断p的剩余内容大小能否放到缓冲区，如果能放下（此时和步骤1情况一样）则把内容放到缓冲区</li>
<li>如果p的剩余内容依旧大于缓冲区，（注意此时缓冲区是空的，情况和步骤3一样）则把p的剩余内容直接写入文件</li>
</ol>
<p>以下是源码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Write writes the contents of p into the buffer.</span></span><br><span class="line"><span class="comment">// It returns the number of bytes written.</span></span><br><span class="line"><span class="comment">// If nn &lt; len(p), it also returns an error explaining</span></span><br><span class="line"><span class="comment">// why the write is short.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Write</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(nn <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(p) &gt; b.Available() &amp;&amp; b.err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> n <span class="keyword">int</span></span><br><span class="line">		<span class="keyword">if</span> b.Buffered() == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="comment">// Large write, empty buffer.</span></span><br><span class="line">			<span class="comment">// Write directly from p to avoid copy.</span></span><br><span class="line">			n, b.err = b.wr.Write(p)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			n = <span class="built_in">copy</span>(b.buf[b.n:], p)</span><br><span class="line">			b.n += n</span><br><span class="line">			b.Flush()</span><br><span class="line">		&#125;</span><br><span class="line">		nn += n</span><br><span class="line">		p = p[n:]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> b.err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> nn, b.err</span><br><span class="line">	&#125;</span><br><span class="line">	n := <span class="built_in">copy</span>(b.buf[b.n:], p)</span><br><span class="line">	b.n += n</span><br><span class="line">	nn += n</span><br><span class="line">	<span class="keyword">return</span> nn, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>b.wr 存储的是一个io.writer对象，实现了Write()的接口，所以可以使用b.wr.Write(p) 将p的内容写入文件。</p>
<p>b.flush() 会将缓存区内容写入文件，当所有写入完成后，因为缓存区会存储内容，所以需要手动flush()到文件。</p>
<p>b.Available() 为buf可用容量，等于len(buf) - n。</p>
<p>下图解释的是其中一种情况，即缓存区有内容，剩余p大于缓存区</p>
<p><img src="img/WX20190704-122357.png" alt="WX20190704-122357"></p>
<h2 id="2、bufio包"><a href="#2、bufio包" class="headerlink" title="2、bufio包"></a>2、bufio包</h2><p>bufio包实现了有缓冲的I/O。它包装一个io.Reader或io.Writer接口对象，创建另一个也实现了该接口，且同时还提供了缓冲和一些文本I/O的帮助函数的对象。</p>
<p>bufio.Reader：</p>
<p>bufio.Reader 实现了如下接口：<br>    io.Reader<br>    io.WriterTo<br>    io.ByteScanner<br>    io.RuneScanner</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewReaderSize 将 rd 封装成一个带缓存的 bufio.Reader 对象，</span></span><br><span class="line"><span class="comment">// 缓存大小由 size 指定（如果小于 16 则会被设置为 16）。</span></span><br><span class="line"><span class="comment">// 如果 rd 的基类型就是有足够缓存的 bufio.Reader 类型，则直接将</span></span><br><span class="line"><span class="comment">// rd 转换为基类型返回。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReaderSize</span><span class="params">(rd io.Reader, size <span class="keyword">int</span>)</span> *<span class="title">Reader</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NewReader 相当于 NewReaderSize(rd, 4096)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReader</span><span class="params">(rd io.Reader)</span> *<span class="title">Reader</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Peek 返回缓存的一个切片，该切片引用缓存中前 n 个字节的数据，</span></span><br><span class="line"><span class="comment">// 该操作不会将数据读出，只是引用，引用的数据在下一次读取操作之</span></span><br><span class="line"><span class="comment">// 前是有效的。如果切片长度小于 n，则返回一个错误信息说明原因。</span></span><br><span class="line"><span class="comment">// 如果 n 大于缓存的总大小，则返回 ErrBufferFull。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Peek</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Read 从 b 中读出数据到 p 中，返回读出的字节数和遇到的错误。</span></span><br><span class="line"><span class="comment">// 如果缓存不为空，则只能读出缓存中的数据，不会从底层 io.Reader</span></span><br><span class="line"><span class="comment">// 中提取数据，如果缓存为空，则：</span></span><br><span class="line"><span class="comment">// 1、len(p) &gt;= 缓存大小，则跳过缓存，直接从底层 io.Reader 中读</span></span><br><span class="line"><span class="comment">// 出到 p 中。</span></span><br><span class="line"><span class="comment">// 2、len(p) &lt; 缓存大小，则先将数据从底层 io.Reader 中读取到缓存</span></span><br><span class="line"><span class="comment">// 中，再从缓存读取到 p 中。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Read</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Buffered 返回缓存中未读取的数据的长度。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Buffered</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadBytes 功能同 ReadSlice，只不过返回的是缓存的拷贝。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadBytes</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(line []<span class="keyword">byte</span>, err error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadString 功能同 ReadBytes，只不过返回的是字符串。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadString</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(line <span class="keyword">string</span>, err error)</span></span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>bufio.Writer：</p>
<p>bufio.Writer 实现了如下接口：<br>    io.Writer<br>    io.ReaderFrom<br>    io.ByteWriter</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewWriterSize 将 wr 封装成一个带缓存的 bufio.Writer 对象，</span></span><br><span class="line"><span class="comment">// 缓存大小由 size 指定（如果小于 4096 则会被设置为 4096）。</span></span><br><span class="line"><span class="comment">// 如果 wr 的基类型就是有足够缓存的 bufio.Writer 类型，则直接将</span></span><br><span class="line"><span class="comment">// wr 转换为基类型返回。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWriterSize</span><span class="params">(wr io.Writer, size <span class="keyword">int</span>)</span> *<span class="title">Writer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NewWriter 相当于 NewWriterSize(wr, 4096)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWriter</span><span class="params">(wr io.Writer)</span> *<span class="title">Writer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteString 功能同 Write，只不过写入的是字符串</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">WriteString</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteRune 向 b 写入 r 的 UTF-8 编码，返回 r 的编码长度。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">WriteRune</span><span class="params">(r <span class="keyword">rune</span>)</span> <span class="params">(size <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Flush 将缓存中的数据提交到底层的 io.Writer 中</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Flush</span><span class="params">()</span> <span class="title">error</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Available 返回缓存中未使用的空间的长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Available</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Buffered 返回缓存中未提交的数据的长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Buffered</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Reset 将 b 的底层 Writer 重新指定为 w，同时丢弃缓存中的所有数据，复位</span></span><br><span class="line"><span class="comment">// 所有标记和错误信息。相当于创建了一个新的 bufio.Writer。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Writer)</span> <span class="title">Reset</span><span class="params">(w io.Writer)</span></span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>





<h2 id="3、实例代码-1"><a href="#3、实例代码-1" class="headerlink" title="3、实例代码"></a>3、实例代码</h2><p>读取数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	bufio:高效io读写</span></span><br><span class="line"><span class="comment">		buffer缓存</span></span><br><span class="line"><span class="comment">		io：input/output</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	将io包下的Reader，Write对象进行包装，带缓存的包装，提高读写的效率</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		ReadBytes()</span></span><br><span class="line"><span class="comment">		ReadString()</span></span><br><span class="line"><span class="comment">		ReadLine()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	 fileName:=<span class="string">"/Users/ruby/Documents/pro/a/english.txt"</span></span><br><span class="line">	 file,err := os.Open(fileName)</span><br><span class="line">	 <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">	 	fmt.Println(err)</span><br><span class="line">	 	<span class="keyword">return</span></span><br><span class="line">	 &#125;</span><br><span class="line">	 <span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//创建Reader对象</span></span><br><span class="line">	 <span class="comment">//b1 := bufio.NewReader(file)</span></span><br><span class="line">	 <span class="comment">//1.Read()，高效读取</span></span><br><span class="line">	 <span class="comment">//p := make([]byte,1024)</span></span><br><span class="line">	 <span class="comment">//n1,err := b1.Read(p)</span></span><br><span class="line">	 <span class="comment">//fmt.Println(n1)</span></span><br><span class="line">	 <span class="comment">//fmt.Println(string(p[:n1]))</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//2.ReadLine()</span></span><br><span class="line">	 <span class="comment">//data,flag,err := b1.ReadLine()</span></span><br><span class="line">	 <span class="comment">//fmt.Println(flag)</span></span><br><span class="line">	 <span class="comment">//fmt.Println(err)</span></span><br><span class="line">	 <span class="comment">//fmt.Println(data)</span></span><br><span class="line">	 <span class="comment">//fmt.Println(string(data))</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">//3.ReadString()</span></span><br><span class="line">	<span class="comment">// s1,err :=b1.ReadString('\n')</span></span><br><span class="line">	<span class="comment">// fmt.Println(err)</span></span><br><span class="line">	<span class="comment">// fmt.Println(s1)</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// s1,err = b1.ReadString('\n')</span></span><br><span class="line">	<span class="comment">// fmt.Println(err)</span></span><br><span class="line">	<span class="comment">// fmt.Println(s1)</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//s1,err = b1.ReadString('\n')</span></span><br><span class="line">	<span class="comment">//fmt.Println(err)</span></span><br><span class="line">	<span class="comment">//fmt.Println(s1)</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//for&#123;</span></span><br><span class="line">	<span class="comment">//	s1,err := b1.ReadString('\n')</span></span><br><span class="line">	<span class="comment">//	if err == io.EOF&#123;</span></span><br><span class="line">	<span class="comment">//		fmt.Println("读取完毕。。")</span></span><br><span class="line">	<span class="comment">//		break</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//	fmt.Println(s1)</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//4.ReadBytes()</span></span><br><span class="line">	<span class="comment">//data,err :=b1.ReadBytes('\n')</span></span><br><span class="line">	<span class="comment">//fmt.Println(err)</span></span><br><span class="line">	<span class="comment">//fmt.Println(string(data))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Scanner</span></span><br><span class="line">	<span class="comment">//s2 := ""</span></span><br><span class="line">	<span class="comment">//fmt.Scanln(&amp;s2)</span></span><br><span class="line">	<span class="comment">//fmt.Println(s2)</span></span><br><span class="line"></span><br><span class="line">	b2 := bufio.NewReader(os.Stdin)</span><br><span class="line">	s2, _ := b2.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">	fmt.Println(s2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本地文件：english.txt文件内容：</p>
<p><img src="img/WX20190704-172759.png" alt="WX20190704-172759"></p>
<p>写数据示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	bufio:高效io读写</span></span><br><span class="line"><span class="comment">		buffer缓存</span></span><br><span class="line"><span class="comment">		io：input/output</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	将io包下的Reader，Write对象进行包装，带缓存的包装，提高读写的效率</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		func (b *Writer) Write(p []byte) (nn int, err error)</span></span><br><span class="line"><span class="comment">		func (b *Writer) WriteByte(c byte) error</span></span><br><span class="line"><span class="comment">		func (b *Writer) WriteRune(r rune) (size int, err error)</span></span><br><span class="line"><span class="comment">		func (b *Writer) WriteString(s string) (int, error)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	 fileName := <span class="string">"/Users/ruby/Documents/pro/a/cc.txt"</span></span><br><span class="line">	 file,err := os.OpenFile(fileName,os.O_CREATE|os.O_WRONLY,os.ModePerm)</span><br><span class="line">	 <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">	 	fmt.Println(err)</span><br><span class="line">	 	<span class="keyword">return</span></span><br><span class="line">	 &#125;</span><br><span class="line">	 <span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	 w1 := bufio.NewWriter(file)</span><br><span class="line">	 <span class="comment">//n,err := w1.WriteString("helloworld")</span></span><br><span class="line">	 <span class="comment">//fmt.Println(err)</span></span><br><span class="line">	 <span class="comment">//fmt.Println(n)</span></span><br><span class="line">	 <span class="comment">//w1.Flush() //刷新缓冲区</span></span><br><span class="line"></span><br><span class="line">	 <span class="keyword">for</span> i:=<span class="number">1</span>;i&lt;=<span class="number">1000</span>;i++&#123;</span><br><span class="line">	 	w1.WriteString(fmt.Sprintf(<span class="string">"%d:hello"</span>,i))</span><br><span class="line">	 &#125;</span><br><span class="line">	 w1.Flush()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="六、ioutil包"><a href="#六、ioutil包" class="headerlink" title="六、ioutil包"></a>六、ioutil包</h1><p>除了io包可以读写数据，Go语言中还提供了一个辅助的工具包就是ioutil，里面的方法虽然不多，但是都还蛮好用的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"io/ioutil"</span></span><br></pre></td></tr></table></figure>

<p>该包的介绍只有一句话：Package ioutil implements some I/O utility functions。</p>
<h2 id="1、ioutil包的方法"><a href="#1、ioutil包的方法" class="headerlink" title="1、ioutil包的方法"></a>1、ioutil包的方法</h2><p>下面我们来看一下里面的方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Discard 是一个 io.Writer 接口，调用它的 Write 方法将不做任何事情</span></span><br><span class="line"><span class="comment">// 并且始终成功返回。</span></span><br><span class="line"><span class="keyword">var</span> Discard io.Writer = devNull(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadAll 读取 r 中的所有数据，返回读取的数据和遇到的错误。</span></span><br><span class="line"><span class="comment">// 如果读取成功，则 err 返回 nil，而不是 EOF，因为 ReadAll 定义为读取</span></span><br><span class="line"><span class="comment">// 所有数据，所以不会把 EOF 当做错误处理。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadAll</span><span class="params">(r io.Reader)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadFile 读取文件中的所有数据，返回读取的数据和遇到的错误。</span></span><br><span class="line"><span class="comment">// 如果读取成功，则 err 返回 nil，而不是 EOF</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(filename <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WriteFile 向文件中写入数据，写入前会清空文件。</span></span><br><span class="line"><span class="comment">// 如果文件不存在，则会以指定的权限创建该文件。</span></span><br><span class="line"><span class="comment">// 返回遇到的错误。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WriteFile</span><span class="params">(filename <span class="keyword">string</span>, data []<span class="keyword">byte</span>, perm os.FileMode)</span> <span class="title">error</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadDir 读取指定目录中的所有目录和文件（不包括子目录）。</span></span><br><span class="line"><span class="comment">// 返回读取到的文件信息列表和遇到的错误，列表是经过排序的。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadDir</span><span class="params">(dirname <span class="keyword">string</span>)</span> <span class="params">([]os.FileInfo, error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NopCloser 将 r 包装为一个 ReadCloser 类型，但 Close 方法不做任何事情。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NopCloser</span><span class="params">(r io.Reader)</span> <span class="title">io</span>.<span class="title">ReadCloser</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TempFile 在 dir 目录中创建一个以 prefix 为前缀的临时文件，并将其以读</span></span><br><span class="line"><span class="comment">// 写模式打开。返回创建的文件对象和遇到的错误。</span></span><br><span class="line"><span class="comment">// 如果 dir 为空，则在默认的临时目录中创建文件（参见 os.TempDir），多次</span></span><br><span class="line"><span class="comment">// 调用会创建不同的临时文件，调用者可以通过 f.Name() 获取文件的完整路径。</span></span><br><span class="line"><span class="comment">// 调用本函数所创建的临时文件，应该由调用者自己删除。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TempFile</span><span class="params">(dir, prefix <span class="keyword">string</span>)</span> <span class="params">(f *os.File, err error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TempDir 功能同 TempFile，只不过创建的是目录，返回目录的完整路径。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TempDir</span><span class="params">(dir, prefix <span class="keyword">string</span>)</span> <span class="params">(name <span class="keyword">string</span>, err error)</span></span></span><br></pre></td></tr></table></figure>



<h2 id="2、示例代码："><a href="#2、示例代码：" class="headerlink" title="2、示例代码："></a>2、示例代码：</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	ioutil包：</span></span><br><span class="line"><span class="comment">		ReadFile()</span></span><br><span class="line"><span class="comment">		WriteFile()</span></span><br><span class="line"><span class="comment">		ReadDir()</span></span><br><span class="line"><span class="comment">		..</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//1.读取文件中的所有的数据</span></span><br><span class="line">	<span class="comment">//fileName1 := "/Users/ruby/Documents/pro/a/aa.txt"</span></span><br><span class="line">	<span class="comment">//data, err := ioutil.ReadFile(fileName1)</span></span><br><span class="line">	<span class="comment">//fmt.Println(err)</span></span><br><span class="line">	<span class="comment">//fmt.Println(string(data))</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//2.写出数据</span></span><br><span class="line">	<span class="comment">//fileName2:="/Users/ruby/Documents/pro/a/bbb.txt"</span></span><br><span class="line">	<span class="comment">//s1:="helloworld面朝大海春暖花开"</span></span><br><span class="line">	<span class="comment">//err:=ioutil.WriteFile(fileName2,[]byte(s1),0777)</span></span><br><span class="line">	<span class="comment">//fmt.Println(err)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//3.</span></span><br><span class="line">	<span class="comment">//s2:="qwertyuiopsdfghjklzxcvbnm"</span></span><br><span class="line">	<span class="comment">//r1:=strings.NewReader(s2)</span></span><br><span class="line">	<span class="comment">//data,_:=ioutil.ReadAll(r1)</span></span><br><span class="line">	<span class="comment">//fmt.Println(data)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//4.ReadDir(),读取一个目录下的子内容：子文件和子目录，但是仅有一层</span></span><br><span class="line">	<span class="comment">//dirName:="/Users/ruby/Documents/pro/a"</span></span><br><span class="line">	<span class="comment">//fileInfos,_:=ioutil.ReadDir(dirName)</span></span><br><span class="line">	<span class="comment">//fmt.Println(len(fileInfos))</span></span><br><span class="line">	<span class="comment">//for i:=0;i&lt;len(fileInfos);i++&#123;</span></span><br><span class="line">	<span class="comment">//	//fmt.Printf("%T\n",fileInfos[i])</span></span><br><span class="line">	<span class="comment">//	fmt.Println(i,fileInfos[i].Name(),fileInfos[i].IsDir())</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5.创建临时目录</span></span><br><span class="line">	dir, err := ioutil.TempDir(<span class="string">"/Users/ruby/Documents/pro/a"</span>, <span class="string">"Test"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> os.Remove(dir) <span class="comment">// 用完删除</span></span><br><span class="line">	fmt.Printf(<span class="string">"%s\n"</span>, dir)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建临时文件</span></span><br><span class="line">	f, err := ioutil.TempFile(dir, <span class="string">"Test"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> os.Remove(f.Name()) <span class="comment">// 用完删除</span></span><br><span class="line">	fmt.Printf(<span class="string">"%s\n"</span>, f.Name())</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="七、遍历文件夹"><a href="#七、遍历文件夹" class="headerlink" title="七、遍历文件夹"></a>七、遍历文件夹</h1><p>学习io之后，尤其是文件操作，我们就可以遍历给定的目录文件夹了。可以使用ioutil包下的readDir()方法，这个方法可以获取指定目录下的内容，返回文件和子目录。</p>
<p>因为文件夹下还有子文件夹，而ioutil包的ReadDir()只能获取一层目录，所以我们需要自己去设计算法来实现，最容易实现的思路就是使用递归。</p>
<p>示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	遍历文件夹：</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	dirname := <span class="string">"/Users/ruby/Documents/pro"</span></span><br><span class="line">	listFiles(dirname, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">listFiles</span><span class="params">(dirname <span class="keyword">string</span>, level <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// level用来记录当前递归的层次</span></span><br><span class="line">	<span class="comment">// 生成有层次感的空格</span></span><br><span class="line">	s := <span class="string">"|--"</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; level; i++ &#123;</span><br><span class="line">		s = <span class="string">"|   "</span> + s</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fileInfos, err := ioutil.ReadDir(dirname)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, fi := <span class="keyword">range</span> fileInfos &#123;</span><br><span class="line">		filename := dirname + <span class="string">"/"</span> + fi.Name()</span><br><span class="line">		fmt.Printf(<span class="string">"%s%s\n"</span>, s, filename)</span><br><span class="line">		<span class="keyword">if</span> fi.IsDir() &#123;</span><br><span class="line">			<span class="comment">//继续遍历fi这个目录</span></span><br><span class="line">			listFiles(filename, level+<span class="number">1</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行结果：</p>
<p><img src="img/WX20190720-210316.png" alt="WX20190720-210316"></p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://nlbyd1119.online/2020/07/02/go-study-5/" title="go-study-5" target="_blank" rel="external">http://nlbyd1119.online/2020/07/02/go-study-5/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/nlby" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/nlby" target="_blank"><span class="text-dark">nlby</span><small class="ml-1x"></small></a></h3>
        <div></div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    <div id="git"></div>
<link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
<script src="https://billts.site/js/gitment.js"></script>
<script>
var gitment = new Gitment({
  id: window.decodeURIComponent(window.location.pathname),
  owner: 'nlby',
  repo: 'nlbyvh.github.io',
  oauth: {
    client_id: '6d53a92df707fc123e7a',
    client_secret: '2bd9e28afe88cb142fa8fa7092c9a8c20ae25555',
  },
})
gitment.render('git')
</script>
  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2020/07/10/%E5%85%B3%E4%BA%8Ejava%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0%E6%8F%90%E5%8D%87%E8%B7%AF%E7%BA%BF%E7%9A%84%E6%80%9D%E8%80%83%E4%B8%8E%E6%80%BB%E7%BB%93/" title="关于java后端学习提升路线的思考与总结"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2020/07/01/Linux%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" title="Linux基本命令"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	

    <div class="copyright">
    	
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
<script src="//cdn.jsdelivr.net/npm/gitment@0.0.3/dist/gitment.browser.min.js"></script>
<script>
var gitment = new Gitment({
  // id默认为当前页面url，如果url后带参数或锚点，gitment要重新初始化
  // https://github.com/imsun/gitment/issues/55
  // 解决方案：id:window.location.pathname,或者将id设置为当前页面标题
  id: 'go-study-5', 
  owner: 'nlby', // 可以是你的GitHub用户名，也可以是github id
  repo: 'nlbyvh.github.io',
  oauth: {
    client_id: '6d53a92df707fc123e7a',
    client_secret: '2bd9e28afe88cb142fa8fa7092c9a8c20ae25555',
  }
})
gitment.render('comments')
</script>









<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/violet.model.json"},"display":{"position":"left","width":180,"height":360},"mobile":{"show":true},"log":false});</script></body>
</html>